<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Bap_strings_unscrambler.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Bap" rel="Chapter" href="Bap.html">
<link title="Bap_bundle" rel="Chapter" href="Bap_bundle.html">
<link title="Bap_config" rel="Chapter" href="Bap_config.html">
<link title="Core_printers" rel="Chapter" href="Core_printers.html">
<link title="Bap_plugins" rel="Chapter" href="Bap_plugins.html">
<link title="Regular" rel="Chapter" href="Regular.html">
<link title="Monads" rel="Chapter" href="Monads.html">
<link title="Ogre" rel="Chapter" href="Ogre.html">
<link title="Bap_future" rel="Chapter" href="Bap_future.html">
<link title="Graphlib" rel="Chapter" href="Graphlib.html">
<link title="Bap_taint" rel="Chapter" href="Bap_taint.html">
<link title="Bap_primus" rel="Chapter" href="Bap_primus.html">
<link title="Bare" rel="Chapter" href="Bare.html">
<link title="Arm_insn" rel="Chapter" href="Arm_insn.html">
<link title="Arm_mul" rel="Chapter" href="Arm_mul.html">
<link title="Arm_utils" rel="Chapter" href="Arm_utils.html">
<link title="Arm_mem_shift" rel="Chapter" href="Arm_mem_shift.html">
<link title="Arm_flags" rel="Chapter" href="Arm_flags.html">
<link title="Arm_env" rel="Chapter" href="Arm_env.html">
<link title="Arm_mem" rel="Chapter" href="Arm_mem.html">
<link title="Arm_op" rel="Chapter" href="Arm_op.html">
<link title="Arm_bit" rel="Chapter" href="Arm_bit.html">
<link title="Arm_branch" rel="Chapter" href="Arm_branch.html">
<link title="ARM" rel="Chapter" href="ARM.html">
<link title="Arm_shift" rel="Chapter" href="Arm_shift.html">
<link title="Arm_mov" rel="Chapter" href="Arm_mov.html">
<link title="Arm_cond" rel="Chapter" href="Arm_cond.html">
<link title="Arm_types" rel="Chapter" href="Arm_types.html">
<link title="Arm_reg" rel="Chapter" href="Arm_reg.html">
<link title="Arm_helpers" rel="Chapter" href="Arm_helpers.html">
<link title="Arm_lifter" rel="Chapter" href="Arm_lifter.html">
<link title="X86_asm_reg" rel="Chapter" href="X86_asm_reg.html">
<link title="X86_types" rel="Chapter" href="X86_types.html">
<link title="X86_env" rel="Chapter" href="X86_env.html">
<link title="X86_llvm_env" rel="Chapter" href="X86_llvm_env.html">
<link title="X86_asm" rel="Chapter" href="X86_asm.html">
<link title="X86_cpu" rel="Chapter" href="X86_cpu.html">
<link title="X86_asm_reg_types" rel="Chapter" href="X86_asm_reg_types.html">
<link title="Bap_api" rel="Chapter" href="Bap_api.html">
<link title="Bap_abi" rel="Chapter" href="Bap_abi.html">
<link title="Bap_c_type" rel="Chapter" href="Bap_c_type.html">
<link title="Bap_c_data" rel="Chapter" href="Bap_c_data.html">
<link title="Bap_c_attr" rel="Chapter" href="Bap_c_attr.html">
<link title="Bap_c_type_mapper_intf" rel="Chapter" href="Bap_c_type_mapper_intf.html">
<link title="Bap_c_type_printer" rel="Chapter" href="Bap_c_type_printer.html">
<link title="Bap_c_term_attributes" rel="Chapter" href="Bap_c_term_attributes.html">
<link title="Bap_c_abi" rel="Chapter" href="Bap_c_abi.html">
<link title="Bap_c_type_mapper" rel="Chapter" href="Bap_c_type_mapper.html">
<link title="Bap_c" rel="Chapter" href="Bap_c.html">
<link title="Bap_c_parser" rel="Chapter" href="Bap_c_parser.html">
<link title="Bap_c_size" rel="Chapter" href="Bap_c_size.html">
<link title="Bap_bml" rel="Chapter" href="Bap_bml.html">
<link title="Bap_build" rel="Chapter" href="Bap_build.html">
<link title="Bap_byteweight_signatures" rel="Chapter" href="Bap_byteweight_signatures.html">
<link title="Bap_byteweight" rel="Chapter" href="Bap_byteweight.html">
<link title="Bap_demangle" rel="Chapter" href="Bap_demangle.html">
<link title="Bap_dwarf" rel="Chapter" href="Bap_dwarf.html">
<link title="Bap_ida" rel="Chapter" href="Bap_ida.html">
<link title="Bap_llvm" rel="Chapter" href="Bap_llvm.html">
<link title="Bap_llvm_loader" rel="Chapter" href="Bap_llvm_loader.html">
<link title="Bap_traces" rel="Chapter" href="Bap_traces.html">
<link title="Bap_strings_index" rel="Chapter" href="Bap_strings_index.html">
<link title="Bap_strings_scanner" rel="Chapter" href="Bap_strings_scanner.html">
<link title="Bap_strings" rel="Chapter" href="Bap_strings.html">
<link title="Bap_strings_detector" rel="Chapter" href="Bap_strings_detector.html">
<link title="Bap_strings_unscrambler" rel="Chapter" href="Bap_strings_unscrambler.html">
<link title="Text_tags" rel="Chapter" href="Text_tags.html"><link title="none mode" rel="Section" href="#2_nonemode">
<link title="html mode" rel="Section" href="#2_htmlmode">
<link title="Attr mode" rel="Section" href="#2_Attrmode">
<link title="Blocks mode" rel="Section" href="#2_Blocksmode">
<link title="Implementation details" rel="Subsection" href="#3_Implementationdetails">
<link title="Ansi color submode" rel="Subsection" href="#colors">
<title>BAR: BAP Annotated Reference : Text_tags</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Bap_strings_unscrambler.html" title="Bap_strings_unscrambler">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;</div>
<h1>Module <a href="type_Text_tags.html">Text_tags</a></h1>

<pre><span id="MODULEText_tags"><span class="keyword">module</span> Text_tags</span>: <code class="code"><span class="keyword">sig</span></code> <a href="Text_tags.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><hr width="100%">
<p>Controls tags in format strings.</p>

<p>This module provides facilities to control tags in the format
    strings. For simplicity and readability we're using sexp to define
    tags with attributes. See below for more information.</p>

<p>The default behavior is to ignore tags. You can switch between
    modes using <code class="code">install</code> and <code class="code">with_mode</code> function (the last one
    will restore previous state of the formatter).</p>

<p>Tags allows to literally tag pieces of text in format strings,
    the format of tagging can be explained with the following example:</p>

<p><code class="code"><span class="string">"@{&lt;html&gt;&nbsp;@{&lt;head&gt;&nbsp;@{&lt;title&gt;&nbsp;Tags!@}@}@{&lt;body&gt;&nbsp;Hello!@}@}"</span></code></p>

<p>In html mode, this will produce a valid <code class="code"><span class="constructor">HTML</span></code> document:</p>

<pre class="verbatim">      &lt;html&gt;
       &lt;head&gt;
        &lt;title&gt;
          Tags!
        &lt;/title&gt;
       &lt;/head&gt;
       &lt;body&gt;
         Hello!
       &lt;/body&gt;
      &lt;/html&gt;
   </pre>
<h3 id="2_nonemode">none mode</h3>
<p>In this mode (the default one) the tags will be ignored, and they
    will have no effect on the final output.</p>

<h3 id="2_htmlmode">html mode</h3>
<p>If tag has attributes, then they should be passed as
    S-expressions, with the following grammar (EBNF):</p>

<pre class="verbatim">    tag = name | "(", name, {arg}, ")";
    arg = "(", name, value, ")".
   </pre>
<p>Where <code class="code">name</code> is arbitrary html valid name without <code class="code">&gt;</code> in it.
    The same is true for <code class="code">value</code> with an addition of double quotes.
    If <code class="code">value</code> start with double quotes it will be stored as is,
    otherwise it will be properly escaped and double quoted.</p>

<h4 id="3_Implementationdetails">Implementation details</h4>
<p>Tags in <code class="code"><span class="constructor">Format</span></code> module are stringly typed, so we will use a
    trick, and encode them using s-expressions. Not very typesafe,
    but better than arbitrary string.</p>

<p>Example: <code class="code">(a&nbsp;(href&nbsp;<span class="keywordsign">#</span>)&nbsp;(id&nbsp;x))</code> will be converted to <code class="code">&lt;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;href=<span class="string">"#"</span>&nbsp;id=<span class="string">"x"</span>&gt;</code>. Note, that quotes will be inserted
    automatically, and special symbols will be escaped.  If
    attribute value is quoted by itself, then it will be taken as
    is. If tag doesn't contain attributes, then it can be provided
    as an atom, e.g. <code class="code">html</code>, but more verbose <code class="code">(html)</code> is still
    accepted</p>

<h3 id="2_Attrmode">Attr mode</h3>
<p>In this mode the tag has the following syntax:</p>

<pre class="verbatim">tag = ".", name, value, "\n"</pre>
<p>where name is a strings that must not contain whitespaces. (Usually
    we use dashes to separate words), and value is an arbitrary
    sequence of chars that must not contain the newline character.</p>

<p>The attributes will be printed as is, if the mode is enabled, and
    a name of the attribute is marked to be shown with <a href="Text_tags.Attr.html#VALshow"><code class="code"><span class="constructor">Text_tags</span>.<span class="constructor">Attr</span>.show</code></a>
    function (by default no attributes will be shown).</p>

<h4 id="colors">Ansi color submode</h4>
<p>When <a href="Text_tags.Attr.html#VALprint_colors"><code class="code"><span class="constructor">Text_tags</span>.<span class="constructor">Attr</span>.print_colors</code></a> is set to <code class="code"><span class="keyword">true</span></code>, the <code class="code">foreground</code> and
    <code class="code">background</code> attributes will be handled specially. The attribute
    value, that must be a valid ansi color escape sequence, will
    switch the foreground and background colors of the text, if the
    terminal allows it (otherwise ugly things will happen, that's why
    the attribute is ignored when color submode is disabled).</p>

<h3 id="2_Blocksmode">Blocks mode</h3>
<p>The blocks mode grammar is very similiar to html mode, as it also
    uses sexp syntax.</p>

<pre class="verbatim">tag := "(", "id", value, ")" | "(", "title", value, ")"</pre>
<p>Where <code class="code">value</code> is a string, delimited with quotes if it contains
    whitespaces.</p>

<p>The tag will be rendered as begin/end block, with the body
    indented by one space. E.g.,</p>

<p>Will be rendered as:</p>

<pre class="verbatim">      begin(main)
       r0 := r1 + r2
       r1 := r2 + r2
       return lr
      end(main)
     </pre>
<p>If both <code class="code">id</code> and <code class="code">title</code> is specified, then only title will be
    outputed. Otherwise, <code class="code">id</code> and <code class="code">title</code> has the same behavior.</p>

<pre><span id="TYPEmode"><span class="keyword">type</span> <code class="type"></code>mode</span> = <code class="type">string</code> </pre>
<div class="info ">
<div class="info-desc">
<p>A name of mode, by default the following modes ares supported
    <code class="code">html</code>, <code class="code">blocks</code>, <code class="code">attr</code> and <code class="code">none</code></p>
</div>
</div>


<pre><span id="EXCEPTIONUnknown_mode"><span class="keyword">exception</span> Unknown_mode</span> <span class="keyword">of</span> <code class="type">string</code></pre>

<pre><span id="VALinstall"><span class="keyword">val</span> install</span> : <code class="type">Stdlib.Format.formatter -> <a href="Text_tags.html#TYPEmode">mode</a> -> unit</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">install&nbsp;ppf&nbsp;mode</code> switch formatter <code class="code">ppf</code> into a <code class="code">mode</code>.
    In a default <code class="code">mode</code> (named <code class="code">none</code>), the semantics tags are
    ignored. Once a <code class="code">mode</code> is installed, all tags will be rendered
    according to the mode.</p>
</div>
</div>

<pre><span id="VALwith_mode"><span class="keyword">val</span> with_mode</span> : <code class="type">Stdlib.Format.formatter -> <a href="Text_tags.html#TYPEmode">mode</a> -> f:(unit -> 'a) -> 'a</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">with_mode&nbsp;ppf&nbsp;mode&nbsp;f</code> installs <code class="code">mode</code>, calls <code class="code">f</code>, and then
    reinstalls the previous mode.</p>
</div>
</div>

<pre><span id="VALregister_mode"><span class="keyword">val</span> register_mode</span> : <code class="type"><a href="Text_tags.html#TYPEmode">mode</a> -> (Stdlib.Format.formatter -> unit) -> unit</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">register_mode&nbsp;mode&nbsp;init</code> installs new mode.
    The <code class="code">init</code> function must install all mode hooks using
    <code class="code"><span class="constructor">Format</span></code> interface.</p>
</div>
</div>

<pre><span id="VALavailable_modes"><span class="keyword">val</span> available_modes</span> : <code class="type">unit -> <a href="Text_tags.html#TYPEmode">mode</a> list</code></pre><div class="info ">
<div class="info-desc">
<p><code class="code">available_modes&nbsp;()</code> lists all currently installed modes.</p>
</div>
</div>

<pre><span id="MODULEAttr"><span class="keyword">module</span> <a href="Text_tags.Attr.html">Attr</a></span>: <code class="code"><span class="keyword">sig</span></code> <a href="Text_tags.Attr.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<p>Attributes mode.</p>

</div>
</body></html>
