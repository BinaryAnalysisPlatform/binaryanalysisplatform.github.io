<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Bap_future.Std.Applicable.html">
<link rel="next" href="Bap_future.Std.Future.html">
<link rel="Up" href="Bap_future.Std.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Bap" rel="Chapter" href="Bap.html">
<link title="Bap_bundle" rel="Chapter" href="Bap_bundle.html">
<link title="Bap_config" rel="Chapter" href="Bap_config.html">
<link title="Core_printers" rel="Chapter" href="Core_printers.html">
<link title="Bap_plugins" rel="Chapter" href="Bap_plugins.html">
<link title="Regular" rel="Chapter" href="Regular.html">
<link title="Monads" rel="Chapter" href="Monads.html">
<link title="Ogre" rel="Chapter" href="Ogre.html">
<link title="Bap_future" rel="Chapter" href="Bap_future.html">
<link title="Graphlib" rel="Chapter" href="Graphlib.html">
<link title="Bap_taint" rel="Chapter" href="Bap_taint.html">
<link title="Bap_primus" rel="Chapter" href="Bap_primus.html">
<link title="Bare" rel="Chapter" href="Bare.html">
<link title="Arm_insn" rel="Chapter" href="Arm_insn.html">
<link title="Arm_mul" rel="Chapter" href="Arm_mul.html">
<link title="Arm_utils" rel="Chapter" href="Arm_utils.html">
<link title="Arm_mem_shift" rel="Chapter" href="Arm_mem_shift.html">
<link title="Arm_flags" rel="Chapter" href="Arm_flags.html">
<link title="Arm_env" rel="Chapter" href="Arm_env.html">
<link title="Arm_mem" rel="Chapter" href="Arm_mem.html">
<link title="Arm_op" rel="Chapter" href="Arm_op.html">
<link title="Arm_bit" rel="Chapter" href="Arm_bit.html">
<link title="Arm_branch" rel="Chapter" href="Arm_branch.html">
<link title="ARM" rel="Chapter" href="ARM.html">
<link title="Arm_shift" rel="Chapter" href="Arm_shift.html">
<link title="Arm_mov" rel="Chapter" href="Arm_mov.html">
<link title="Arm_cond" rel="Chapter" href="Arm_cond.html">
<link title="Arm_types" rel="Chapter" href="Arm_types.html">
<link title="Arm_reg" rel="Chapter" href="Arm_reg.html">
<link title="Arm_helpers" rel="Chapter" href="Arm_helpers.html">
<link title="Arm_lifter" rel="Chapter" href="Arm_lifter.html">
<link title="X86_asm_reg" rel="Chapter" href="X86_asm_reg.html">
<link title="X86_types" rel="Chapter" href="X86_types.html">
<link title="X86_env" rel="Chapter" href="X86_env.html">
<link title="X86_llvm_env" rel="Chapter" href="X86_llvm_env.html">
<link title="X86_asm" rel="Chapter" href="X86_asm.html">
<link title="X86_cpu" rel="Chapter" href="X86_cpu.html">
<link title="X86_asm_reg_types" rel="Chapter" href="X86_asm_reg_types.html">
<link title="Bap_api" rel="Chapter" href="Bap_api.html">
<link title="Bap_abi" rel="Chapter" href="Bap_abi.html">
<link title="Bap_c_type" rel="Chapter" href="Bap_c_type.html">
<link title="Bap_c_data" rel="Chapter" href="Bap_c_data.html">
<link title="Bap_c_attr" rel="Chapter" href="Bap_c_attr.html">
<link title="Bap_c_type_mapper_intf" rel="Chapter" href="Bap_c_type_mapper_intf.html">
<link title="Bap_c_type_printer" rel="Chapter" href="Bap_c_type_printer.html">
<link title="Bap_c_term_attributes" rel="Chapter" href="Bap_c_term_attributes.html">
<link title="Bap_c_abi" rel="Chapter" href="Bap_c_abi.html">
<link title="Bap_c_type_mapper" rel="Chapter" href="Bap_c_type_mapper.html">
<link title="Bap_c" rel="Chapter" href="Bap_c.html">
<link title="Bap_c_parser" rel="Chapter" href="Bap_c_parser.html">
<link title="Bap_c_size" rel="Chapter" href="Bap_c_size.html">
<link title="Bap_bml" rel="Chapter" href="Bap_bml.html">
<link title="Bap_build" rel="Chapter" href="Bap_build.html">
<link title="Bap_byteweight_signatures" rel="Chapter" href="Bap_byteweight_signatures.html">
<link title="Bap_byteweight" rel="Chapter" href="Bap_byteweight.html">
<link title="Bap_demangle" rel="Chapter" href="Bap_demangle.html">
<link title="Bap_dwarf" rel="Chapter" href="Bap_dwarf.html">
<link title="Bap_ida" rel="Chapter" href="Bap_ida.html">
<link title="Bap_llvm" rel="Chapter" href="Bap_llvm.html">
<link title="Bap_llvm_loader" rel="Chapter" href="Bap_llvm_loader.html">
<link title="Bap_traces" rel="Chapter" href="Bap_traces.html">
<link title="Bap_strings_index" rel="Chapter" href="Bap_strings_index.html">
<link title="Bap_strings_scanner" rel="Chapter" href="Bap_strings_scanner.html">
<link title="Bap_strings" rel="Chapter" href="Bap_strings.html">
<link title="Bap_strings_detector" rel="Chapter" href="Bap_strings_detector.html">
<link title="Bap_strings_unscrambler" rel="Chapter" href="Bap_strings_unscrambler.html">
<link title="Text_tags" rel="Chapter" href="Text_tags.html"><title>BAR: BAP Annotated Reference : Bap_future.Std.Variadic</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Bap_future.Std.Applicable.html" title="Bap_future.Std.Applicable">Previous</a>
&nbsp;<a class="up" href="Bap_future.Std.html" title="Bap_future.Std">Up</a>
&nbsp;<a class="post" href="Bap_future.Std.Future.html" title="Bap_future.Std.Future">Next</a>
</div>
<h1>Module <a href="type_Bap_future.Std.Variadic.html">Bap_future.Std.Variadic</a></h1>

<pre><span class="keyword">module</span> Variadic: <code class="code"><span class="keyword">sig</span></code> <a href="Bap_future.Std.Variadic.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
Variadic arguments.
<p>

      <code class="code"><span class="constructor">Variadic</span></code>, abstracts a common idiom of a function applied to a
      variable number of arguments. A common examples of such function
      would be OCaml's standard <code class="code">printf</code> and <code class="code">scanf</code> functions. A more
      general examples, are monadic parsers, such as <code class="code"><span class="constructor">MParser</span></code>,
      command line parsers such as <code class="code"><span class="constructor">Cmdliner</span></code> and <code class="code"><span class="constructor">Core</span></code>'s
      <code class="code"><span class="constructor">Command</span></code>. They all are using the same trick to collect
      arguments of different type and pass it to a function, s.t.
      the function type actually defines the type of collected
      arguments. Both <code class="code"><span class="constructor">Cmdliner</span></code> and <code class="code"><span class="constructor">Command</span></code> relies on <code class="code"><span class="constructor">Applicative</span></code>
      functor defined in <code class="code">1</code>. However, it requires a <code class="code">return</code>
      function, that is not possible to provide in general for
      co-inductive types, that can only be observed or mapped. It is
      still possible to implement a variadic interface using the
      restricted <code class="code"><span class="constructor">Applicable</span></code> interface given only one restriction: it
      is not possible to create an empty variadic list of arguments
      (that can be considered as a benefit).
<p>

      Here are some examples, that highlights common use cases of the
      variadic structure. Suppose, we have several future values of
      different types, that we would like to merge with some function
      <code class="code">f</code>, to be concrete let's assume, that we're waiting for:
<p>

      <code class="code">arch&nbsp;:&nbsp;arch&nbsp;future</code> - program architecture to be defined;
      <code class="code">lang&nbsp;:&nbsp;lang&nbsp;future</code> - a programming language;
      <code class="code">abi&nbsp;&nbsp;:&nbsp;abi&nbsp;future</code>  - an ABI;
      <code class="code">api&nbsp;&nbsp;:&nbsp;api&nbsp;future</code>  - an api specification
<p>

      And we have a function <code class="code">typecheck</code> of type
<p>

      <pre class="codepre"><code class="code">arch <span class="keywordsign">-&gt;</span> lang <span class="keywordsign">-&gt;</span> abi <span class="keywordsign">-&gt;</span> api <span class="keywordsign">-&gt;</span> pass future</code></pre>,
<p>

      that will typecheck a binary program, according to the typing
      rules of the specified programming <code class="code">lang</code>uage, binary interface,
      and type environment <code class="code">api</code>. Given the <code class="code"><span class="constructor">Variadic</span></code> interface we
      can write it as
<p>

      <code class="code"><span class="constructor">Future</span>.<span class="constructor">Variadic</span>.(apply&nbsp;(args&nbsp;arch&nbsp;$lang&nbsp;$abi&nbsp;$api)&nbsp;~f:typecheck</code>
<p>

      Note, since future implements a more powerful Monad interface,
      it is still possible to apply a <code class="code">typecheck</code> function without
      using the variadic interface, e.g.,
<p>

      <pre class="codepre"><code class="code">        arch &gt;&gt;= <span class="keyword">fun</span> arch <span class="keywordsign">-&gt;</span>
        lang &gt;&gt;= <span class="keyword">fun</span> lang <span class="keywordsign">-&gt;</span>
        abi &gt;&gt;= <span class="keyword">fun</span> abi <span class="keywordsign">-&gt;</span>
        api &gt;&gt;= <span class="keyword">fun</span> api <span class="keywordsign">-&gt;</span>
        typecheck arch lang abi api
      </code></pre>
<p>

      However, this is less general, as it specifies a concrete order
      of argument bindings, it is also requires a much less general
      monad interface with bind and return operations, that are in
      general not available for coinductive types, for example for
      <code class="code">stream</code> type. If we substitute <code class="code">future</code> type constructor in the
      above example with a <code class="code">stream</code> constructor we will no be able to
      implement the latter solution, as we lack the monad  interface.
<p>

      Using a stream for this particular example, makes sense, since,
      the specified properties, can be defined on a module level, so
      they can be defined multiple times for each project. In that
      case function typecheck will be applied for each quartet of the
      arguments.
<p>

      When used with collections, such as list, sequences, sets, etc,
      the pattern can be used to generalize cartesian product from a
      function taking a pair of arguments, to a function taking
      arbitrary amount of arguments.
<p>

      For collection, the Variadic can be used to generalize cartesian
      product to <code class="code"><span class="constructor">N</span></code> arguments:
<p>

      <pre class="codepre"><code class="code">        <span class="keyword">module</span> <span class="constructor">AList</span> = <span class="keyword">struct</span>
          <span class="keyword">include</span> <span class="constructor">List</span>
          <span class="keyword">let</span> apply fs xs =
            cartesian_product fs xs &gt;&gt;| <span class="keyword">fun</span> (f,x) <span class="keywordsign">-&gt;</span> f x
        <span class="keyword">end</span>
        <span class="keyword">module</span> <span class="constructor">Varags</span> = <span class="constructor">Variadic</span>.<span class="constructor">Make</span>(<span class="constructor">AList</span>)

        <span class="keyword">let</span> cartesian_product = <span class="constructor">Varags</span>.apply
      </code></pre>
<p>

      For option and error monad, with the following definition of
      <code class="code">apply</code>,
<p>

      <pre class="codepre"><code class="code"><span class="keyword">let</span> apply f x = <span class="keyword">match</span> f,x <span class="keyword">with</span>
          <span class="keywordsign">|</span> <span class="constructor">Some</span> f, <span class="constructor">Some</span> x <span class="keywordsign">-&gt;</span> <span class="constructor">Some</span> (f x)
          <span class="keywordsign">|</span> <span class="constructor">None</span> <span class="keywordsign">-&gt;</span> <span class="constructor">None</span></code></pre>
<p>

      The produced <code class="code"><span class="constructor">Varargs</span>.apply</code> will be a generalization of
      <code class="code"><span class="constructor">Option</span>.merge</code>, i.e., it will apply function <code class="code">f</code> to <code class="code"><span class="constructor">N</span></code>
      arguments of different types, if all of them are not zero (i.e.,
      <code class="code"><span class="constructor">None</span></code>, <code class="code"><span class="constructor">Error</span></code>.<br>
<b>See also</b> <a href="http://staff.city.ac.uk/~ross/papers/Applicative.pdf"><pre class="verbatim">      [1]: Applicative Programming with Effects.
           Conor McBride and Ross Paterson.
           Journal of Functional Programming 18:1 (2008), pages 1-13.
   </pre></a><br>
</div>
<hr width="100%">

<pre><span class="keyword">module type</span> <a href="Bap_future.Std.Variadic.S.html">S</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Bap_future.Std.Variadic.S.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Variadic argument list.
</div>

<pre><span class="keyword">module</span> <a href="Bap_future.Std.Variadic.Make.html">Make</a> <code class="code">(</code><code class="code"><span class="constructor">T</span></code><code class="code">&nbsp;:&nbsp;</code><code class="type"><a href="Bap_future.Std.Applicable.S.html">Bap_future.Std.Applicable.S</a></code><code class="code">)&nbsp;</code>: <code class="type"><a href="Bap_future.Std.Variadic.S.html">S</a></code><code class="type">  with type 'a arg = 'a T.t</code></pre>
<pre><span class="keyword">include</span> <a href="Bap_future.Std.Variadic.S.html">Bap_future.Std.Variadic.S</a></pre>
</body></html>