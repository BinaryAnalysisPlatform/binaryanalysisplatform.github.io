<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.39 in css mode. -->
<html>
  <head>
    <title>bap.mli</title>
    <style type="text/css">
    <!--
      body {
        color: #ffffff;
        background-color: #000000;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #bdcfe4;
      }
      .constant {
        /* font-lock-constant-face */
        color: #8dfcdc;
      }
      .doc {
        /* font-lock-doc-face */
        color: #ffb08c;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #97d7fb;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #00fcff;
      }
      .tuareg-font-lock-constructor {
        /* tuareg-font-lock-constructor-face */
        color: #ffffff;
        background-color: #000000;
      }
      .tuareg-font-lock-governing {
        /* tuareg-font-lock-governing-face */
        color: #f7e3c0;
        font-weight: bold;
      }
      .tuareg-font-lock-module {
        /* tuareg-font-lock-module-face */
        color: #a5f8a8;
      }
      .tuareg-font-lock-operator {
        /* tuareg-font-lock-operator-face */
        color: #f3e99d;
      }
      .type {
        /* font-lock-type-face */
        color: #a5f8a8;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #f1e193;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="doc">(** Binary Analysis Platform API.

    {1 Overview}


    BAP has a layered architecture currently consisting of four
    layers:

    - {{!types}Core types} - defines Binary Intermidiate Language
    (BIL) as well as some common basic types, commonly usable for
    binary analysis.

    - {{!image}Memory model} - loads and represents binary in the
    memory;

    - {{!disasm}Disassembling} - the first pass of the analysis -
    disassembles and lifts binary to BIL.

    - {{!sema}Semantic analysis} - the seconds pass of decompilation,
    that performs lifting to IR and provides useful analysis.

    {2 How to use the library }

     You should start any code relying on [bap-types] library with a

     [open Bap.Std]

     It is a good idea, to open [Core_kenel.Std] before.
*)</span>

<span class="tuareg-font-lock-governing">open </span><span class="tuareg-font-lock-module">Core_kernel.Std</span>


<span class="doc">(** {1 BAP API}  *)</span>
<span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Std</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>

  <span class="doc">(** {1:types Bap core types}

      Library provides 7 core types, namely:

      - [arch] - computer architecture
      - [size] - word or addresses size
      - [var]  - a typed variable
      - [typ] - types of expressions
      - [exp]  - bil expression
      - [stmt] - bil statement
      - [addr], [word] - represents imidiate data,
            this types are indeed synonyms to [Bitvector.t].

      Every type implements [Regular] interface. This interface is
      very similiar to core's [Identifiable], and is supposed to
      represent a type that is as common as built-in type. One should
      expect to find any function that is implemented for such types as
      [int], [string], [char], etc. To name a few, this interface
      includes:

      - comparison functions: ([&lt;, &gt;, &lt;= , &gt;= , compare, between, ...]);
      - each type defines a polymorphic [Map] with keys of type [t];
      - each type provides a [Set] with values of type [t];
      - hashtable is exposed via [Table] module;
      - hashset is available under [Hash_set] name
      - sexpable and binable interface;
      - [to_string], [str], [pp], [ppo], [pps] functions
      for pretty-printing.

      And most types usually provides much more.

      For each exported type, there is a module with the same name
      (module capitalization), that implements its interface. For
      example, type [exp] is indeed a type abbreviation for [Exp.t],
      and module [Exp] contains all functions and types related to type
      [exp]. For example, to create a hashtable of statements, just
      type:

      [let table = Stmt.Table.create ()]

      If a type is a variant type, and most types in [bap-types]
      library, are variant, then for each contructor named [Name], you
      will find a corresponding function named [name] that will accept
      the same number of arguments as the arity of the constructor. For
      example, type [exp] has a contructor [Extract int * int * t)], and
      there is a corresponding function named [extract], that has type
      [int -&gt; int -&gt; t -&gt; t]. See [variantslib] for more information about,
      variants interface.
  *)</span>

  <span class="doc">(** ['a printer] defines a type for pretty-printers for a value of
      type ['a]. This is the type, that is required by [%a] specifier,
      for [Format.printf]-family of functions. Also, this is the type,
      that can be installed into OCaml toplevel or debugger.

      Note: `bap.top` library automatically installs all printers.
  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">'a printer</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Format.</span>formatter <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> unit


  <span class="doc">(** {2:tc Basic signatures} *)</span>

  <span class="doc">(** Printable interface is implemented by a significant amount of
      BAP types.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Printable</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_string</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** [str () t] is formatted output function that matches "%a"
        conversion format specifier in functions, that prints to string,
        e.g., [sprintf], [failwithf], [errorf] and, suprisingly all
        [Lwt] printing function, including [Lwt_io.printf] and logging
        (or any other function with type ('a,unit,string,...)
        formatN`. Example:

        [Or_error.errorf "type %a is not valid for %a"
          Type.str ty Exp.str exp]
    *)</span><span class="variable-name">
    </span><span class="tuareg-font-lock-governing">val</span><span class="variable-name"> str</span> <span class="tuareg-font-lock-operator">:</span> <span class="type">unit </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> t </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> string

    </span><span class="doc">(** synonym for [str]  *)</span><span class="type">
    </span><span class="tuareg-font-lock-governing">val</span><span class="type"> pps </span><span class="tuareg-font-lock-operator">:</span><span class="type"> unit </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> t </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> string

    </span><span class="doc">(** will print to a standard [output_channel], useful for using in
        [printf], [fprintf], etc. *)</span><span class="type">
    </span><span class="tuareg-font-lock-governing">val</span><span class="type"> ppo </span><span class="tuareg-font-lock-operator">:</span><span class="type"> out_channel </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> t </span><span class="tuareg-font-lock-operator">-&gt;</span><span class="type"> unit

    </span><span class="doc">(** this will include [pp] function from [Core] that has type [t printer] *)</span><span class="type">
    </span><span class="tuareg-font-lock-governing">include</span><span class="type"> </span><span class="tuareg-font-lock-module">Pretty_printer.S</span><span class="type">     </span><span class="tuareg-font-lock-governing">with type</span><span class="type"> t </span><span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Regular types models a general concept of value, i.e., something
      that can be used in way similiar to regular [int], [string],
      [char] and other built in types. So that it can be compared, used
      in maps, sets, hashtables, printer, etc.

      Note: this signature is pretty similiar to core's [Identifiable],
      but doesn't require [of_string] function, that is usually much
      harder to implement in comparison with [to_string] function. Also,
      instead of [to_string] it requires [pp] function that can be
      implemented much more efficiently and elegantly. From the [pp]
      function the whole plethora of printing functions are derived:
      [str], [pps], [ppo]. *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> compare
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Printable</span>            <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Comparable.S_binable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Hashable.S_binable</span>   <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Signature for integral type.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Integer</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">zero</span> <span class="tuareg-font-lock-operator">:</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">one</span>  <span class="tuareg-font-lock-operator">:</span> t

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">succ</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pred</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">abs</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">neg</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">add</span>     <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sub</span>     <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mul</span>     <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">div</span>     <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">modulo</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">lnot</span>    <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">logand</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">logor</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">logxor</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lshift</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rshift</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">arshift</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** A common set of infix operators  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">~-)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">+</span> <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">-</span> <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">/</span> <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(mod)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(land)</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(lor)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(lxor)</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(lsl)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(lsr)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(asr)</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
  <span class="tuareg-font-lock-governing">end</span>


  <span class="doc">(** Prefix tries.

         Trie is a mutable table, that can be seen as a specialized
         form of a hash table.

         Use [Trie.Make] functor to create modules, implementing this
         signature.  Also look at already predefined modules, like
         [String] (see below), [Bitvector.Trie], [Bil.Trie],
         [Insn.Trie], etc.

  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** trie can store arbitrary data  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="doc">(** a key type that is used to lookup data  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">key</span>

    <span class="doc">(** [create ()] creates new empty trie  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> unit <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [add trie ~key ~data] adds [data] associated with [key], if
        [trie] already has some data associated with the [key], then
        it will be overwritten *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">add</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">key</span><span class="tuareg-font-lock-operator">:</span>key <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">data</span><span class="tuareg-font-lock-operator">:</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="doc">(** [change trie key f] if trie has [data] associated with [key] then
        [f] will be called with [Some data], otherwise it will be called
        with [None]. If [f] returns [None] then there will be no data
        associated with [key], if [f] returns [Some thing], then [thing]
        will be bound to [key] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">change</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> key <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a option <span class="tuareg-font-lock-operator">-&gt;</span> 'a option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="doc">(** [find trie key] finds data associated with [key]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> key <span class="tuareg-font-lock-operator">-&gt;</span> 'a option

    <span class="doc">(** [remove trie key] removes value bound with [key] if any.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">remove</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> key <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="doc">(** [longest_match trie key]   *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">longest_match</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> key <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>int <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">length</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pp</span> <span class="tuareg-font-lock-operator">:</span> 'a printer <span class="tuareg-font-lock-operator">-&gt;</span> 'a t printer
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {2:functors Functors}  *)</span>

  <span class="doc">(** In order to implement [Regular] interface you need to provide a
      minimum implementation [M]  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Make</span><span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-constructor">M</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="doc">(** type t should be binable, sexpable and provide compare function  *)</span>
        <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> compare
        <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Pretty_printer.S</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">hash</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">module_name</span> <span class="tuareg-font-lock-operator">:</span> string
      <span class="tuareg-font-lock-governing">end</span><span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-constructor">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> <span class="tuareg-font-lock-module">M.</span>t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Constructs a trie  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** Key requirements.
        Key is a sequence of tokens of the specified length.
        It is better to use contiguous data structures, like
        arrays as keys, otherwise you can end up with a slow
        implementation (i.e., don't use lists or sequences as
        keys, use strings, bitstrings, arrays, etc). *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Key</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** the type of key  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>

      <span class="doc">(** type of token must implement bin_prot, be comparable and
          sexpable *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">token</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="doc">(** [length key] return the amount of tokens in a [key]  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">length</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int

      <span class="doc">(** [nth_token key n] the [n]'th token of key. Should be O(1) *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">nth_token</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> token

      <span class="doc">(** [hash_token tok] efficient hash function for the [token] type.
          If nothing efficient came to mind, just use [Hashtbl.hash]. *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">token_hash</span> <span class="tuareg-font-lock-operator">:</span> token <span class="tuareg-font-lock-operator">-&gt;</span> int
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Create a trie for a given [Key]  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Make</span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">Key </span><span class="tuareg-font-lock-operator">:</span><span class="variable-name"> </span><span class="tuareg-font-lock-module">Key</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Key.</span>t

    <span class="doc">(** Predefined trie with [String] as a [Key]  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">String</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> string
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {2:basic_types Main types} *)</span>

  <span class="doc">(** Type to represent machine word  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">word</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** A synonym for [word], that should be used for words
      that are addresses  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">addr</span> <span class="tuareg-font-lock-operator">=</span> word <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** {2:size Size of operand}  *)</span>

  <span class="doc">(** Type safe operand and register sizes.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Size</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** Defines possible sizes for operations operands  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">all</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r8</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r16</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r32</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> variants

    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a p</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-governing">constraint</span> 'a <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[&lt;</span> all<span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> all p
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="doc">(** {2 Lifting from int} *)</span>

    <span class="doc">(** [of_int n] return [Ok `rn] if [`rn] exists, [Error]
        otherwise.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [of_int_exn n] the same as [of_int], but raises exception
        instead of returning [Error] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int_exn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [of_int_opt n] the same as [of_int] but uses [option] type
        instead of [Or_error.t] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int_opt</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t option

    <span class="doc">(** [addr_of_int n] return [Ok `rn] if [`rn] exists, [Error]
        otherwise.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_of_int</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span> <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [addr_of_int_exn n] the same as [addr_of_int], but raises exception
        instead of returning [Error] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_of_int_exn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span>

    <span class="doc">(** [addr_of_int_opt n] the same as [addr_of_int] but uses [option] type
        instead of [Or_error.t] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_of_int_opt</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span> option

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_of_word_size</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Word_size.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">word_of_addr_size</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span> <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Word_size.</span>t

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_addr_size</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span> <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [to_bits size] returns the number of bits. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_bits</span>  <span class="tuareg-font-lock-operator">:</span> 'a p <span class="tuareg-font-lock-operator">-&gt;</span> int
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_bytes</span> <span class="tuareg-font-lock-operator">:</span> 'a p <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** size of operand  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">size</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Size.</span>t
  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** size of address  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">addr_size</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`r32</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`r64</span> <span class="tuareg-font-lock-operator">]</span> <span class="tuareg-font-lock-module">Size.</span>p
  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** just a fancy type abbreviation  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">nat1</span> <span class="tuareg-font-lock-operator">=</span> int
  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp


  <span class="doc">(** {2:bitv Bitvector}

      Bitvector -- a type for representing binary values.

      {3 Overview }

      A numeric value with a 2-complement binary representation. It is
      good for representing addresses, offsets and other numeric values.

      Each value is attributed by a its bit-width. All arithmetic
      operations over values are done modulo their widths. It is an
      error to apply arithmetic operation to values with different
      widths. Default implementations will raise a [Width] exception,
      however there exists a family of modules that provide arithmetic
      operations lifted to an [Or_error.t] monad. It is suggested to use
      them, if you know what kind of operands you're expecting.


      {4 Clarifications endianness and bit-ordering }

      Bitvector should be considered as an number with an arbitrary
      width. That means, that as with all numbers it is subject to
      endianness. When we iterate over bitvector using some container
      interface we always start from the byte with the lower
      address. Depending on endianness it will be either least
      significant bytes (little-endian), or most significant
      (big-endian). Sometimes id does matter, sometimes it doesn't. In a
      latter case you can just use a default native-endian
      interface. But in a former case, please consider using explicit
      modules, either [Bytes_LE] or [Bytes_BE], even if you know that
      your system is [LE]. Things change.

      Bits are always numbered from right to left, with least
      significant bit having a zero index, and most significant having
      index equal to [width - 1]. That means, they're endianness
      agnostic.

      {4 Clarification on size-morphism }

      Size-monomorphic operations (as opposed to size-polymorphic
      comparison) doesn't allow to compare two operands with different
      sizes, and either raise exception or return [Error]. If we would
      have type safe interface, with type [t] defined as [type 'a t],
      where ['a] stands for size, then size-monomorphic operations will
      have type ['a t -&gt; 'a t -&gt; _], and size-polymorphic ['a t -&gt; 'b t -&gt; _].

      By default, size-polymorphic comparison is used (for rationale of
      this decision look at the implementation of a hash function). To
      understand the ordering relation one can think that a lexical
      ordering is specified on a tuple [(x,n)], where [x] is the number
      and [n] is the size. For example, the following sequence is in an
      ascending order:

      {[ 0x0:1, 0x0:32, 0x0:64, 0x1:1, 0x1:32, 0xD:4, 0xDEADBEEF:32]}.

      A size-monomorphic interfaced is exposed in a [Mono] submodule. So
      if you want a monomorphic map, then just use [Mono.Map] module.
      Note, [Mono] submodule doesn't provide [Table], since we cannot
      guarantee that all keys in a hash-table have equal size.

      {4 Clarification on signs}

      By default all numbers represented by a bitvector are considered
      unsigned. This includes comparisons, e.g., [of_int (-1) ~width:32]
      is greater than zero. If you need to perform signed operation, you
      can use [signed] operator to temporary cast your value to signed.
      We use temporary to emphasize that, the signedness property won't
      propagate to the result of the operation, e.g. result of the
      following expression: [Int_exn.(signed x / y)] will not be signed.

      If any operand of a binary operation is signed, then a signed
      version of an operation is used.

      Remember to use explicit casts, whenever you really need a signed
      representation. Examples:
      {[
        let x = of_int ~-6 ~width:8
        let y = to_int x          (* y = 250 *)
        let z = to_int (signed x) (* z = ~-6 *)
        let zero = of_int 0 ~width:8
        let p = x &lt; zero          (* p = false *)
        let q = signed x &lt; zero   (* p = true *)
      ]}

      {4 Clarification on string representation }

      As a part of [Identifiable] interface bitvector provides a pair of
      complement functions: [to_string] and [of_string], that provides
      facilities to store bitvector as a human readable string, and to
      restore it from string. The format of the representation is the
      following (in EBNF):
      {[
        repr  = [sign], base, digit, {digit}, ":", size | true | false;
        sign  = "+" | "-";
        base  = "0x" | "0b" | "0o";
        size  = dec, {dec};
        digit = dec | oct | hex;
        dec   = ?decimal digit?;
        oct   = ?octal digit?;
        hex   = ?hexadecimal digit?;
      ]}

      Examples:
      [0x5D:32, 0b0101:16, 5:64, +5:8, +0x5D:16, true, false.].

      Form [false] is a shortcut for [0:1], as well as [true] is [1:1].

      If [base] is omitted base-10 is assumed. The output format is
      lways ["0x", hex, {hex}] in an unsigned form.

  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bitvector</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** {4 Common Interfaces}

        Bitvector is a value, first of all, so it supports a common set of
        a value interface: it can be stored, compared, it can be a key in
        a dictionary, etc. Moreover, being a number it can be compared
        with zero and applied to a common set of integer operations.
    *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> word

    <span class="doc">(** Bitvector implements a common set of operations that are
        expected from integral values.  *)</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Comparable.With_zero</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Integer</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t

    <span class="doc">(** A comparable interface with size-monomorphic comparison. *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Mono</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Comparable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t

    <span class="doc">(** [Width] exception is raised when size-monomorphic operation is
        applied to operands with different sizes. *)</span>
    <span class="keyword">exception</span> <span class="variable-name">Width</span> <span class="keyword">with</span> sexp

    <span class="doc">(** Specifies the order of bytes in a word. *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">endian</span> <span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">LittleEndian</span> <span class="doc">(** least significant byte comes first  *)</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">BigEndian</span>    <span class="doc">(** most  significant byte comes first  *)</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp


    <span class="doc">(** {4 Constructors}

        We provide several conversions from primitive data types.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_string</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_bool</span>  <span class="tuareg-font-lock-operator">:</span> bool <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int</span>   <span class="tuareg-font-lock-operator">:</span> <span class="constant">width</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int32</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?width</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> int32 <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int64</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?width</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> int64 <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** {4 Some predefined constant constructors }  *)</span>

    <span class="doc">(** [b0 = of_bool false] is a zero bit  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">b0</span> <span class="tuareg-font-lock-operator">:</span> t
    <span class="doc">(** [b1 = of_bool true] is a one bit  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">b1</span> <span class="tuareg-font-lock-operator">:</span> t

    <span class="doc">(** {4 Helpful shortcuts }  *)</span>

    <span class="doc">(** [one width] number one with a specified [width], is a shortcut for
        [of_int 1 ~width]*)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">one</span><span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="doc">(** [zero width] zero with a specified [width], is a shortcut for
        [of_int 0 ~width]*)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">zero</span><span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [ones width] is a number with a specified [width], and all bits
        set to 1. It is a shortcut for [of_int (lnot 0) ~width]*)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">ones</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [of_binary ?width endian num] creates a bitvector from a string
        interpreted as a sequence of bytes in a specified order.

        The result is always positive.

        [num] argument is copied

        [width] defaults to [String.length num]
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_binary</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?width</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** {4 Conversions to integers }  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int   <span class="tuareg-font-lock-module">Or_error.</span>t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int32</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int32 <span class="tuareg-font-lock-module">Or_error.</span>t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int64</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int64 <span class="tuareg-font-lock-module">Or_error.</span>t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">string_of_value</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?hex</span><span class="tuareg-font-lock-operator">:</span>bool <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** [signed t] casts t to a signed type, so that any operations
        applied on [t] will be signed *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">signed</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [is_zero bv] is true iff all bits are set to zero. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_zero</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_ones bv] is true if the least significant bit is equal to one  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_one</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [bitwidth bv] return a bit-width, i.e., the amount of bits *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">bitwidth</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="doc">(** [extract bv ~hi ~lo] extracts a subvector from [bv], starting
        from bit [hi] and ending with [lo]. Bits are enumerated from
        right to left (from least significant to most), starting from
        zero. [hi] maybe greater then [size].

        [hi] defaults to [width bv - 1]
        [lo] defaults to [0].

        Example:

        [extract (of_int 17 ~width:8) ~hi:4 ~lo:3]
        will result in a two bit vector consisting of the forth and
        third bits, i.e., equal to a number [2].

        [lo] and [hi] should be non-negative numbers. [lo] must be less
        then a [width bv] and [hi &gt;= lo]. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">extract</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?hi</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?lo</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [extract_exn bv ~hi ~lo] is the same as [extract], but will raise
        an exception on error.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">extract_exn</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?hi</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?lo</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [concat b1 b2] concatenates two bitvectors  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">concat</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [b1 @. b2] is [concat b1 b2] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(@.):</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [succ n] returns next value after [n]. Of course it is not
        guaranteed that [succ n &gt; n]*)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">succ</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [pred n] returns a value preceding [n]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pred</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [nsucc m n] is [Fn.apply_n_times ~n succ m], but more
        efficient.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">nsucc</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [npred m n] is [Fn.apply_n_times ~n pred addr], but more
        efficient.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">npred</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [a ++ n] is [nsucc a n]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(++)</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [a -- n] is [npred a n]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(--)</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** {4 Iteration over bitvector components }  *)</span>

    <span class="doc">(** [to_bytes x order] returns bytes of [x] in a specified [order].
        Each byte is represented as a [bitvector] itself. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_bytes</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span>    t <span class="tuareg-font-lock-module">Sequence.</span>t
    <span class="doc">(** [to_bytes x order] returns bytes of [x] in a specified [order],
        with bytes represented by [char] type *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_chars</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> char <span class="tuareg-font-lock-module">Sequence.</span>t

    <span class="doc">(** [to_bits x order] returns bits of [x] in a specified [order].
        [order] defines only the ordering of words in a bitvector, bits
        will always be in MSB first order. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_bits</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> bool <span class="tuareg-font-lock-module">Sequence.</span>t

    <span class="doc">(** {4 Arithmetic raised into [Or_error] monad }

        All binary integer operations are only well defined on operands
        with equal sizes.

        Module [Int] provides a set of integer operations that do not
        raise exceptions, but return values raised to an Or_error
        monad.

        Example:

        [Z.(i16 v1 + i16 v2 / int 16 v3)],

        or just:

        [Z.(!$v1 + !$v2 / !$v3)].
    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Int_err</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** [!$v] lifts [v] to an Or_error monad. It is, essentially, the
          same as [Ok v] *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(!</span>$<span class="tuareg-font-lock-operator">):</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** The following lifter will check that their operand has a
          corresponding width. *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">i1</span> <span class="tuareg-font-lock-operator">:</span>  t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">i4</span> <span class="tuareg-font-lock-operator">:</span>  t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">i8</span> <span class="tuareg-font-lock-operator">:</span>  t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">i16</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">i32</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">i64</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** [int w v] will be [Ok] if [v] has width [w] *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">int</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** [of_word_size w] creates a lifter for a specified word size
          [w], i.e. either [i64] or [i32]  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_word_size</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Word_size.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Integer</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Monad.Infix</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">'a t</span> <span class="tuareg-font-lock-operator">:=</span> 'a <span class="tuareg-font-lock-module">Or_error.</span>t
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Arithmetics that raise exceptions.

        This module exposes a common integer interface with
        operations not lifted into [Or_error] monad, but raising
        [Width] exception if operands sizes mismatch.
    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Int_exn</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Integer</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> t

    <span class="doc">(** Prefix trees for bitvectors.

        Bitvector comes with 4 predefined prefix trees:

        - [Trie.Big.Bits] - big endian prefix tree, where each
        token is a bit, and bitvector is tokenized from msb to lsb.

        - [Trie.Big.Byte] - big endian prefix tree, where each token
        is a byte, and bitvector is tokenized from most significant
        byte to less significant

        - [Trie.Little.Bits] - is a little endian bit tree.

        - [Trie.Little.Byte] - is a little endian byte tree.
    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Big</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bits</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span>  <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
        <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bytes</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
      <span class="tuareg-font-lock-governing">end</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Little</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bits</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
        <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bytes</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
      <span class="tuareg-font-lock-governing">end</span>
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Expose [endian] constructors to [Bap.Std] namespace  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">endian</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bitvector.</span>endian <span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-constructor">LittleEndian</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">BigEndian</span>
  <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare

  <span class="doc">(** Shortcut for bitvectors that represents words  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Word</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">module type of</span> <span class="tuareg-font-lock-module">Bitvector</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> word

  <span class="doc">(** Shortcut for bitvectors that represents addresses  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Addr</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-governing">module type of</span> <span class="tuareg-font-lock-module">Bitvector</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> addr
    <span class="doc">(** [memref ?disp ?index ?scale base] mimics a memory reference syntax
        in gas assembler,   [dis(base,index,scale)]
        assembler operation. It returns address at
        [base + index * scale + dis].

        @param disp stands for displacement and defaults to [0]
        @param index defaults for [0]
        @param scale defaults to [`r8]

        All operations are taken modulo {% $2^n$ %},
        where [n = bitwidth base].
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">memref</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?disp</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?index</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?scale</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> addr
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {2:bil BIL}  *)</span>

  <span class="doc">(** {3:bil_type BIL type system} *)</span>

  <span class="doc">(** The type of a BIL expression.
      Each BIL expression, should evaluate to one the following types. *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Type</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** type is either an immediate value of memory reference *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
      <span class="doc">(** [Imm n] - n-bit immediate   *)</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Imm</span> <span class="keyword">of</span> nat1
      <span class="doc">(** [Mem (a,t)] memory with a specifed addr_size *)</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Mem</span> <span class="keyword">of</span> addr_size <span class="tuareg-font-lock-operator">*</span> size
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> variants
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** short abbreviation for a type  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">typ</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Type.</span>t
  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** {3:type_cons Predefined type constructors} *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">bool_t</span>  <span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">reg8_t</span>  <span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">reg16_t</span> <span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">reg32_t</span> <span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">reg64_t</span> <span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">reg128_t</span><span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">reg256_t</span><span class="tuareg-font-lock-operator">:</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mem32_t</span> <span class="tuareg-font-lock-operator">:</span> size <span class="tuareg-font-lock-operator">-&gt;</span> typ
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mem64_t</span> <span class="tuareg-font-lock-operator">:</span> size <span class="tuareg-font-lock-operator">-&gt;</span> typ


  <span class="doc">(** {3:bil_var BIL variables}

      BIL variables are regular values. Every call to [create] will
      create a fresh variable.  *)</span>

  <span class="doc">(** bil variable  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">var</span>
  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** BIL variable  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Var</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> var

    <span class="doc">(** implements [Regular] interface  *)</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t

    <span class="doc">(** [create ?tmp name typ] creates a fresh new variable with
        assosiated [name] and type [typ]. The created variable is
        absolutely new, and is comparable to true only with itself.

        @param tmp designates variable is temporary, with whatever
        meaning assosiated to it by a caller.
    *)</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?tmp</span><span class="tuareg-font-lock-operator">:</span>bool <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> typ <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** [name var] returns a name assosiated with variable  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** [typ var] returns a type assosiated with variable  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">typ</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> typ

    <span class="doc">(** [is_tmp] true if variable is temporary  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_tmp</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">V1</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">r</span> <span class="tuareg-font-lock-operator">=</span> string <span class="tuareg-font-lock-operator">*</span> int <span class="tuareg-font-lock-operator">*</span> typ
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">serialize</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> r
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">deserialize</span> <span class="tuareg-font-lock-operator">:</span> r <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {3:bil_main Main BIL module}

      This module defines BIL language and is useful to write BIL
      programs and expressions.

      Example: {[Bil.([
          v := exp_of_op src lsr int32 1;
          r := exp_of_op src;
          s := int32 31;
          while_ (var v &lt;&gt; int32 0) [
            r := var r lsl int32 1;
            r := var r lor (var v land int32 1);
            v := var v lsr int32 1;
            s := var s - int32 1;
          ];
          dest := var r lsl var s;
        ]) cond]}

  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bil</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Types</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** Different forms of casting *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">cast</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">UNSIGNED</span> <span class="doc">(** 0-padding widening cast. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">SIGNED</span>   <span class="doc">(** Sign-extending widening cast. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">HIGH</span>     <span class="doc">(** Narrowning cast. Keeps the high bits. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">LOW</span>      <span class="doc">(** Narrowing cast. Keeps the low bits. *)</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="doc">(** Binary operations implemented in the IR *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">binop</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">PLUS</span>    <span class="doc">(** Integer addition. (commutative, associative) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">MINUS</span>   <span class="doc">(** Subtract second integer from first. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">TIMES</span>   <span class="doc">(** Integer multiplication. (commutative, associative) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">DIVIDE</span>  <span class="doc">(** Unsigned integer division. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">SDIVIDE</span> <span class="doc">(** Signed integer division. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">MOD</span>     <span class="doc">(** Unsigned modulus. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">SMOD</span>    <span class="doc">(** Signed modulus. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">LSHIFT</span>  <span class="doc">(** Left shift. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">RSHIFT</span>  <span class="doc">(** Right shift, fill with 0. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">ARSHIFT</span> <span class="doc">(** Right shift, sign extend. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">AND</span>     <span class="doc">(** Bitwise and. (commutative, associative) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">OR</span>      <span class="doc">(** Bitwise or. (commutative, associative) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">XOR</span>     <span class="doc">(** Bitwise xor. (commutative, associative) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">EQ</span>      <span class="doc">(** Equals. (commutative) (associative on booleans) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">NEQ</span>     <span class="doc">(** Not equals. (commutative) (associative on booleans) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">LT</span>      <span class="doc">(** Unsigned less than. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">LE</span>      <span class="doc">(** Unsigned less than or equal to. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">SLT</span>     <span class="doc">(** Signed less than. *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">SLE</span>     <span class="doc">(** Signed less than or equal to. *)</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="doc">(** Unary operations implemented in the IR *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">unop</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">NEG</span> <span class="doc">(** Negate. (2's complement) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">NOT</span> <span class="doc">(** Bitwise not. *)</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="tuareg-font-lock-governing">type</span> <span class="type">exp</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="doc">(** Load    (mem,  idx,  endian,  size) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Load</span>    <span class="keyword">of</span> exp <span class="tuareg-font-lock-operator">*</span> exp <span class="tuareg-font-lock-operator">*</span> endian <span class="tuareg-font-lock-operator">*</span> size
        <span class="doc">(** Store   (mem,  idx,  val,  endian,  size) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Store</span>   <span class="keyword">of</span> exp <span class="tuareg-font-lock-operator">*</span> exp <span class="tuareg-font-lock-operator">*</span> exp <span class="tuareg-font-lock-operator">*</span> endian <span class="tuareg-font-lock-operator">*</span> size
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">BinOp</span>   <span class="keyword">of</span> binop <span class="tuareg-font-lock-operator">*</span> exp <span class="tuareg-font-lock-operator">*</span> exp
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">UnOp</span>    <span class="keyword">of</span> unop <span class="tuareg-font-lock-operator">*</span> exp
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Var</span>     <span class="keyword">of</span> var
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Int</span>     <span class="keyword">of</span> word
        <span class="doc">(** Cast to a new type *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Cast</span>    <span class="keyword">of</span> cast <span class="tuareg-font-lock-operator">*</span> nat1 <span class="tuareg-font-lock-operator">*</span> exp
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Let</span>     <span class="keyword">of</span> var <span class="tuareg-font-lock-operator">*</span> exp <span class="tuareg-font-lock-operator">*</span> exp
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Unknown</span> <span class="keyword">of</span> string <span class="tuareg-font-lock-operator">*</span> typ
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Ite</span>     <span class="keyword">of</span> exp <span class="tuareg-font-lock-operator">*</span> exp <span class="tuareg-font-lock-operator">*</span> exp
        <span class="doc">(** Extract hbits to lbits of e (Reg type) *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Extract</span> <span class="keyword">of</span> nat1 <span class="tuareg-font-lock-operator">*</span> nat1 <span class="tuareg-font-lock-operator">*</span> exp
        <span class="doc">(** Concat two reg expressions together *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Concat</span>  <span class="keyword">of</span> exp <span class="tuareg-font-lock-operator">*</span> exp
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="tuareg-font-lock-governing">type</span> <span class="type">stmt</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="doc">(** Assign the value on the right to the var on the left *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Move</span>    <span class="keyword">of</span> var <span class="tuareg-font-lock-operator">*</span> exp
        <span class="doc">(** Jump to a address *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Jmp</span>     <span class="keyword">of</span> exp
        <span class="doc">(** Statement with semantics not expressible in BIL *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Special</span> <span class="keyword">of</span> string
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">While</span>   <span class="keyword">of</span> exp <span class="tuareg-font-lock-operator">*</span> stmt list
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">If</span>      <span class="keyword">of</span> exp <span class="tuareg-font-lock-operator">*</span> stmt list <span class="tuareg-font-lock-operator">*</span> stmt list
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">CpuExn</span>  <span class="keyword">of</span> int
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="tuareg-font-lock-governing">end</span>
    <span class="tuareg-font-lock-governing">open </span><span class="tuareg-font-lock-module">Types</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-governing">module type of</span> <span class="tuareg-font-lock-module">Types</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">cast</span> <span class="tuareg-font-lock-operator">=</span> cast
                                  <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">binop</span> <span class="tuareg-font-lock-operator">=</span> binop
                                  <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">unop</span> <span class="tuareg-font-lock-operator">=</span> unop
                                  <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">exp</span> <span class="tuareg-font-lock-operator">=</span> exp
                                  <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">stmt</span> <span class="tuareg-font-lock-operator">=</span> stmt
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> stmt list
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp


    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Printable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t

    <span class="doc">(** Infix operators  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Infix</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(:=)</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt

      <span class="doc">(** {5 Arithmetic operations} *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">+</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">-</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">/</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">/</span>$ <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">mod</span> <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">%</span>$ <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp

      <span class="doc">(** {5 Bit operations} *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">lsl</span> <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">lsr</span> <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">asr</span> <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">land)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">lor</span> <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">lxor)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">lnot</span>    <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp

      <span class="doc">(** {5 Equality tests} *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&lt;&gt;</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&lt;</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&gt;</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&lt;=</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&gt;=</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&lt;</span>$ <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&gt;</span>$ <span class="tuareg-font-lock-operator">)</span>  <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&lt;=</span>$ <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">&gt;=</span>$ <span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp

      <span class="doc">(** {5 Misc operations} *)</span>
      <span class="doc">(** [a ^ b] contatenate [a] and [b]  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(</span> <span class="tuareg-font-lock-operator">^</span> <span class="tuareg-font-lock-operator">)</span>   <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">end</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-governing">module type of</span> <span class="tuareg-font-lock-module">Infix</span>

    <span class="doc">(** {5 Functional constructors}  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">move</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">jmp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">special</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> stmt
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">while_</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">if_</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">cpuexn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> stmt
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">unsigned</span> <span class="tuareg-font-lock-operator">:</span> cast
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">signed</span> <span class="tuareg-font-lock-operator">:</span> cast
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">high</span> <span class="tuareg-font-lock-operator">:</span> cast
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">low</span> <span class="tuareg-font-lock-operator">:</span> cast
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">plus</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">minus</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">times</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">divide</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sdivide</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">modulo</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">smodulo</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lshift</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rshift</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">arshift</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">bit_and</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">bit_or</span>  <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">bit_xor</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">eq</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">neq</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lt</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">le</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">slt</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sle</span> <span class="tuareg-font-lock-operator">:</span> binop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">neg</span> <span class="tuareg-font-lock-operator">:</span> unop
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">not</span> <span class="tuareg-font-lock-operator">:</span> unop
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">load</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">store</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">binop</span> <span class="tuareg-font-lock-operator">:</span> binop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">unop</span> <span class="tuareg-font-lock-operator">:</span> unop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">var</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">int</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Bitvector.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">cast</span> <span class="tuareg-font-lock-operator">:</span> cast <span class="tuareg-font-lock-operator">-&gt;</span> nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">let_</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">unknown</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> typ <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">ite</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">if_</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">then_</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">else_</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">extract</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">hi</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">lo</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">concat</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp

    <span class="doc">(** {4:bil_visitor AST Visitors}.

        [visitor] folds arbitrary value over the AST, [finder] is a
        visitor, that can prematurely finish the traversal, [mapper]
        that maps AST, allowing limited transformation of its
        structure.  *)</span>

    <span class="doc">(** All visitors provides some information about the current
        position of the visitor *)</span>
    <span class="tuareg-font-lock-governing">class</span> <span class="function-name">state</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">object</span>
      <span class="doc">(** the stack of stmts that was already visited, with the last on
          the top. Not including the currently visiting stmt. *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">preds</span> <span class="tuareg-font-lock-operator">:</span> stmt list

      <span class="doc">(** stmts that are not yet visited  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">succs</span> <span class="tuareg-font-lock-operator">:</span> stmt list

      <span class="doc">(** a stack of stmts that are parents for the currently visiting
          entity. The top one is the one that we're currently visiting. *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">stmts_stack</span> <span class="tuareg-font-lock-operator">:</span> stmt list

      <span class="doc">(** a stack of expr, that are parents for the currenly visiting
          expression *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">exps_stack</span>  <span class="tuareg-font-lock-operator">:</span> exp  list

      <span class="doc">(** is [true] if we're visiting expression that is a jump target *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">in_jmp</span> <span class="tuareg-font-lock-operator">:</span> bool

      <span class="doc">(** is [true] if we're visiting expression that is on the left or
          right side of the assignment. *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">in_move</span> <span class="tuareg-font-lock-operator">:</span> bool

      <span class="doc">(** is [true] if currently visiting expression or statement is
          executed under condition.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">under_condition</span> <span class="tuareg-font-lock-operator">:</span> bool
      <span class="doc">(** is [true] if currently visiting expression or statement is
          executed under loop.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">in_loop</span> <span class="tuareg-font-lock-operator">:</span> bool
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Visitor.
        Visits AST providing lots of hooks.

        For each AST constructor [C] the visitor provides three methods:
        [enter_C], [visit_C], [leave_C]. The default implementation for
        [enter_C] and [leave_C] is to return its argument. The default
        implementation for [visit_C] is the following:
        1. call [enter_C]
        2. visit all children
        3. call [leave_C].

        It is recommended to override [enter_C] method if you only need
        to visit [C] constructor without changing a way you're visiting
        the tree.

        For example, to collect all resolved jumps one could write the
        following function:

        {[
          let collect_calls bil = (object(self)
            inherit [Word.t list] visitor
            method! enter_int x js = if in_jmp then x :: js else js
          end)#run bil []
        ]}

         The default entry point of the visitor is method [run], but
         you can use any other method as well, for example, if you do
         not have a statement at all and want to visit expression.
    *)</span>
    <span class="tuareg-font-lock-governing">class</span><span class="type"> </span><span class="tuareg-font-lock-operator">[</span><span class="type">'a</span><span class="tuareg-font-lock-operator">]</span> <span class="function-name">visitor</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">object</span>
      <span class="tuareg-font-lock-governing">inherit</span> state
      <span class="doc">(** Default entry point *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">run</span> <span class="tuareg-font-lock-operator">:</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** {6 Statements}  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_stmt</span> <span class="tuareg-font-lock-operator">:</span> stmt <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_stmt</span> <span class="tuareg-font-lock-operator">:</span> stmt <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_stmt</span> <span class="tuareg-font-lock-operator">:</span> stmt <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Move(var,exp)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_move</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_move</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_move</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Jmp exp]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_jmp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_jmp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_jmp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [While (cond,bil)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_while</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_while</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_while</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [If (cond,yes,no)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_if</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_if</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_if</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [CpuExn n]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_cpuexn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_cpuexn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_cpuexn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Special string]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_special</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_special</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_special</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** {6 Expressions}  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_exp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_exp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_exp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Load (src,addr,endian,size)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_load</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_load</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_load</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Store (dst,addr,src,endian,size)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_store</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_store</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_store</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [BinOp (op,e1,e2)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_binop</span> <span class="tuareg-font-lock-operator">:</span> binop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_binop</span> <span class="tuareg-font-lock-operator">:</span> binop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_binop</span> <span class="tuareg-font-lock-operator">:</span> binop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Unop (op,e)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_unop</span> <span class="tuareg-font-lock-operator">:</span> unop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_unop</span> <span class="tuareg-font-lock-operator">:</span> unop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_unop</span> <span class="tuareg-font-lock-operator">:</span> unop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Cast(kind,size,e)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_cast</span> <span class="tuareg-font-lock-operator">:</span> cast <span class="tuareg-font-lock-operator">-&gt;</span> nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_cast</span> <span class="tuareg-font-lock-operator">:</span> cast <span class="tuareg-font-lock-operator">-&gt;</span> nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_cast</span> <span class="tuareg-font-lock-operator">:</span> cast <span class="tuareg-font-lock-operator">-&gt;</span> nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Let (v,exp,body)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_let</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">body</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_let</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">body</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_let</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">body</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Ite (cond,yes,no)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_ite</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_ite</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_ite</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Extract (hi,lo,e)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_extract</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">hi</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">lo</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_extract</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">hi</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">lo</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_extract</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">hi</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">lo</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Concat(e1,e2)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_concat</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_concat</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_concat</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** {6 Leafs} *)</span>
      <span class="doc">(** [Int w]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_int</span> <span class="tuareg-font-lock-operator">:</span> word <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_int</span> <span class="tuareg-font-lock-operator">:</span> word <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_int</span> <span class="tuareg-font-lock-operator">:</span> word <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Var v]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_var</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_var</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_var</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a

      <span class="doc">(** [Unknown (str,typ)]  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">enter_unknown</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> typ <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">visit_unknown</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> typ <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">leave_unknown</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> typ <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a
    <span class="tuareg-font-lock-governing">end</span>


    <span class="doc">(** A visitor with shortcut.
        Finder is a specialization of a visitor, that uses [return] as its
        folding argument. At any time you can stop the traversing by
        calling [return] function of the provided argument (which is by
        itself is a record with one field - a function accepting argument
        of type ['a option]).

        For example, the following function will check whether [x]
        variable is referenced in the provided scope.
        {[
          let is_referenced x = find (object(self)
              inherit [unit] finder
              method! enter_var y cc =
                if Var.(x = y) then cc.return (Some ()); cc
            end)
        ]}

    *)</span>
    <span class="tuareg-font-lock-governing">class</span><span class="type"> </span><span class="tuareg-font-lock-operator">[</span><span class="type">'a</span><span class="tuareg-font-lock-operator">]</span> <span class="function-name">finder</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">object</span>
      <span class="tuareg-font-lock-governing">inherit</span> <span class="tuareg-font-lock-operator">[</span>'a option return<span class="tuareg-font-lock-operator">]</span> visitor
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">find</span> <span class="tuareg-font-lock-operator">:</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a option
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** AST transformation.
        mapper allows one to map AST, performing some limited
        amount of transformations on it. Mapper provides extra
        flexibility by mapping [stmt] to [stmt list], thus allowing
        to remove statements from the output (by mapping to empty list) or
        to map one statement to several. This is particularly useful when
        you map [if] or [while] statements.
    *)</span>
    <span class="tuareg-font-lock-governing">class</span> <span class="function-name">mapper</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">object</span>
      <span class="tuareg-font-lock-governing">inherit</span> state

      <span class="doc">(** Default entry point.
          But again, you can use any method as an entry  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">run</span> <span class="tuareg-font-lock-operator">:</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

      <span class="doc">(** {3 Statements}  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_stmt</span> <span class="tuareg-font-lock-operator">:</span> stmt <span class="tuareg-font-lock-operator">-&gt;</span> stmt list
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_move</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_jmp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_while</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_if</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_cpuexn</span> <span class="tuareg-font-lock-operator">:</span> int <span class="tuareg-font-lock-operator">-&gt;</span> stmt list
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_special</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

      <span class="doc">(** {3 Expressions}  *)</span>
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_exp</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_load</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_store</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">mem</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">addr</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_binop</span> <span class="tuareg-font-lock-operator">:</span> binop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_unop</span> <span class="tuareg-font-lock-operator">:</span> unop <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_cast</span> <span class="tuareg-font-lock-operator">:</span> cast <span class="tuareg-font-lock-operator">-&gt;</span> nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_let</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">exp</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">body</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_ite</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">cond</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">yes</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">no</span><span class="tuareg-font-lock-operator">:</span>exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_extract</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">hi</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">lo</span><span class="tuareg-font-lock-operator">:</span>nat1 <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_concat</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_int</span> <span class="tuareg-font-lock-operator">:</span> word <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_var</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_sym</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> var
      <span class="tuareg-font-lock-governing">method</span> <span class="function-name">map_unknown</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> typ <span class="tuareg-font-lock-operator">-&gt;</span> exp
    <span class="tuareg-font-lock-governing">end</span>


    <span class="doc">(** [find_map finder bil] search in the BIL   *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_map</span> <span class="tuareg-font-lock-operator">:</span> 'a <span class="tuareg-font-lock-operator">#</span>finder <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a option

    <span class="doc">(** [find finder bil] returns true if [finder] finds
        something. Note a better name would be [exists] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find</span> <span class="tuareg-font-lock-operator">:</span> unit <span class="tuareg-font-lock-operator">#</span>finder <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [iter visitor bil] apply a visitor for each node of a BIL
        forest. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">iter</span> <span class="tuareg-font-lock-operator">:</span> unit <span class="tuareg-font-lock-operator">#</span>visitor <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="doc">(** [fold visitor ~init bil] folds visitor over BIL, passing init
        value through the tree nodes.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">fold</span> <span class="tuareg-font-lock-operator">:</span> 'a <span class="tuareg-font-lock-operator">#</span>visitor <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> 'a

    <span class="doc">(** [map mapper bil] map or transform BIL program.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">map</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">#</span>mapper <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

    <span class="doc">(** [is_referenced x p] is [true] if [x] is referenced in some expression or
        statement in program [p]:
        BUG: currently occurrences on the left hand side of the
        assignment operator is considered a reference too.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_referenced</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_assigned x p] is [true] if there exists such [Move]
        statement, that [x] occures on the left side of it. If [strict]
        is true, then only unconditional assignments. By default,
        [strict] is [false] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_assigned</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?strict</span><span class="tuareg-font-lock-operator">:</span>bool <span class="tuareg-font-lock-operator">-&gt;</span> var <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [prune_unreferenced p] remove all assignments to variables that
        are not used in the program [p] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">prune_unreferenced</span> <span class="tuareg-font-lock-operator">:</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

    <span class="doc">(** [normalize_negatives p] transform [x + y] to [x - abs(y)] if [y &lt; 0] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">normalize_negatives</span> <span class="tuareg-font-lock-operator">:</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

    <span class="doc">(** [substitute x y p] substitutes each occurrence of expression [x] by
        expression [y] in program [p] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">substitute</span> <span class="tuareg-font-lock-operator">:</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list


    <span class="doc">(** [substitute_var x y p] substitutes all occurences of variable [x]
        by expression [y] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">substitute_var</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> exp <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

    <span class="doc">(** [fold_consts] evaluate constant expressions.
        Note: this function performs only one step, and has no loops,
        it is supposed to be run using a fixpoint combinator.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">fold_consts</span> <span class="tuareg-font-lock-operator">:</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list

    <span class="doc">(** [constant_folder] is a class that implements the [fold_consts]  *)</span>
    <span class="tuareg-font-lock-governing">class</span> <span class="function-name">constant_folder</span> <span class="tuareg-font-lock-operator">:</span> mapper

    <span class="doc">(** [fixpoint f] applies transformation [f] until fixpoint is
        reached. If the transformation orbit contains non-trivial cycles,
        then the transformation will stop at an arbitrary point of a
        cycle. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">fixpoint</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>stmt list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list<span class="tuareg-font-lock-operator">)</span>

    <span class="doc">(** Tries on BIL.

        Bil provides two prefix tries trees.

        The default one is not normalized and will compare bil statements
        literally. This means that comparison is sensitive to variable
        names and immediate values. Depending on your context it may be
        find or not. For example, two [SP] variables may compare as different
        if one of them was obtained from different compilation (and met
        the other one through some persistant storage, e.g., file on hard
        disk). Moreover, BIL obtained from different lifters will have
        different names for the same registers. All this issues are
        addressed in normalized [Trie].
    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">normalized_bil</span>

      <span class="doc">(** [normalize ?subst bil] normalize BIL. If [subst] is provided,
          then substitute each occurence of the fst expression to the
          snd expression before the normalization. The effect of
          normalization is the following:

          1. All immediate values are compared equal
          2. All variables are compared nominally
          3. BIL is simplified to reduce the syntactic differences
          (but the comparison is still syntactic, and (x + 2) will
          be compared differently to (2 + x).
      *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">normalize</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?subst</span><span class="tuareg-font-lock-operator">:(</span>exp <span class="tuareg-font-lock-operator">*</span> exp<span class="tuareg-font-lock-operator">)</span> list <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-operator">-&gt;</span> normalized_bil

      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Normalized</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> normalized_bil
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> stmt list
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** [Regular] interface for BIL expressions *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Exp</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bil.</span>exp
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pp_adt</span> <span class="tuareg-font-lock-operator">:</span> t printer
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** [Regular] interface for BIL statements  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Stmt</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bil.</span>stmt
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pp_adt</span> <span class="tuareg-font-lock-operator">:</span> t printer
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {2:arch A type to represent target architecture}  *)</span>

  <span class="doc">(** Architecture  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Arch</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">x86</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`x86</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`x86_64</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">arm</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`arm</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`armeb</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`armv4</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`armv4t</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`armv5</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`armv6</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`armv7</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`thumb</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`thumbeb</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">aarch64</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`aarch64</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`aarch64_be</span>
    <span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">ppc</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ppc</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ppc64</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ppc64le</span>
    <span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">mips</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`mips</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`mipsel</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`mips64</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`mips64el</span>
    <span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">sparc</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`sparc</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`sparcv9</span>
    <span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">nvptx</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`nvptx</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`nvptx64</span>
    <span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">hexagon</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span><span class="tuareg-font-lock-constructor">`hexagon</span><span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">r600</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span><span class="tuareg-font-lock-constructor">`r600</span><span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">systemz</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span><span class="tuareg-font-lock-constructor">`systemz</span><span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">xcore</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span><span class="tuareg-font-lock-constructor">`xcore</span><span class="tuareg-font-lock-operator">]</span>
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> aarch64
      <span class="tuareg-font-lock-operator">|</span> arm
      <span class="tuareg-font-lock-operator">|</span> hexagon
      <span class="tuareg-font-lock-operator">|</span> mips
      <span class="tuareg-font-lock-operator">|</span> nvptx
      <span class="tuareg-font-lock-operator">|</span> ppc
      <span class="tuareg-font-lock-operator">|</span> r600
      <span class="tuareg-font-lock-operator">|</span> sparc
      <span class="tuareg-font-lock-operator">|</span> systemz
      <span class="tuareg-font-lock-operator">|</span> x86
      <span class="tuareg-font-lock-operator">|</span> xcore
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> variants

    <span class="doc">(** [of_string s] will try to be clever and to capture all
        commonly known synonyms, e.g., [of_string "i686"] will
        work    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_string</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> t option

    <span class="doc">(** [addr_size arch] returns an address size for a given [arch]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_size</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr_size

    <span class="doc">(** [endian arch] returns a word endianness of the [arch]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">endian</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> endian

    <span class="doc">(** [arch] type implements [Regular]  interface  *)</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** architecture  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">arch</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Arch.</span>t
  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp


  <span class="doc">(** {2:tag Extensible variants}

      This module creates an extensible variant type, that resembles
      extensible variant types, introduced in 4.02, but even more safe.

      To extend variant type with a new constructor, use

      [Tag.register constructor_name sexp_of_constructor], where

      constructor name can be any name, and can even clash with previous
      definitions it is guaranteed, that you will receive a new
      representation of the constructor, every time you're calling this
      function even if parameters are the same. The returned value is
      supposed to be exposed in a module, for later use in other
      modules, c.f., [Image] module defines three constructors:
      - [Image.symbol] for Image symbols, that basically can be seen as
      [Image.Symbol of sym]
      - [Image.section] for image sections;
      - [Image.region] for other named image memory regions.

  *)</span>

  <span class="doc">(** Tag module  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Tag</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** Tag constructor of type ['a]  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span>   <span class="keyword">with</span> sexp_of

    <span class="doc">(** a value injected into extensible variant  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">value</span> <span class="keyword">with</span> sexp_of

    <span class="doc">(** [register name sexp] creates a new variant constructor, i.e.,
        a new branch in a variant type. This function has no side-effects,
        it just returns a witness of a new constructor, that can be later
        used for storing into [value] and extracting from it. This
        witness should be shared between user and creator of the value *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Sexp.</span>t<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [create cons x] creates a value using constructor [cons] and
        argument [x] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> value

    <span class="doc">(** [value cons] extracts a value associated with a constructor [cons]
        (Essentially, performs a pattern match on the specified variant
        branch) *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">value</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> value <span class="tuareg-font-lock-operator">-&gt;</span> 'a option

    <span class="doc">(** [is cons v] true if value [v] was constructed with constructor
        [cons] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is</span>  <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> value <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [tagname value] returns a constructor name of the [value]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">tagname</span> <span class="tuareg-font-lock-operator">:</span> value <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** [name cons] returns a name of a constructor.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Printable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> value
  <span class="tuareg-font-lock-governing">end</span>


  <span class="doc">(** Lazy sequence  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Seq</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">Sequence.</span>t
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-governing">module type of</span> <span class="tuareg-font-lock-module">Sequence</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">'a t</span> <span class="tuareg-font-lock-operator">:=</span> 'a t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_array</span> <span class="tuareg-font-lock-operator">:</span> 'a array <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">cons</span> <span class="tuareg-font-lock-operator">:</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_empty</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> bool
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** type abbreviation for ['a Sequence.t]  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">'a seq</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">Seq.</span>t

  <span class="doc">(** [x ^:: xs] is a consing operator for sequences  *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(^::)</span> <span class="tuareg-font-lock-operator">:</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a seq <span class="tuareg-font-lock-operator">-&gt;</span> 'a seq

  <span class="doc">(** Access to BAP configuration variables  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Config</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pkg_version</span> <span class="tuareg-font-lock-operator">:</span> string
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {1:type_abbr Type abbreviations}  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">bil</span>   <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bil.</span>t       <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">type</span> <span class="type">binop</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bil.</span>binop   <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">type</span> <span class="type">cast</span>  <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bil.</span>cast    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">type</span> <span class="type">exp</span>   <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Exp.</span>t       <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">type</span> <span class="type">stmt</span>  <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Stmt.</span>t      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">type</span> <span class="type">unop</span>  <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bil.</span>unop    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">type</span> <span class="type">value</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Tag.</span>value   <span class="keyword">with</span> sexp_of
  <span class="tuareg-font-lock-governing">type</span> <span class="type">'a tag</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">Tag.</span>t     <span class="keyword">with</span> sexp_of

  <span class="doc">(** {1:image Memory model}

      This library provides types that represents program as a memory
      object. This includes:

      - [mem] - a contiguous array of bytes, indexed with absolute
       addresses.
      - [table] - a mapping from a memory region to arbitrary entities.
      - [image] - a program loaded to memory, as it is viewed by
       system loader and OS.
      - [symbol] - some named (not strictly contiguous) part of the
       image
      - [section] - some contiguous part of the [image] that has
       specific access flags.
  *)</span>


  <span class="doc">(** an image loaded into memory  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">image</span>

  <span class="doc">(** opaque memory  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">mem</span> <span class="keyword">with</span> sexp_of

  <span class="doc">(** a table from memory to ['a]  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">'a table</span> <span class="keyword">with</span> sexp_of

  <span class="doc">(** interval trees from memory regions to ['a] *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">'a memmap</span> <span class="keyword">with</span> sexp_of

  <span class="doc">(** Iterators lifted into monad  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Memory_iterators</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a m</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">fold</span>     <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'b <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>word <span class="tuareg-font-lock-operator">-&gt;</span> 'b <span class="tuareg-font-lock-operator">-&gt;</span> 'b m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">iter</span>     <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>word <span class="tuareg-font-lock-operator">-&gt;</span> unit m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">foldi</span>    <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'b <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> 'b <span class="tuareg-font-lock-operator">-&gt;</span> 'b m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">iteri</span>    <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> unit m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">exists</span>   <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> bool m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> bool m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">for_all</span>  <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> bool m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> bool m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">count</span>    <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> bool m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> int m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_if</span>  <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> bool m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> word option m
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_map</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-operator">-&gt;</span> 'a option m<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>
      'a option m
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {2:memory Access to memory regions}  *)</span>

  <span class="doc">(** Interface to [mem] type  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Memory</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> mem <span class="keyword">with</span> sexp_of

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span>
      <span class="tuareg-font-lock-operator">:</span> <span class="constant">?pos</span><span class="tuareg-font-lock-operator">:</span>int                    <span class="doc">(** defaults to [0]  *)</span>
      <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?len</span><span class="tuareg-font-lock-operator">:</span>int                    <span class="doc">(** defaults to full length  *)</span>
      <span class="tuareg-font-lock-operator">-&gt;</span> endian
      <span class="tuareg-font-lock-operator">-&gt;</span> addr
      <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Bigstring.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_file</span> <span class="tuareg-font-lock-operator">:</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [view word_size ~from ~words mem] returns a new memory
        that represents the specified region of memory [mem]. [copy]
        function performs deep copy.

        @param addr  defaults [min_addr mem]
        @param words defaults to the end of the memory region.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">view</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?from</span><span class="tuareg-font-lock-operator">:</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?words</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [range mem a0 a1] returns a view on [mem] starting from
        address [a0] and ending at [a1], bounds inclusive   *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">range</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [merge m1 m2] takes two memory regions, that either intersects or
        share edges (i.e., difference between [min_addr] of one of the
        blocks and [max_addr] of another is less then or equal to one, and
        returns memory blocks that spans memory starting from the address
        {[min (min_addr m1) (min_addr m2)]} and ending with address
        {[max (max_addr m1) (max_addr m2)]}.

        Will return an error, if either the above state precondition
        doesn't hold, or if this two memory blocks doesn't share the same
        underlying memory (i.e., bases), or if they have different
        endianness.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">merge</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [first_byte m] returns first byte of [m] as a memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">first_byte</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t
    <span class="doc">(** [last_byte m] returns last byte of [m] as a memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">last_byte</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="doc">(** returns the order of bytes in a word  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">endian</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> endian

    <span class="doc">(** [get word_size mem addr] reads memory value from the specified
        address. [word_size] default to [`r8] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">get</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?disp</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?index</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?scale</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?addr</span><span class="tuareg-font-lock-operator">:</span>addr <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [m^n] dereferences a byte at address [n]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(^)</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> word <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [m^.n] dereferences a byte at address [n]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="tuareg-font-lock-operator">(^!)</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> word

    <span class="doc">(** [{max,min}_addr] function specify upper and lower bounds of the memory *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">max_addr</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">min_addr</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr

    <span class="doc">(** [length] returns the length of the memory in bytes *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">length</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="doc">(** [contains mem addr] returns true if [mem] contains address [addr]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">contains</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [compare_with mem addr] compares memory with [addr]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">compare_with</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`addr_is_inside</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`addr_is_below</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`addr_is_above</span>
      <span class="tuareg-font-lock-operator">]</span>

    <span class="doc">(** A set of low level input operations.
        Note: it is more effective to use above head iterators, instead
        of this low level interface, since iterators do not need to check
        every memory access.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Input</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** [reader mem ~pos_ref] defines a set of functions with a
          common interface. Each function accepts a memory [mem] and a
          [pos_ref] - a reference to a address that should be read. This
          reference will be updated for the amount of bytes that was
          actually read.

          @return a word lifted into a monad.
      *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">'a reader</span> <span class="tuareg-font-lock-operator">=</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">pos_ref</span> <span class="tuareg-font-lock-operator">:</span> addr <span class="builtin">ref</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">word</span>   <span class="tuareg-font-lock-operator">:</span> <span class="constant">word_size</span><span class="tuareg-font-lock-operator">:</span>size <span class="tuareg-font-lock-operator">-&gt;</span> word reader
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">int8</span>   <span class="tuareg-font-lock-operator">:</span> word reader
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">uint8</span>  <span class="tuareg-font-lock-operator">:</span> word reader
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">int16</span>  <span class="tuareg-font-lock-operator">:</span> word reader
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">uint16</span> <span class="tuareg-font-lock-operator">:</span> word reader
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">int32</span>  <span class="tuareg-font-lock-operator">:</span> word reader
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">int64</span>  <span class="tuareg-font-lock-operator">:</span> word reader
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** {6 Printing and outputing}  *)</span>

    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Printable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t

    <span class="doc">(** [hexdump t out] outputs hexdump (as per [hexdump -C]) of the
        memory to formatter [out]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">hexdump</span><span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** a set of iterators, with identity monad.  *)</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Memory_iterators</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
                              <span class="tuareg-font-lock-governing">and type</span> <span class="type">'a m</span> <span class="tuareg-font-lock-operator">=</span> 'a

    <span class="doc">(** iterators lifter to the Or_error monad  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">With_error</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Memory_iterators</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
                                          <span class="tuareg-font-lock-governing">and type</span> <span class="type">'a m</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** lifts iterators to monad [M]  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Make_iterators</span><span class="tuareg-font-lock-operator">(</span><span class="variable-name"> M </span><span class="tuareg-font-lock-operator">:</span><span class="variable-name"> </span><span class="tuareg-font-lock-module">Monad.S</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">)</span><span class="variable-name">
      </span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Memory_iterators</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
                          <span class="tuareg-font-lock-governing">and type</span> <span class="type">'a m</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">M.</span>t


    <span class="doc">(** {6 Interfacing with C}

        The following interfaces is supposed to be used only for the
        purposes of exposing memory to c programs. *)</span>

    <span class="doc">(** [to_buffers mem] creates a buffer representing the memory [mem].
        It is not specified whether the returned buffer has some sharing
        with underlying implementation. In other words the returned buffer
        shouldn't be modified.

        Since it is not guaranteed that memory is contiguous, a sequence of
        buffers is returned, with each buffer representing a contiguous
        part of memory.

    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_buffer</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Bigsubstring.</span>t


    <span class="doc">(** Tries over memory  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">R8</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">R16</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">R32</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">R64</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> t
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Table.

      Tables are used to partition memory region into a set of
      non-intersecting areas. Each area is assosiated with arbitrary
      value of type ['a] bound to the type of the table.

      All operations over tables are purely applicative, i.e. there is
      no observable side-effects. Although, they employ some kind of
      caching underneath the hood, so that they perform better if
      they're  build once and used many times.

      Tables can be also linked. For example, if you have two tables
      mapping the same memory region to a different sets of values, you
      can create a mapping from one set of values to another. See [link]
      function for mode details.
  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Table</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span> <span class="tuareg-font-lock-operator">=</span> 'a table <span class="keyword">with</span> sexp_of
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a hashable</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">Hashtbl.Hashable.</span>t

    <span class="doc">(** creates an empty table  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">empty</span> <span class="tuareg-font-lock-operator">:</span> 'a t

    <span class="doc">(** creates a table containing one bindins  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">singleton</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [add table mem v] returns a new table with added mapping from a
        mem region [mem] to a data value [v] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">add</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a t <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** returns a new table with all mappings from the mem region
        [mem] removed *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">remove</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [change tab mem ~f] function [f] is applied to a set of all memory
        regions that intersects with [mem]. If function [f] evaluates to
        [`remap (new_mem,y)] then all memory regions that have had
        intersections with [mem] will be removed from the new map and
        memory region [new_mem] will be mapped to [y]. If [f] evaluates to
        [`remove], then the regions will be removed, and nothing will be
        added. If it evaluates to [`skip] then the table will be returned
        unchanged.  Intersections are passed sorted in an ascending order.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">change</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:((</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> seq <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`rebind</span> <span class="keyword">of</span> mem <span class="tuareg-font-lock-operator">*</span> 'a         <span class="doc">(** add new mapping instead  *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`update</span> <span class="keyword">of</span> <span class="tuareg-font-lock-operator">((</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'a<span class="tuareg-font-lock-operator">)</span> <span class="doc">(** update all bindings      *)</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`remove</span>                    <span class="doc">(** remove all bindings      *)</span>
        <span class="tuareg-font-lock-operator">|</span> `<span class="builtin">ignore</span><span class="tuareg-font-lock-operator">])</span>                  <span class="doc">(** don't touch anything     *)</span>
      <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [length table] returns a number of entries in the table  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">length</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="doc">(** [find table mem] finds an element mapped to the memory region [mem]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a option

    <span class="doc">(** [find_addr tab addr] finds a memory region that contains a
        specified [addr]   *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_addr</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** [intersections table mem] returns all mappings in a [table] that
        have intersections with [mem] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">intersections</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> seq

    <span class="doc">(** [fold_intersections table mem] folds over all regions
        intersecting with [mem] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">fold_intersections</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'b <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b

    <span class="doc">(** [has_intersections tab mem] is true iff some portion of [mem] is
        is already mapped in [tab]. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">has_intersections</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [mem table mem] is true if table contains mem region [mem]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mem</span> <span class="tuareg-font-lock-operator">:</span> _ t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [next table elt] returns element next to [elt], if any *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">next</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** [next table elt] returns element preceding to [elt], if any *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">prev</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** [min tab] return the lowest binding  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">min</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** [max tab] return the highest binding  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">max</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** Relation multiplicity.
        For a given type ['a] creates type ['m]
    *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-operator">(</span><span class="type">'a</span><span class="tuareg-font-lock-operator">,</span><span class="type">'m</span><span class="tuareg-font-lock-operator">)</span><span class="type"> r</span>

    <span class="doc">(** {4 Table relations}  *)</span>

    <span class="doc">(** [0..*]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">many</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span> 'a seq<span class="tuareg-font-lock-operator">)</span> r

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">at_least_one</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span> 'a <span class="tuareg-font-lock-operator">*</span> 'a seq<span class="tuareg-font-lock-operator">)</span> r

    <span class="doc">(** [1..1]     *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">one</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span> 'a<span class="tuareg-font-lock-operator">)</span> r

    <span class="doc">(** [0..1]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">maybe_one</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span> 'a option<span class="tuareg-font-lock-operator">)</span> r


    <span class="doc">(** [link relation t t1 t2] takes two tables and returns a mapping
        from elements of one table to elements of other table.

        Parameter [t] specifies a [hashable] typeclass of the type ['a]. If
        type ['a] implements [Hashable] interface, then you can obtain it
        with [hashable] function, e.g. [Int.hashable] with return the
        appropriate type class. If ['a] doesn't implement [Hashable], then
        it can be implemented manually.

        Relation specifies the multiplicity of the relation between
        entities from table [t1] to entities from table [t2], and is
        summarized below:

        - [one_to_many] means that a particular region from table [t1] can
        span several memory regions from table [t2]. Example: segments
        to symbols relation.

        - [one_to_one] means that for each value of type ['a] there is
        exactly one value of type ['b]. This relation should be used with
        caution, since it is quantified over _all_ values of type
        ['a]. Indeed, it should be used only for cases, when it can be
        guaranteed, that it is impossible to create such value of type
        ['b], that has no correspondence in table [t2]. Otherwise,
        [one_to_maybe_one] relation should be used. Example: llvm
        machine code to assembly string relation.

        - [one_to_maybe_one] means that for each value in table [t1] there
        exists at most one value in table [t2]. Example: function to
        symbol relation.


        {5 Examples}
        {[
          let mc_of_insn  = link one_to:one Insn.hashable insns mcs
          let syms_of_sec = link one_to:many Sec.hashable  secs syms
        ]} *)</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">link</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">one_to</span><span class="tuareg-font-lock-operator">:(</span>'b<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> r <span class="tuareg-font-lock-operator">-&gt;</span> 'a hashable <span class="tuareg-font-lock-operator">-&gt;</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> 'b t <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'r


    <span class="doc">(** [rev_map arity t tab] creates a reverse mapping from values of
        typeclass [t] stored in table [tab] to memory regions.

        Note. not every mapping is reversable, for example, trying to obtain
        a reverse of surjective mapping as a one-to-one mapping will
        result in an error. But surjective mappings can be reversed
        using [~one_to:many] mapping. A particular example of surjective
        mapping is [symbol] tables, in a case when functions can occupy
        several non-contiguous regions of memory.

        {5 Examples}

        To create a mapping from a function symbol to sequence of memory
        regions with it code:

        {[rev_map one_to:many Sym.hashable tab]}

    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rev_map</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">one_to</span><span class="tuareg-font-lock-operator">:(</span>mem<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> r <span class="tuareg-font-lock-operator">-&gt;</span> 'a hashable <span class="tuareg-font-lock-operator">-&gt;</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'r<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** {3 Iterators}

        This section provides a common set of iterators. Note: name
        iterator is used in a functional meaning, i.e., an iterator is a
        function that takes a data structure and another function, and
        applies it to all elements in some manner.

        All iterators share some common part of interface that was lifted
        to a ['a ranged] type. When you see

        [('a t -&gt; f:('a -&gt; bool) -&gt; bool) ranged]

        just mentally substitute it with:

        [?start -&gt; ?until -&gt; 'a t -&gt; f:('a -&gt; bool) -&gt; bool].

        In other words ['f ranged] just prepends [?start -&gt; ?until -&gt;] to
        function with type ['f] (do not forget that ['f] can be an arrow
        type).

        [start] and [until] parameters allows to narrow iteration to some
        subset of table. If they are unspecified then iteration would be
        performed on all table entries in an ascending order of
        addresses. If they are specified, then if [start &lt;= until], then
        iteration will be performed in the same order but on a specified
        subset. In the case, when [start &gt; until], iteration will be
        performed in a decreasing order.
    *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a ranged</span>
      <span class="tuareg-font-lock-operator">=</span> <span class="constant">?start</span><span class="tuareg-font-lock-operator">:</span>mem   <span class="doc">(** defaults to the lowest mapped region *)</span>
      <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?until</span><span class="tuareg-font-lock-operator">:</span>mem   <span class="doc">(** defaults to the highest mapped area  *)</span>
      <span class="tuareg-font-lock-operator">-&gt;</span> 'a

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">exists</span>   <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">for_all</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">exists</span>   <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>      'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">for_all</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>      'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> ranged

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">count</span>    <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> int<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_if</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'a option<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_map</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">fold</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'b <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">iter</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> unit<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit<span class="tuareg-font-lock-operator">)</span> ranged

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find_mapi</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">foldi</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'b <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">iteri</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> unit<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit<span class="tuareg-font-lock-operator">)</span> ranged

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">map</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mapi</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t<span class="tuareg-font-lock-operator">)</span> ranged

    <span class="doc">(** removes all mappings that do not satisfy the predicate  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filter</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'a t<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filter_map</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t<span class="tuareg-font-lock-operator">)</span> ranged

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filteri</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'a t<span class="tuareg-font-lock-operator">)</span> ranged
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filter_mapi</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t<span class="tuareg-font-lock-operator">)</span> ranged


    <span class="doc">(** [to_sequence tab] converts the table [t] to a
        sequence of key-value pairs.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_sequence</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Sequence.</span>t<span class="tuareg-font-lock-operator">)</span> ranged


    <span class="doc">(** [regions table] returns in an ascending order of addresses all
        memory regions mapped in a [table] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">regions</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem seq<span class="tuareg-font-lock-operator">)</span> ranged

    <span class="doc">(** [regions table] returns in an ascending order of addresses all
        elements mapped in a [table] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">elements</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a t <span class="tuareg-font-lock-operator">-&gt;</span> 'a seq<span class="tuareg-font-lock-operator">)</span> ranged
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** A locations of a chunk of memory  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Location</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>
      addr <span class="tuareg-font-lock-operator">:</span> addr<span class="tuareg-font-lock-operator">;</span>
      len  <span class="tuareg-font-lock-operator">:</span> int<span class="tuareg-font-lock-operator">;</span>
    <span class="tuareg-font-lock-operator">}</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> fields<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** memory location  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">location</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Location.</span>t <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** A backend interface.

      This interface must be implemented by a backend plugin, and
      registered with [Image.register] function in order to be
      accessible for loading images.
  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Backend</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="doc">(** memory access permissions  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">perm</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-constructor">R</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">W</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">X</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Or</span> <span class="keyword">of</span> perm <span class="tuareg-font-lock-operator">*</span> perm
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="doc">(** A named contiguous part of file with permissions.
        Also, known as segment in ELF.    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Section</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>
        name<span class="tuareg-font-lock-operator">:</span> string<span class="tuareg-font-lock-operator">;</span>
        perm<span class="tuareg-font-lock-operator">:</span> perm<span class="tuareg-font-lock-operator">;</span>         <span class="doc">(** section's permissions  *)</span>
        off<span class="tuareg-font-lock-operator">:</span> int<span class="tuareg-font-lock-operator">;</span>
        location <span class="tuareg-font-lock-operator">:</span> location<span class="tuareg-font-lock-operator">;</span>
      <span class="tuareg-font-lock-operator">}</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> fields<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Symbol definition, that can span several non-contiguous parts of
        memory *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Sym</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>
        name <span class="tuareg-font-lock-operator">:</span> string<span class="tuareg-font-lock-operator">;</span>
        is_function <span class="tuareg-font-lock-operator">:</span> bool<span class="tuareg-font-lock-operator">;</span>
        is_debug <span class="tuareg-font-lock-operator">:</span> bool<span class="tuareg-font-lock-operator">;</span>
        locations <span class="tuareg-font-lock-operator">:</span> location <span class="tuareg-font-lock-operator">*</span> location list<span class="tuareg-font-lock-operator">;</span>
      <span class="tuareg-font-lock-operator">}</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> fields<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Just a named region of memory. (Known as section in ELF)  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Region</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>
        name <span class="tuareg-font-lock-operator">:</span> string<span class="tuareg-font-lock-operator">;</span>
        location <span class="tuareg-font-lock-operator">:</span> location<span class="tuareg-font-lock-operator">;</span>
      <span class="tuareg-font-lock-operator">}</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> fields<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** A Img from a backend perspective.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Img</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>
        arch     <span class="tuareg-font-lock-operator">:</span> arch<span class="tuareg-font-lock-operator">;</span>
        entry    <span class="tuareg-font-lock-operator">:</span> addr<span class="tuareg-font-lock-operator">;</span>
        sections <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Section.</span>t <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Section.</span>t list<span class="tuareg-font-lock-operator">;</span>
        symbols  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Sym.</span>t list<span class="tuareg-font-lock-operator">;</span>
        regions  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Region.</span>t list<span class="tuareg-font-lock-operator">;</span>
      <span class="tuareg-font-lock-operator">}</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> fields<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** the actual interface to be implemented  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Bigstring.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Img.</span>t option
  <span class="tuareg-font-lock-governing">end</span>


  <span class="doc">(** Binary Image.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Image</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** {2 Type definitions}  *)</span>

    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> image <span class="keyword">with</span> sexp_of            <span class="doc">(** image   *)</span>

    <span class="doc">(** section *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">sec</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="doc">(** symbol  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">sym</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">path</span> <span class="tuareg-font-lock-operator">=</span> string

    <span class="doc">(** {6 Constructing}  *)</span>

    <span class="doc">(** constructing an image can result in actual image and a set
        (hopefully empty) of errors occured in a process of decoding an
        image, that do not prevent us from actually creating an image. So,
        this information messages can be considered as warnings. *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">result</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Error.</span>t list<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="doc">(** [create ?backend filename] creates an image of the file specified
        specified by the [filename]. If [backend] is equal to "auto", then
        all backends are tried in order. If only one backend can read this
        file (i.e., there is no ambiguity), then image is returned. If
        [backend] is not specifed, then the LLVM backend is used. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?backend</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> path <span class="tuareg-font-lock-operator">-&gt;</span> result

    <span class="doc">(** [of_string ?backend ~data] creates an image from the specified
        [data]. See {!create} for [backend] parameter. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_string</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?backend</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> result

    <span class="doc">(** [of_bigstring ?backend ~data] creates an image from the specified
        [data]. See {!create} for [backend] parameter. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_bigstring</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?backend</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Bigstring.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> result


    <span class="doc">(** {6 Attributes}  *)</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">entry_point</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filename</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string option
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">arch</span><span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> arch
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_size</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr_size
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">endian</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> endian

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">data</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Bigstring.</span>t

    <span class="doc">(** {6 Tables }  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">words</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> size <span class="tuareg-font-lock-operator">-&gt;</span> word table
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sections</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> sec table

    <span class="doc">(** @deprecated: this will be removed in a next release  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">symbols</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> sym table

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">section</span> <span class="tuareg-font-lock-operator">:</span> sec tag
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">symbol</span>  <span class="tuareg-font-lock-operator">:</span> string tag
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">region</span>  <span class="tuareg-font-lock-operator">:</span> string tag

    <span class="doc">(** returns memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">memory</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> value memmap

    <span class="doc">(** {6 Mappings }  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">memory_of_section</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> sec <span class="tuareg-font-lock-operator">-&gt;</span> mem
    <span class="doc">(** [memory_of_symbol sym]: returns the memory of symbol in acending order. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">memory_of_symbol</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> sym <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">*</span> mem seq
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">symbols_of_section</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> sec <span class="tuareg-font-lock-operator">-&gt;</span> sym seq
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">section_of_symbol</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> sym <span class="tuareg-font-lock-operator">-&gt;</span> sec

    <span class="doc">(** Image Section.
        Section is a contiguous region of memory that has
        permissions. The same as segment in ELF.    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Sec</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> sec
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_writable</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_readable</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_executable</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** An entity from symbol table  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Sym</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> sym
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_function</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_debug</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** {2 Backend Interface}  *)</span>

    <span class="doc">(** [register_backend ~name backend] tries to register backend under
        the specified [name]. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register_backend</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">name</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Backend.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`Ok</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Duplicate</span> <span class="tuareg-font-lock-operator">]</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Memory maps.
      Memory map is an assosiative data structure that maps memory
      regions to values. Unlike in the Table, memory
      regions in the Memmap can intersect in an arbitrary ways. This
      data structure is also known as Interval Tree or Segmented Tree.

      Underneath the hood it is implemented using augumented AVL tree,
      so that all operations are logarithmic.
  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Memmap</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="doc">(** memory map, aka interval trees  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span> <span class="tuareg-font-lock-operator">=</span> 'a memmap <span class="keyword">with</span> sexp_of

    <span class="doc">(** [empty] map  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">empty</span> <span class="tuareg-font-lock-operator">:</span> 'a t

    <span class="doc">(** [singleton] a memory map containing only one memory region  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">singleton</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [min_addr map] is a minimum addr mapped in [map] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">min_addr</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> addr option

    <span class="doc">(** [max_addr map] is a maximum addr mapped in [map] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">max_addr</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> addr option

    <span class="doc">(** [min_binding map] is a minimum binding mapped in [map] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">min_binding</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** [max_binding map] is a maximum binding mapped in [map] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">max_binding</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** [add map mem tag] adds a new memory region [mem] tagged with
        [tag]. If the same region was already in the [map] it will be
        tagged with the [tag] again, even if it has had the same tag. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">add</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [dominators map mem] an ordered sequence of all memory regions,
        containing [mem]. A memory region [(x,y)] contains region [(p,q)],
        iff [p &gt;= x &amp;&amp; q &lt;= y], where memory regions are depicted using
        closed intervals. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">dominators</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> seq

    <span class="doc">(** [intersections map mem] an ordered sequence of all memory regions,
        that intersects with [mem]. Memory region [(x,y)] intersects with
        region [(p,q)] iff there exists such [z] that

        [z &gt;= p || z &lt;= q &amp;&amp; z &gt;= x &amp;&amp; z &lt;= y].

        In other words if there exists such byte that belongs to both memory
        regions. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">intersections</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> seq

    <span class="doc">(** [intersects map mem] is true if [intersections map mem] is not empty *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">intersects</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [dominates map mem] if there is a non empty set of dominators  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">dominates</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [contains map addr] true if there exists such memory region [mem],
        that [Memory.contains mem addr] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">contains</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [lookup map addr] returns an ordered sequence of all memory
        containing the [addr] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lookup</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> seq


    <span class="doc">(** [map m f] returns a new map with each tag mapped
        with function [f] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">map</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t

    <span class="doc">(** [mapi m f] the same as [map], but [f] is called with two
        arguments: [mem] and [tag], where [mem] is a memory region,
        and [tag] is a [tag] assosiated with that region. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mapi</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t

    <span class="doc">(** [filter_map m f] creates a new map by applying a function [f] to
        each tag. If [f] returns [Some x] then this region will be mapped
        to [x] in a new map, otherwise it will be dropped. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filter_map</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t

    <span class="doc">(** [filter_mapi] is like [filter_map] but use function also accepts
        would assosiated memory region *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">filter_mapi</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">f</span><span class="tuareg-font-lock-operator">:(</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'b option<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> 'b t

    <span class="doc">(** [remove map mem] removes all bindings to [mem]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">remove</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [remove_intersections map mem] removes all bindings that
        that intersects with [mem] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">remove_intersections</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [remove_dominators map mem] removes all bindings that are
        dominators to [mem] *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">remove_dominators</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

    <span class="doc">(** [to_sequence map] converts the memmap ['a t] to a sequence of
        key-value pairs *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_sequence</span> <span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> 'a<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Sequence.</span>t

    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Container.S1</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">'a t</span> <span class="tuareg-font-lock-operator">:=</span> 'a t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {1:disasm Disassembler}

      Disassembler library has two interfaces. An expert interface,
      that provides access to a low-level representation. And a normal
      one, that hides all the complexities of the expert interface,
      but is less efficient and less flexible. If unsure, use the latter.



      {2 Architecture specific libraries}

      Also, this library provide architecture specific libraries, that
      tries to represent structurally each particular
      architecture. Currently only [ARM] module, has first class
      assembler, i.e., constructors for opcodes, operands, etc.
      platform-specific stuff.
  *)</span>


  <span class="doc">(** {2 Convenient interface to the disassembler.} *)</span>

  <span class="doc">(** value of type [disasm] is a result of the disassembling of a
      memory region. To create values of this type use [disassemble]
      function *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">disasm</span>

  <span class="doc">(** values of type [insn] represents machine instructions decoded
      from the given piece of memory *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">insn</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of

  <span class="doc">(** [block] is a region of memory that is believed to be a basic block
      of control flow graph to the best of our knowledge. *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">block</span> <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of

  <span class="doc">(** [disassemble ?roots arch mem] disassemble provided memory region
      [mem] using best available algorithm and backend for the specified
      [arch]. Roots, if provided, should point to memory regions, that
      are believed to contain code. At best, this should be a list of
      function starts. If no roots are provided, then the starting
      address of the provided memory [mem] will be used as a root.

      The returned value will contain all memory reachable from the
      given set of roots, at our best knowledge. *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">disassemble</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?roots</span><span class="tuareg-font-lock-operator">:</span>addr list <span class="tuareg-font-lock-operator">-&gt;</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> disasm

  <span class="doc">(** [disassemble_image image] disassemble given image.
      Will take executable sections of the image and disassemble it,
      applying [disassemble] function. If no roots are specified, then
      symbol table will be used as a source of roots. If file doesn't
      contain one, then entry point will be used.
  *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">disassemble_image</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?roots</span><span class="tuareg-font-lock-operator">:</span>addr list <span class="tuareg-font-lock-operator">-&gt;</span> image <span class="tuareg-font-lock-operator">-&gt;</span> disasm

  <span class="doc">(** [disassemble_file ?roots path] takes a path to a binary and
      disassembles it  *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">disassemble_file</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?roots</span><span class="tuareg-font-lock-operator">:</span>addr list <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> disasm <span class="tuareg-font-lock-module">Or_error.</span>t

  <span class="doc">(** [disassemble_file ?roots path] takes a path to a binary and
      disassembles it  *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">disassemble_file_exn</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?roots</span><span class="tuareg-font-lock-operator">:</span>addr list <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> disasm

  <span class="doc">(** [linear_sweep arch mem] will perform a linear sweep disassembly on
      the specified memory [mem] *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">linear_sweep</span> <span class="tuareg-font-lock-operator">:</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> insn option<span class="tuareg-font-lock-operator">)</span> list <span class="tuareg-font-lock-module">Or_error.</span>t

  <span class="doc">(** [linear_sweep_exn] same as [linear_sweep], but raises an
      exception, instead of returning [Or_error] monad  *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">linear_sweep_exn</span> <span class="tuareg-font-lock-operator">:</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> insn option<span class="tuareg-font-lock-operator">)</span> list


  <span class="doc">(** Disassembled program.

      This module provides an interface for values of type [disasm].
  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Disasm</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> disasm

    <span class="doc">(** returns all instructions that was successfully decoded in an
        ascending order of their addresses. Each instruction is
        accompanied with its block of memory. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insns</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> insn<span class="tuareg-font-lock-operator">)</span> seq

    <span class="doc">(** returns a mapping from memory regions to basic blocks. One may
        think this as a whole program CFG that is constructed on the
        fly.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">blocks</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> block table

    <span class="doc">(** performs lookup for an instruction that occupies exactly
        the given piece of memory. If you need to find all instructions
        that lies in a given region of memory, use [insns_of_mem] or
        [insns_of_block] functions.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insn_at_mem</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> insn option

    <span class="doc">(** [insns_of_mem] returns all instructions that occupies memory
        regions that have intersections with [mem].  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insns_at_mem</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> insn<span class="tuareg-font-lock-operator">)</span> seq

    <span class="doc">(** returns a sequence of memory regions occupied by the given
        instruction.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mems_of_insn</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> insn <span class="tuareg-font-lock-operator">-&gt;</span> mem seq

    <span class="doc">(** [insn_at_addr t addr] finds instruction to which the [addr]
        belongs. In other words if instruction at given address is
        found it doesn't mean, that it starts at this address.
        Consider comparison with [min_addr] if you need to match
        starting address only.  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insn_at_addr</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> insn<span class="tuareg-font-lock-operator">)</span> option

    <span class="doc">(** returns a blocks of memory that was visited during the
        disassembly. The regions are merged with [Memory.merge] if
        possible. So it returns the least possible amount of contiguous
        memory regions *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">span</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> mem seq

    <span class="tuareg-font-lock-governing">type</span> <span class="type">error</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Failed</span> <span class="keyword">of</span> <span class="tuareg-font-lock-module">Error.</span>t
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Failed_to_disasm</span> <span class="keyword">of</span> mem
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Failed_to_lift</span> <span class="keyword">of</span> mem <span class="tuareg-font-lock-operator">*</span> insn <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Error.</span>t
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> sexp_of

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Error</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Printable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> error

    <span class="doc">(** returns a list of all errors and warnings that occurred during
        the disassembling *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">errors</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> error<span class="tuareg-font-lock-operator">)</span> seq

    <span class="doc">(** Tags to annotate memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insn</span> <span class="tuareg-font-lock-operator">:</span> insn tag
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">block</span> <span class="tuareg-font-lock-operator">:</span> block tag
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">error</span> <span class="tuareg-font-lock-operator">:</span> error tag
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Kinds of instructions  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Kind</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">branch</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Conditional_branch</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Unconditional_branch</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Indirect_branch</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">affecting_control</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> branch
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Return</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Call</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Barrier</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Terminator</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`May_affect_control_flow</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">having_side_effect</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`May_load</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`May_store</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> affecting_control
      <span class="tuareg-font-lock-operator">|</span> having_side_effect
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> enumerate<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** abstract and opaque register  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">reg</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** opaque immediate value  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">imm</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** floating point value  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">fmm</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

  <span class="doc">(** kind of instruction  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">kind</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Kind.</span>t <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp


  <span class="doc">(** Register.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Reg</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> reg

    <span class="doc">(** unique number representig a register  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">code</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="doc">(** name of a register  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>


  <span class="doc">(** Integer immediate operand  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Imm</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> imm
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_word</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">width</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> word option
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int64</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int64
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int</span>   <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int option
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Floating point immediate operand  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Fmm</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> fmm
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_float</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> float
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Operand *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Op</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** operand *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Reg</span> <span class="keyword">of</span> reg
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Imm</span> <span class="keyword">of</span> imm
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Fmm</span> <span class="keyword">of</span> fmm
    <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
    <span class="doc">(** Normalized comparison.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Normalized</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">compare</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">hash</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">compare_ops</span> <span class="tuareg-font-lock-operator">:</span> t array <span class="tuareg-font-lock-operator">-&gt;</span> t array <span class="tuareg-font-lock-operator">-&gt;</span> int
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pp_adt</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Format.</span>formatter <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> unit
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="tuareg-font-lock-governing">type</span> <span class="type">op</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Op.</span>t <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of

  <span class="doc">(** {3 Application Binary Interface}

      Under this name, we're gathering several different concepts, like:

      - calling convention
      - stack frame organization
      - data representation
      - special functions

      Later we may extend the ABI class to handle system calls, type
      inference and other stuff.

      Each ABI object is constructed specifically to a particular
      symbol using the following functional constructor, of the
      following type:

      [?image:image -&gt; ?sym:string -&gt; mem -&gt; block -&gt; abi option]

      ABI constructors are registered in the target specific lifter,
      and constructed for each symbol. Afterwards a set of most
      (and equally) applicable ABIs is provided to a calling part,
      to which it is left the final decision on how to disambiguate
      them. *)</span>

  <span class="doc">(** ABI interface.
      Each ABI object must implement this interface. *)</span>
  <span class="tuareg-font-lock-governing">class</span> <span class="tuareg-font-lock-governing">type</span> <span class="type">abi</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">object</span>
    <span class="doc">(** unique identifier of the ABI.
        Used to communicate between to ABI's.

        The order of id parts should be from more specific, to less
        specific, i.e. in reverse order (so that deriving classes can
        easily append their own parts). The architecture shouldn't be
        specified in the id, as two ABIs from different architectures
        should never met.

        A good start whould be to use:
        [specific; compiler; os; vendor]

        Example: ["*exit"; "gnueabi"; "linux"; "unknown"]

        Will encode an ABI of [exit] family of functions for ARM linux
        gnueabi. The recommended printing format for the ABI is to
        append the arch name and print all constituents of the name from
        right to left, using "-" symbol as a separator.

        In any case, the meaning of the identifier is specific to a
        particular family of ABIs, that are, usually inherit the same
        parent or set of parents. *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">id</span> <span class="tuareg-font-lock-operator">:</span> string list

    <span class="doc">(** [self#specific] is [true] if this ABI is specific
        for the provided function. The [specific] ABI is always more
        preferrable to non-specific one. If more than one specific
        ABIs is applicable for the provided symbol, than the normal
        resolution process will be used (see method [choose])
    *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">specific</span> <span class="tuareg-font-lock-operator">:</span> bool

    <span class="doc">(** [self#choose other] used to sort a set of applicable ABI.

        Must return:
        - [0] if [other] abi is not known or is considered equaly
        applicable for the given context.
        - [1] if [other] abi is known, and [self] is preferrable
        to [other]
        - [-1] if [other] abi is more preferrable. This value can
        be even returned when the other abi is not known to [self].

        In case of inconsistency the solving mechanism will consider
        inconsistent abi's as equal. The examples of inconsistent
        comparison results are: both abis preferred each other, or
        both abis claimed that they are preferrable. *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">choose</span> <span class="tuareg-font-lock-operator">:</span> abi <span class="tuareg-font-lock-operator">-&gt;</span> int

    <span class="doc">(** [return_value] returns an expression, that can be used to return
        a value from a function. Use [Bil.concat] to represent return
        value that doesn't fit into one register  *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">return_value</span> <span class="tuareg-font-lock-operator">:</span> exp option

    <span class="doc">(** [args] returns a list of expressions that represents
        arguments of the given function. Each expression can be
        annotated with suggested name  *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">args</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>string option <span class="tuareg-font-lock-operator">*</span> exp<span class="tuareg-font-lock-operator">)</span> list

    <span class="doc">(** [vars] returns a list of expressions, that represents
        local variables of the function  *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">vars</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>string option <span class="tuareg-font-lock-operator">*</span> exp<span class="tuareg-font-lock-operator">)</span> list

    <span class="doc">(** [records] returns a list of records, found in the symbol.  *)</span>
    <span class="tuareg-font-lock-governing">method</span> <span class="function-name">records</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>string option <span class="tuareg-font-lock-operator">*</span> exp<span class="tuareg-font-lock-operator">)</span> list list
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** symbol name may be provided if known. Also an access
      to the whole binary image is provided if there is one. *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">abi_constructor</span> <span class="tuareg-font-lock-operator">=</span>
    <span class="constant">?image</span><span class="tuareg-font-lock-operator">:</span>image <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?sym</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> block <span class="tuareg-font-lock-operator">-&gt;</span> abi


  <span class="doc">(** {3 A BIL model of CPU}

      In general this is a model of a processor architecture, involving
      ALU, processing unit, registers and memory.
  *)</span>

  <span class="doc">(** Abstract interface to CPU  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">CPU</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="doc">(** {3 Minimum set of required definitions} *)</span>

    <span class="doc">(** A set of general purpose registers *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">gpr</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Var.Set.</span>t

    <span class="doc">(** Memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mem</span> <span class="tuareg-font-lock-operator">:</span> var

    <span class="doc">(** Program counter  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pc</span>  <span class="tuareg-font-lock-operator">:</span> var

    <span class="doc">(** Stack pointer  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sp</span>  <span class="tuareg-font-lock-operator">:</span> var

    <span class="doc">(** {4 Flag registers}  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">zf</span>  <span class="tuareg-font-lock-operator">:</span> var
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">cf</span>  <span class="tuareg-font-lock-operator">:</span> var
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">vf</span>  <span class="tuareg-font-lock-operator">:</span> var
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">nf</span>  <span class="tuareg-font-lock-operator">:</span> var

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr_of_pc</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> addr

    <span class="doc">(** {3 Predicates}  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_reg</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_flag</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_sp</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_bp</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_pc</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_zf</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_cf</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_vf</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_nf</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_mem</span> <span class="tuareg-font-lock-operator">:</span> var <span class="tuareg-font-lock-operator">-&gt;</span> bool
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Abstract interface for ABI.

      Each lifted architecture provides an ABI module, that implements
      a superset of this interface.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">ABI</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="doc">(** creates a set of ABI for the provided symbol.
        Until [all] parameter is set to true the ABI will be
        disambiguated, using [choose] method. Only equally
        valid ABI are returned. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span>
      <span class="constant">?merge</span><span class="tuareg-font-lock-operator">:(</span>abi list <span class="tuareg-font-lock-operator">-&gt;</span> abi<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>
      <span class="constant">?image</span><span class="tuareg-font-lock-operator">:</span>image <span class="tuareg-font-lock-operator">-&gt;</span>
      <span class="constant">?sym</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> block <span class="tuareg-font-lock-operator">-&gt;</span> abi

    <span class="doc">(** [merge abis] create an abi that tries to take best from all
        provided abi. If the input list is empty, then the stub abi
        will be returned. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">merge</span> <span class="tuareg-font-lock-operator">:</span> abi list <span class="tuareg-font-lock-operator">-&gt;</span> abi

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">merge_id</span> <span class="tuareg-font-lock-operator">:</span> string list <span class="tuareg-font-lock-operator">-&gt;</span> string list <span class="tuareg-font-lock-operator">-&gt;</span> string list

    <span class="doc">(** ABI that understands nothing. All methods are dump stubs. *)</span>
    <span class="tuareg-font-lock-governing">class</span> <span class="function-name">stub</span> <span class="tuareg-font-lock-operator">:</span> abi

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_string</span> <span class="tuareg-font-lock-operator">:</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> string list <span class="tuareg-font-lock-operator">-&gt;</span> string
    <span class="doc">(** registers given ABI under the given target   *)</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register</span> <span class="tuareg-font-lock-operator">:</span> abi_constructor <span class="tuareg-font-lock-operator">-&gt;</span> unit
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {3 Navigating through CFG}

      On a disassembly level CFG is represented as a linked set of
      basic blocks. Each basic block has a sequence of successors
      and predecessors. To get a set of block use [Disasm.blocks]
      function. To navigate through use any combinations of the
      following methods:

      - recurse through successors and predecessors, taking care
      of possible loops;
      - use [Block.dfs] to search in depth-first execution order;
      - use [ocamlgraph] library and [to_graph] helper functions.
  *)</span>

  <span class="doc">(** a jump kind.
      A jump to another block can be conditional or unconditional.
  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">jump</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
    <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Jump</span>     <span class="doc">(** unconditional jump                  *)</span>
    <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Cond</span>     <span class="doc">(** conditional jump                    *)</span>
  <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
  <span class="doc">(** This type defines a relation between two basic blocks.  *)</span>
  <span class="tuareg-font-lock-governing">type</span> <span class="type">edge</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>jump <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Fall</span><span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span>sexp

  <span class="doc">(** Access to block attributes.
      This interface provides only access to block attributes, but
      doesn't allow to navigate to other blocks.
  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Block_accessors</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of
    <span class="tuareg-font-lock-governing">type</span> <span class="type">insn</span>
    <span class="doc">(** [addr block] address of the first instruction  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr

    <span class="doc">(** [memory blk] memory region, occupied by a block*)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">memory</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> mem

    <span class="doc">(** [leader blk] the first instruction *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">leader</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> insn

    <span class="doc">(** [terminator blk] last instruction of the block  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">terminator</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> insn

    <span class="doc">(** [insns blk] returns a list of block instructions  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insns</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> insn<span class="tuareg-font-lock-operator">)</span> list

    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Comparable</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Hashable</span>   <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="doc">(** all the printing stuff, including [to_string] function *)</span>
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Printable</span>  <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Navigate to neighborhood blocks.

      The following functions allows you to navigate through blocks
      without explicitly using graphs. Each neighborhood function
      returns closest neighbors as a lazy sequence. Please, be cautious,
      since this can contain loops, i.e. block can contain itself as a
      predecessor.

      You can use [Block.compare] or [compare_block] functions, to safely
      compare blocks with each other, without a risk of non-termination.
  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Block_traverse</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="doc">(** block type  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>

    <span class="doc">(** [dest] type also handles indirect jumps.  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">dest</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Block</span> <span class="keyword">of</span> t <span class="tuareg-font-lock-operator">*</span> edge
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Unresolved</span> <span class="keyword">of</span>    jump
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of

    <span class="doc">(** [dests blk] block immediate destinations including unresolved
        one. Successors are returned in the order of execution, e.g.,
        taken branch comes before the implicit one. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">dests</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> dest seq

    <span class="doc">(** [succs blk] block immediate successors in the order of
        execution, .  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">succs</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t seq
    <span class="doc">(** [preds blk] block immediate predecessors in unspecified order. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">preds</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t seq
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** Expert interface to disassembler.

      This interface is rather complicated, and is built around two
      implementations of the disassembler [Basic] and [Recursive].
      [Basic] provides an efficient (and very lazy) linear sweep,
      driven in a continuation passing style. On top of the [Basic]
      the [Recursive] disassembler is built, that reconstructs the
      control flow graph, and represents the latter as a table of
      blocks. *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Disasm_expert</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** Basic disassembler.

        This is a target agnostic basic low-level disassembler. *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Basic</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** predicate to drive the disassembler *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">pred</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Valid</span>  <span class="doc">(** stop on first valid insn  *)</span>
        <span class="tuareg-font-lock-operator">|</span>  <span class="tuareg-font-lock-module">Kind.</span>t   <span class="doc">(** stop on first insn of the specified kind *)</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> sexp

      <span class="doc">(** {2 Basic types }  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">reg</span>  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
      <span class="tuareg-font-lock-governing">type</span> <span class="type">imm</span>  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
      <span class="tuareg-font-lock-governing">type</span> <span class="type">fmm</span>  <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
      <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-operator">(+</span><span class="type">'a</span><span class="tuareg-font-lock-operator">,+</span><span class="type">'k</span><span class="tuareg-font-lock-operator">)</span><span class="type"> insn</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-operator">(+</span><span class="type">'a</span><span class="tuareg-font-lock-operator">,+</span><span class="type">'k</span><span class="tuareg-font-lock-operator">)</span><span class="type"> insns</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> insn option<span class="tuareg-font-lock-operator">)</span> list
      <span class="tuareg-font-lock-governing">type</span> <span class="type">empty</span>     <span class="doc">(** set when information is not stored                *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">asm</span>       <span class="doc">(** set when assembler information is stored        *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">kinds</span>     <span class="doc">(** set when instruction kind information is stored *)</span>

      <span class="tuareg-font-lock-governing">type</span> <span class="type">full_insn</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>asm<span class="tuareg-font-lock-operator">,</span>kinds<span class="tuareg-font-lock-operator">)</span> insn <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of

      <span class="doc">(** Disassembler.

          ['a] and ['k] type variables specify disassembler modes of
          operation. In a process of disassembly it can store extra
          information that might be useful. Although, since storing it
          takes extra time and space, it is disabled by default.

          The first type variable specifies whether storing assembly strings
          is enabled. It can be switched using [store_asm], [drop_asm]
          functions. When it is enabled, then this type variable will be set
          to [asm], and it will give an access to functions that returns
          this information. Otherwise, this type variable will be set to
          [empty], thus stopping you from accessing assembler information.

          The second type variable stands for [kinds], i.e. to store or not to
          store extra information about instruction kind.

          Note: at some points you can have an access to this information
          even if you don't enable it explicitly.
      *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-operator">(</span><span class="type">'a</span><span class="tuareg-font-lock-operator">,</span><span class="type">'k</span><span class="tuareg-font-lock-operator">)</span><span class="type"> t</span>

      <span class="doc">(** Disassembler state.

          Words of precautions: this state is valid only inside handlers
          functions of the [run] function. It shouldn't be stored
          anywhere.
          First two type variables are bound correspondingly to two
          variables of the disassmbler [('a,'k) t] type. Third type variable,
          is for user data type, that can be used to pass extra information
      *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-operator">(+</span><span class="type">'a</span><span class="tuareg-font-lock-operator">,+</span><span class="type">'k</span><span class="tuareg-font-lock-operator">,</span><span class="type">'s</span><span class="tuareg-font-lock-operator">,</span><span class="type">'r</span><span class="tuareg-font-lock-operator">)</span><span class="type"> state</span>

      <span class="doc">(** [create ?debug_level ?cpu ~backend target] creates a disassembler
          for the specified [target]. All parameters are backend specific,
          consult the concrete backend for more information. In general,
          the greater [debug_level] is, the more debug information will be
          outputed by a backend. To silent backend set it [0]. This is a
          default value. Example:

          [create ~debug_level:3 ~backend:"llvm" "x86_64"]
      *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span>
        <span class="constant">?debug_level</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">?cpu</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">backend</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span>
        string <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="tuareg-font-lock-operator">(</span>empty<span class="tuareg-font-lock-operator">,</span> empty<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** enables storing assembler information  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">store_asm</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>asm<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t

      <span class="doc">(** enables storing instruction kinds information *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">store_kinds</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>kinds<span class="tuareg-font-lock-operator">)</span> t

      <span class="doc">(** [run ?stop_on ?invalid ?stopped dis mem ~init ~return ~hit]
          performs recursive disassembly of specified memory [mem]. The
          process of disassembly can be driven using [stop], [step], [back]
          and [jump] functions, described later.

          @param stop_on defines a set of predicates that will be checked
          on each step to decide whether it should stop here and call a
          user-provided [hit] function, or it should continue. The descision
          is made acording to the rule: [if exists stop_on then stop], i.e.,
          it there exists such predicate in a set of predicates, that
          evaluates to true, then stop the disassembly and pass the control
          to the user function [hit].  A few notes: only valid instructions
          can match predicates, and if the set is empty, then it always
          evaluates to false.

          @param init initial value of user data, that can be passed
          through handlers (cf., [fold])

          @param return a function that lifts user data type ['s] to type
          ['r]. It is useful when you need to perform disassembly in some
          monad, like [Or_error], or [Lwt]. Otherwise, just use [ident]
          function and assume that ['s == 'r].

          In a process of disassembly user provided callbacks are invoked by
          the engine. To each callback at least two parameters are passed:
          [state] and [user_data]. [user_data] is arbitrary data of type ['s]
          with which the folding over the memory is actually
          performed. [state] incapsulates the current state of the
          disassembler, and provides continuation functions, namely [stop],
          [next] and [back], that drives the process of disassembly. This
          functions are used to pass control back to the disassembler.

          [stopped state user_data] is called when there is no more data to
          disassemble. This handler is optional and defaults to [stop].

          [invalid state user_data] is an optional handler that is called on
          each invalid instruction (i.e., a portion of data that is not a
          valid instruction), it defaults to [step], i.e., to skipping.

          [hit state mem insn data] is called when one of the predicates
          specifed by a user was hit. [insn] is actually the instruction
          that satisfies the predicate. [mem] is a memory region spanned by
          the instruction. [data] is a user data. [insn] can be queried for
          assembly string and kinds even if the corresponding modes are
          disabled.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">run</span> <span class="tuareg-font-lock-operator">:</span>
        <span class="constant">?stop_on</span><span class="tuareg-font-lock-operator">:</span>pred list <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">?invalid</span><span class="tuareg-font-lock-operator">:((</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">?stopped</span><span class="tuareg-font-lock-operator">:((</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">?hit</span><span class="tuareg-font-lock-operator">:((</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>asm<span class="tuareg-font-lock-operator">,</span>kinds<span class="tuareg-font-lock-operator">)</span> insn <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">return</span><span class="tuareg-font-lock-operator">:(</span>'s <span class="tuareg-font-lock-operator">-&gt;</span> 'r<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">init</span><span class="tuareg-font-lock-operator">:</span>'s <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 'r

      <span class="doc">(** [insn_of_mem dis mem] performes a disassembly of one instruction
          from the given memory region [mem]. Returns a tuple
          [imem,insn,`left over] where [imem] stands for a piece of memory
          consumed in a process of disassembly, [insn] can be [Some ins] if
          disassembly was successful, and [None] otherwise. [`left over]
          complements [imem] to original [mem]. *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insn_of_mem</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="tuareg-font-lock-operator">(</span>mem <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-operator">(</span>asm<span class="tuareg-font-lock-operator">,</span>kinds<span class="tuareg-font-lock-operator">)</span> insn option <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-operator">[</span><span class="tuareg-font-lock-constructor">`left</span> <span class="keyword">of</span> mem <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`finished</span><span class="tuareg-font-lock-operator">])</span> <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** current position of the disassembler  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">addr</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> addr

      <span class="doc">(** current set of predicates *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">preds</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> pred list

      <span class="doc">(** updates the set of predicates, that rules the stop condition.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">with_preds</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> pred list <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state

      <span class="doc">(** a queue of instructions disassembled in this step  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">insns</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> insns

      <span class="doc">(** [last s n] returns last [n] instructions disassembled in this
          step. If there are less then [n] instructions, then returns a
          smaller list *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">last</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> insns

      <span class="doc">(** the memory region we're currently working on *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">memory</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> mem

      <span class="doc">(** stop the disassembly and return the provided value.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">stop</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r

      <span class="doc">(** continue disassembling from the current point. You can change a
          a set of predicates, before stepping next. If you want to continue
          from a different address, use [jump] *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">step</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r

      <span class="doc">(** jump to the specified memory and continue disassembly in it.

          For example, if you want to jump to a specified address, and
          you're working in a [Or_error] monad, then you can:

          [view ~from:addr (mem state) &gt;&gt;= fun mem -&gt; jump mem data]
      *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">jump</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r

      <span class="doc">(** restarts last step.   *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">back</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>'s<span class="tuareg-font-lock-operator">,</span>'r<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> 's <span class="tuareg-font-lock-operator">-&gt;</span> 'r

      <span class="doc">(** Basic instruction.
          This instruction is an opaque pointer into C-backend, thus
          it is protected with phantom types. *)</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Insn</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-operator">(</span><span class="type">'a</span><span class="tuareg-font-lock-operator">,</span><span class="type">'k</span><span class="tuareg-font-lock-operator">)</span><span class="type"> t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> insn
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sexp_of_t</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Sexp.</span>t
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">compare</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">code</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">kinds</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>kinds<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Kind.</span>t list
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>kinds<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Kind.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> bool
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">asm</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>asm<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">ops</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> t <span class="tuareg-font-lock-operator">-&gt;</span> op array
      <span class="tuareg-font-lock-governing">end</span>

      <span class="doc">(** Trie maps over instructions  *)</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="tuareg-font-lock-governing">type</span> <span class="type">key</span>

        <span class="doc">(** [key_of_first_insns state ~len:n] creates a key from first [n]
            instructions stored in the state if state contains such
            amount of instructions  *)</span>
        <span class="tuareg-font-lock-governing">val</span> <span class="function-name">key_of_first_insns</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">,</span>_<span class="tuareg-font-lock-operator">)</span> state <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">len</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> key option

        <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Normalized</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> key
        <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">:=</span> key
      <span class="tuareg-font-lock-governing">end</span>
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Recursive Descent Disassembler.
        This disassembler is built on top of [Basic] disassembler. It
        uses work list algorithm to implement recursive descent
        disassembly and lazily reconstructs the whole program CFG.

        This is an expert-level module, and it is suggested to use
        high-level [Disasm] interface, that is built ontop of this
        module.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Recursive</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">block</span> <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of
      <span class="tuareg-font-lock-governing">type</span> <span class="type">lifter</span> <span class="tuareg-font-lock-operator">=</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Basic.</span>full_insn <span class="tuareg-font-lock-operator">-&gt;</span> bil <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">type</span> <span class="type">maybe_insn</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Basic.</span>full_insn option <span class="tuareg-font-lock-operator">*</span> bil option <span class="keyword">with</span> sexp_of
      <span class="tuareg-font-lock-governing">type</span> <span class="type">decoded</span> <span class="tuareg-font-lock-operator">=</span> mem <span class="tuareg-font-lock-operator">*</span> maybe_insn <span class="keyword">with</span> sexp_of

      <span class="tuareg-font-lock-governing">type</span> <span class="type">error</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Failed_to_disasm</span> <span class="keyword">of</span> mem
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Failed_to_lift</span> <span class="keyword">of</span> mem <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Basic.</span>full_insn <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Error.</span>t
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> sexp_of

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">run</span> <span class="tuareg-font-lock-operator">:</span>
        <span class="constant">?backend</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">?lifter</span><span class="tuareg-font-lock-operator">:</span>lifter <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?roots</span><span class="tuareg-font-lock-operator">:</span>addr list <span class="tuareg-font-lock-operator">-&gt;</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">blocks</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> block <span class="tuareg-font-lock-module">Table.</span>t

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">errors</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> error list

      <span class="doc">(** Low-level opaque representation of basic block. *)</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Block</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Block_accessors</span>
          <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> block
           <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">insn</span> <span class="tuareg-font-lock-operator">:=</span> maybe_insn
        <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Block_traverse</span>  <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
      <span class="tuareg-font-lock-governing">end</span>
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {2 High-level interface}  *)</span>

  <span class="doc">(** Assembly instruction.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Insn</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> insn <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">type</span> <span class="type">op</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Op.</span>t <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t

    <span class="doc">(** returns backend specific name of instruction *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">name</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** target-specific assembler string representing the instruction  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">asm</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string

    <span class="doc">(** returns BIL program specifying instruction semantics  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">bil</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bil

    <span class="doc">(** instruction operands  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">ops</span>  <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> op array

    <span class="doc">(** {3 Instruction predicates} *)</span>

    <span class="doc">(** [is_jump] [true] for all jumps  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_jump</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_conditional] [true] for conditional jumps  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_conditional_jump</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_unconditional] iff [is_jump &amp;&amp; not is_conditional_jump]  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_unconditional_jump</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_indirect_jump] [true] if it is indirect *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_indirect_jump</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_call] is [true] for all call instructions  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_call</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [is_return] [true] for returns  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">is_return</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [may_affect_control_flow] is true if it may affect control flow.
        &#171;may&#187; stays for the fact, that it &#171;may not&#187; affect.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">may_affect_control_flow</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [has_side_effect] is [true] if instruction may load or store  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">has_side_effect</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [may_load] is true if instruction may load data from memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">may_load</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool

    <span class="doc">(** [may_store] is true if instruction may store data to memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">may_store</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> bool


    <span class="doc">(** [pp_adt] prints instruction in ADT format, suitable for reading
        by evaluating in many languages, e.g. Python, Js, etc *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pp_adt</span> <span class="tuareg-font-lock-operator">:</span> t printer

    <span class="doc">(** {3 Prefix Tree}
        This module provides a trie data structure where a sequence of
        instructions is used as a key (and an individual instruction
        as a token). Two implementations are provided, a regular, where
        insns are compared as-is, and normalized, where instructions are
        compared using normalized comparison.

        In normalized comparison concerete immediate values are ignored,
        and if instructions have different number of operands, then only
        then excess operands are excluded from the comparison.
    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** Trie requires 0(1) get operation  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">key</span>

      <span class="doc">(** [key_of_insns insns] takes a list of instructions and transforms
          it to [key] *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">key_of_insns</span> <span class="tuareg-font-lock-operator">:</span> t list <span class="tuareg-font-lock-operator">-&gt;</span> key

      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Normalized</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> key
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Trie</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">:=</span> key
    <span class="tuareg-font-lock-governing">end</span>


    <span class="doc">(** {3 Creating}
        The following functions will create [insn] instances from a lower
        level representation.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_basic</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?bil</span><span class="tuareg-font-lock-operator">:</span>bil <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>full_insn <span class="tuareg-font-lock-operator">-&gt;</span> t

  <span class="tuareg-font-lock-governing">end</span>


  <span class="doc">(** Basic block of assembly instructions.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Block</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> block <span class="keyword">with</span> compare<span class="tuareg-font-lock-operator">,</span> sexp_of
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Block_accessors</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">insn</span> <span class="tuareg-font-lock-operator">:=</span> insn
    <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Block_traverse</span>  <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t


    <span class="doc">(** [dfs ?next ?bound blk] searches from the [blk] using DFS.

        Search can be bound with [bound], i.e., the search will not continue
        on block that has no intersections with the specified bound. By
        default the search is unbound. Search direction can be also
        specified by the [next] parameter. By default search is performed
        in a forward direction, using [succs] function. To search in a
        reverse direction, use [preds] function. The search result is
        returned as a lazy sequence. Destinations of the block are visited
        in the order of execution, e.g., taken branch is visited before
        non taken. No such guarantee is made for the predecessors or any
        other function provided as a [next] arguments, since it is a
        property of a [next] function, not the algorithm itsef.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">dfs</span> <span class="tuareg-font-lock-operator">:</span>
      <span class="constant">?order</span><span class="tuareg-font-lock-operator">:[</span><span class="tuareg-font-lock-constructor">`post</span> <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`pre</span><span class="tuareg-font-lock-operator">]</span> <span class="tuareg-font-lock-operator">-&gt;</span>        <span class="doc">(** defaults to pre *)</span>
      <span class="constant">?next</span><span class="tuareg-font-lock-operator">:(</span>t <span class="tuareg-font-lock-operator">-&gt;</span> t seq<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span>           <span class="doc">(** defaults to succs  *)</span>
      <span class="constant">?bound</span><span class="tuareg-font-lock-operator">:</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t seq


    <span class="doc">(** A classic control flow graph using OCamlgraph library.
        Graph vertices are made abstract, but the implement
        [Block_accessors] interface, including hash tables, maps, hash
        sets etc. *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Cfg</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Block</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
        <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="keyword">with</span> sexp_of
        <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Block_accessors</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">insn</span> <span class="tuareg-font-lock-operator">:=</span> insn
      <span class="tuareg-font-lock-governing">end</span>

      <span class="doc">(** Imperative graph *)</span>
      <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Imperative</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Graph.Sig.I</span>
        <span class="tuareg-font-lock-governing">with type</span> <span class="type">V.t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Block.</span>t
         <span class="tuareg-font-lock-governing">and type</span> <span class="type">V.label</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Block.</span>t
         <span class="tuareg-font-lock-governing">and type</span> <span class="type">E.t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Block.</span>t <span class="tuareg-font-lock-operator">*</span> edge <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Block.</span>t
         <span class="tuareg-font-lock-governing">and type</span> <span class="type">E.label</span> <span class="tuareg-font-lock-operator">=</span> edge

      <span class="doc">(** The default graph is persistant  *)</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Graph.Sig.P</span>
        <span class="tuareg-font-lock-governing">with type</span> <span class="type">V.t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Block.</span>t
         <span class="tuareg-font-lock-governing">and type</span> <span class="type">V.label</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Block.</span>t
         <span class="tuareg-font-lock-governing">and type</span> <span class="type">E.t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Block.</span>t <span class="tuareg-font-lock-operator">*</span> edge <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Block.</span>t
         <span class="tuareg-font-lock-governing">and type</span> <span class="type">E.label</span> <span class="tuareg-font-lock-operator">=</span> edge

    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** [to_graph ?bound entry] builds a graph starting with [entry] and
        spanning all reachable blocks that are bounded by a memory region
        [bound].
        @param bound defaults to infinite memory region.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_graph</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?bound</span><span class="tuareg-font-lock-operator">:</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Cfg.Block.</span>t <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Cfg.</span>t
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_imperative_graph</span> <span class="tuareg-font-lock-operator">:</span>
      <span class="constant">?bound</span><span class="tuareg-font-lock-operator">:</span>mem <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Cfg.Block.</span>t <span class="tuareg-font-lock-operator">*</span> <span class="tuareg-font-lock-module">Cfg.Imperative.</span>t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {1:targets Targets}  *)</span>

  <span class="doc">(** Abstract interface for all targets.

      Each target supported by BAP implements this interface. To get access
      to the implementation use [target_of_arch] function. Code
      written using this interface is cross-platfrom, i.e., target
      agnostic. If you want to write target-specific code, then use
      directly corresponding modules: [ARM], [IA32], [AMD64].

  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Target</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">CPU</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">CPU</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">ABI</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">ABI</span>

    <span class="doc">(** [lift mem insn] lifts provided instruction to BIL.
        Usually you do not need to call this function directly, as
        [disassemble] function will do the lifting.
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lift</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>insn <span class="tuareg-font-lock-operator">-&gt;</span> bil <span class="tuareg-font-lock-module">Or_error.</span>t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** [target_of_arch arch] creates a module for the given [arch], if
      [arch] is not lifted, the stub module is returned. *)</span>
  <span class="tuareg-font-lock-governing">val</span> <span class="function-name">target_of_arch</span> <span class="tuareg-font-lock-operator">:</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span><span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Target</span><span class="tuareg-font-lock-operator">)</span>

  <span class="doc">(** {2 Lifted targets}
      All targets implement at least [Target] interface. *)</span>

  <span class="doc">(** ARM architecture  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">ARM</span>  <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lift</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>insn <span class="tuareg-font-lock-operator">-&gt;</span> bil <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">ABI</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">ABI</span>

      <span class="doc">(** [gnueabi] ABI  *)</span>
      <span class="tuareg-font-lock-governing">class</span> <span class="function-name">gnueabi</span> <span class="tuareg-font-lock-operator">:</span>
        <span class="constant">?image</span><span class="tuareg-font-lock-operator">:</span>image <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">?sym</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> block <span class="tuareg-font-lock-operator">-&gt;</span> abi

    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** ARM CPU.
        Other than common CPU interface, this module also exposes ARM
        specific registers and flags.    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">CPU</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">CPU</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">spsr</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">cpsr</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">nf</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">zf</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">cf</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">vf</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">qf</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">ge</span> <span class="tuareg-font-lock-operator">:</span> var array
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">itstate</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lr</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pc</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">sp</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r0</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r1</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r2</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r3</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r4</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r5</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r6</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r7</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r8</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r9</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r10</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r11</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r12</span> <span class="tuareg-font-lock-operator">:</span> var
    <span class="tuareg-font-lock-governing">end</span>


    <span class="doc">(** Arm Instruction Set.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Insn</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">move</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADCri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADCrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADCrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADCrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADDri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADDrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADDrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ADDrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ANDri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ANDrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ANDrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ANDrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BICri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BICrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BICrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BICrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMNri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMNzrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMNzrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMNzrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMPri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMPrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMPrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CMPrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`EORri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`EORrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`EORrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`EORrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MOVTi16</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MOVi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MOVi16</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MOVr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MOVsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MOVsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MVNi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MVNr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MVNsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MVNsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ORRri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ORRrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ORRrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ORRrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSBri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSBrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSBrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSBrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSCri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSCrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSCrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RSCrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SBCri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SBCrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SBCrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SBCrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SUBri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SUBrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SUBrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SUBrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TEQri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TEQrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TEQrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TEQrsr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TSTri</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TSTrr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TSTrsi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`TSTrsr</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">bits</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BFC</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BFI</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`PKHTB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`RBIT</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SBFX</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SWPB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SXTAB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SXTAH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SXTB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SXTH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UBFX</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UXTAB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UXTAH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UXTB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UXTH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`REV</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`REV16</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CLZ</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">mult</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MLA</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MLS</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MUL</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMLABB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMLAD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMLAL</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMLALBT</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMLAWB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMUAD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMULBB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMULL</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SMULTB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UMLAL</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`UMULL</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate


      <span class="tuareg-font-lock-governing">type</span> <span class="type">mem_multi</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMDA</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMDA_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMDB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMDB_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMIA</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMIA_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMIB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDMIB_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMDA</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMDA_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMDB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMDB_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMIA</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMIA_UPD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMIB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STMIB_UPD</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate


      <span class="tuareg-font-lock-governing">type</span> <span class="type">mem</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> mem_multi
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRBT_POST_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRBT_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRB_POST_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRB_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRB_PRE_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRB_PRE_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRBi12</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRBrs</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRD_POST</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRD_PRE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDREX</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDREXB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDREXD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDREXH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRHTr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRH_POST</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRH_PRE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSBTr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSB_POST</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSB_PRE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSHTi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSHTr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSH_POST</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRSH_PRE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRT_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDR_POST_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDR_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDR_PRE_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDR_PRE_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRi12</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LDRrs</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRBT_POST_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRBT_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRB_POST_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRB_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRB_PRE_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRB_PRE_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRBi12</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRBrs</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRD_POST</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRD_PRE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STREX</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STREXB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STREXD</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STREXH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRH</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRHTr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRH_POST</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRH_PRE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRT_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STR_POST_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STR_POST_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STR_PRE_IMM</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STR_PRE_REG</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRi12</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`STRrs</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">branch</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BL</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BLX</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BLX_pred</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BLXi</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BL_pred</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BX</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BX_RET</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`BX_pred</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`Bcc</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">special</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CPS2p</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`DMB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`DSB</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`HINT</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MRS</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MSR</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`PLDi12</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SVC</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> move
        <span class="tuareg-font-lock-operator">|</span> bits
        <span class="tuareg-font-lock-operator">|</span> mult
        <span class="tuareg-font-lock-operator">|</span> mem
        <span class="tuareg-font-lock-operator">|</span> branch
        <span class="tuareg-font-lock-operator">|</span> special
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="doc">(** [create basic_insn] lifts ARM instruction from a basic instruction  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'b<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>insn <span class="tuareg-font-lock-operator">-&gt;</span> t option
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** ARM Registers.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Reg</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">nil</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span> <span class="tuareg-font-lock-constructor">`Nil</span> <span class="tuareg-font-lock-operator">]</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="doc">(** General purpose registers  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">gpr</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R0</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R1</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R2</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R3</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R4</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R5</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R6</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R7</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R8</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R9</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R10</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R11</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`R12</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LR</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`PC</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SP</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">gpr_or_nil</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>nil <span class="tuareg-font-lock-operator">|</span> gpr<span class="tuareg-font-lock-operator">]</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="doc">(** conditition code registers  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">ccr</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CPSR</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`SPSR</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`ITSTATE</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">ccr_or_nil</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>nil <span class="tuareg-font-lock-operator">|</span> ccr <span class="tuareg-font-lock-operator">]</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">non_nil</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>gpr <span class="tuareg-font-lock-operator">|</span> ccr<span class="tuareg-font-lock-operator">]</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>nil <span class="tuareg-font-lock-operator">|</span> non_nil<span class="tuareg-font-lock-operator">]</span>
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="doc">(** lifts basic register to a ARM one  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>reg <span class="tuareg-font-lock-operator">-&gt;</span> t option

      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">end</span>


    <span class="doc">(** ARM instruction operands  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Op</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Reg</span> <span class="keyword">of</span> <span class="tuareg-font-lock-module">Reg.</span>t
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Imm</span> <span class="keyword">of</span> word
      <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="doc">(** lifts operand from a basic one  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> op <span class="tuareg-font-lock-operator">-&gt;</span> t option
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Condition prefixes.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Cond</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`EQ</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`NE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CS</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`CC</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`MI</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`PL</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`VS</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`VC</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`HI</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LS</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`GE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LT</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`GT</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`LE</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`AL</span>
      <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp<span class="tuareg-font-lock-operator">,</span> enumerate

      <span class="doc">(** decodes condition value from a word  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> word <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Regular</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** [x86] architecture  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">IA32</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lift</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>insn <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-module">Or_error.</span>t
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">ABI</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">ABI</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">CPU</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">CPU</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rbp</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rsp</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rsi</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rdi</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rip</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rax</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rbx</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rcx</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">rdx</span> <span class="tuareg-font-lock-operator">:</span> var
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r</span> <span class="tuareg-font-lock-operator">:</span> var array
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** [x86-64] architecture  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">AMD64</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">lift</span> <span class="tuareg-font-lock-operator">:</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>'a<span class="tuareg-font-lock-operator">,</span>'k<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Disasm_expert.Basic.</span>insn <span class="tuareg-font-lock-operator">-&gt;</span> stmt list <span class="tuareg-font-lock-module">Or_error.</span>t

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">CPU</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">CPU</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-governing">module type of</span> <span class="tuareg-font-lock-module">IA32.CPU</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">r</span> <span class="tuareg-font-lock-operator">:</span> var array
    <span class="tuareg-font-lock-governing">end</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">ABI</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">ABI</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {3 Sematic analysis}   *)</span>

  <span class="doc">(** @deprecated will be removed soon  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Symtab</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> string table

    <span class="doc">(** [create roots base cfg]
        creates a symbol table from [cfg]. If no roots are
        provided, then only calls
    *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> addr list <span class="tuareg-font-lock-operator">-&gt;</span> mem <span class="tuareg-font-lock-operator">-&gt;</span> block table <span class="tuareg-font-lock-operator">-&gt;</span> t

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Graph</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-module">Graph.Sig.P</span>
      <span class="tuareg-font-lock-governing">with type</span> <span class="type">V.label</span> <span class="tuareg-font-lock-operator">=</span> mem <span class="tuareg-font-lock-operator">*</span> string <span class="doc">(** function body *)</span>
       <span class="tuareg-font-lock-governing">and type</span> <span class="type">E.label</span> <span class="tuareg-font-lock-operator">=</span> addr         <span class="doc">(** callsite  *)</span>


    <span class="doc">(** [to_graph blocks syms] creates a callgraph. Edges of the graph
        are labeled with a callsite *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_graph</span> <span class="tuareg-font-lock-operator">:</span> block table <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-module">Graph.</span>t
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {1:project Project}
      A big view on a dissassembled binary  *)</span>

  <span class="doc">(** Interface for the BAP project.

      Project represents the results of analysis applied to a certain
      binary object. It is slightly more abstract, then binary image,
      thus allowing to apply analysis on arbitrary binary blobs.

      Project is also a common ground, where different plugins can meet,
      talk and exchange with information. Each plugin is barely a
      function of type [t -&gt; t], i.e., it can functionally update
      project, e.g., add annotations, discover new symbols, remove
      incorrect and, even, change architecture and redisassemble
      everything.


      {3 Exchanging information}

      For exchanging information in type safe manner we use universal
      values. Values can be attached to a particular memory region, or to
      a key of type [string]. For the first case we use `memmap` data
      structure that is an interval tree containing all the memory
      regions that were used during analysis. For the latter a simple
      [String.Map] is used.


      {4 Annotating memory}

      Depending on the analysis performed and input parameters, one can
      expect that memory may be annotated with the following tags:

      - [Image.region] -- for regions of memory, that had some
      particular name in the original binary. For example, in ELF
      sections have names, that will be used to annotate corresponding
      memory regions.

      - [Image.section] -- if the binary data was loaded from a binary
      format that contains sections (aka segments), then corresponding
      memory regions would be marked. Sections gives you access to
      permission information.

      - [Image.symbol] -- with this tag we annotate each memory regions
      that belongs to a particular symbol. Currently, the type of tag
      is just a string.
  *)</span>

  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Project</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="doc">(** The result of Binary analysis.  *)</span>
    <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">{</span>
      arch    <span class="tuareg-font-lock-operator">:</span> arch<span class="tuareg-font-lock-operator">;</span>               <span class="doc">(** architecture  *)</span>
      disasm  <span class="tuareg-font-lock-operator">:</span> disasm<span class="tuareg-font-lock-operator">;</span>             <span class="doc">(** disassembly of a program *)</span>
      memory  <span class="tuareg-font-lock-operator">:</span> value memmap<span class="tuareg-font-lock-operator">;</span>       <span class="doc">(** annotations  *)</span>
      storage <span class="tuareg-font-lock-operator">:</span> value <span class="tuareg-font-lock-module">String.Map.</span>t<span class="tuareg-font-lock-operator">;</span> <span class="doc">(** arbitrary data storage *)</span>

      <span class="doc">(** Deprecated fields, the will be removed in a next release. *)</span>
      symbols <span class="tuareg-font-lock-operator">:</span> string table<span class="tuareg-font-lock-operator">;</span>       <span class="doc">(** @deprecated symbol table  *)</span>
      base    <span class="tuareg-font-lock-operator">:</span> mem<span class="tuareg-font-lock-operator">;</span>                <span class="doc">(** @deprecated base memory  *)</span>
    <span class="tuareg-font-lock-operator">}</span>

    <span class="tuareg-font-lock-governing">type</span> <span class="type">color</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-operator">[</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`black</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`red</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`green</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`yellow</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`blue</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`magenta</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`cyan</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">`white</span>
    <span class="tuareg-font-lock-operator">]</span> <span class="keyword">with</span> sexp

    <span class="doc">(** all string tags supports the following substitutions:

        - $region_{name,addr,min_addr,max_addr} - name of region of file
        to which it belongs. For example, in ELF this name will
        correspond to the section name

        - $symbol_{name,addr} - name or address of the symbol to which this
        memory belongs

        - $asm - assembler listing of the memory region

        - $bil - BIL code of the tagged memory region

        - $block_{name,addr} - name or address of a basic block to which
        this region belongs

        - $min_addr, $addr - starting address of a memory region

        - $max_addr - address of the last byte of a memory region.
    *)</span>


    <span class="doc">(** an arbitrary text *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">text</span> <span class="tuareg-font-lock-operator">:</span> string tag

    <span class="doc">(** the associated data is an html markup *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">html</span> <span class="tuareg-font-lock-operator">:</span> string tag

    <span class="doc">(** associate a comment string with a memory region  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">comment</span> <span class="tuareg-font-lock-operator">:</span> string tag

    <span class="doc">(** to assosiate a python command with a region *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">python</span> <span class="tuareg-font-lock-operator">:</span> string tag

    <span class="doc">(** to assosiate a shell command with a region  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">shell</span> <span class="tuareg-font-lock-operator">:</span> string tag

    <span class="doc">(** just mark a region  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">mark</span> <span class="tuareg-font-lock-operator">:</span> unit tag

    <span class="doc">(** attach a color  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">color</span> <span class="tuareg-font-lock-operator">:</span> color tag

    <span class="doc">(** attach a weight to a memory  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">weight</span> <span class="tuareg-font-lock-operator">:</span> float tag

    <span class="doc">(** [register plugin] registers [plugin] in the system  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register_plugin</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">-&gt;</span> t<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="doc">(** [register' plugin] registers a [plugin] that will be
        evaluated only for side effect. *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register_plugin'</span><span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>t <span class="tuareg-font-lock-operator">-&gt;</span> unit<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register_plugin_with_args</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>string array <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">register_plugin_with_args'</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-operator">(</span>string array <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> unit<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> unit

    <span class="doc">(** A list of registered plugins in the order of registration  *)</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">plugins</span> <span class="tuareg-font-lock-operator">:</span> unit <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>string array <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-operator">-&gt;</span> t<span class="tuareg-font-lock-operator">)</span> list
  <span class="tuareg-font-lock-governing">end</span>


  <span class="doc">(** {1 Auxiliary libraries}  *)</span>

  <span class="doc">(** {4 Dwarf library}
      This library gives an access to debugging information stored
      in a binary program.  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Dwarf</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Leb128</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="doc">(** an encoded value  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

      <span class="doc">(** [encode ~signed v] encodes value [v] in a LEB128 format. If
          signed is true, then uses signed encoding. *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">'a encoder</span> <span class="tuareg-font-lock-operator">=</span> <span class="constant">?signed</span><span class="tuareg-font-lock-operator">:</span>bool <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> t
      <span class="doc">(** [decode leb] decodes a number from LEB128 representation.  *)</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">'a decoder</span> <span class="tuareg-font-lock-operator">=</span> t <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** [size leb] return size in bytes of the number stored in LEB128
          encoding.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">size</span><span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">read</span><span class="tuareg-font-lock-operator">:</span> <span class="constant">?signed</span><span class="tuareg-font-lock-operator">:</span>bool <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">pos_ref</span><span class="tuareg-font-lock-operator">:</span>int <span class="builtin">ref</span> <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">write</span><span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">pos</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> unit

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int</span><span class="tuareg-font-lock-operator">:</span>   int   decoder
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int32</span><span class="tuareg-font-lock-operator">:</span> int32 decoder
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">to_int64</span><span class="tuareg-font-lock-operator">:</span> int64 decoder

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int</span><span class="tuareg-font-lock-operator">:</span>   int   encoder
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int32</span><span class="tuareg-font-lock-operator">:</span> int32 encoder
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">of_int64</span><span class="tuareg-font-lock-operator">:</span> int64 encoder
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** File sections  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Section</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Info</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Abbrev</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Str</span>
      <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare<span class="tuareg-font-lock-operator">,</span>variants
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Debug Entry Tag  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Tag</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Compile_unit</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Partial_unit</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Subprogram</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Entry_point</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Inlined_subroutine</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Unknown</span> <span class="keyword">of</span> int
      <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare<span class="tuareg-font-lock-operator">,</span>variants
    <span class="tuareg-font-lock-governing">end</span>


    <span class="doc">(** Attribute  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Attr</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Name</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Low_pc</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">High_pc</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Entry_pc</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Unknown</span> <span class="keyword">of</span> int
      <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare<span class="tuareg-font-lock-operator">,</span>variants
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">type</span> <span class="type">lenspec</span> <span class="tuareg-font-lock-operator">=</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Leb128</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">One</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Two</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Four</span>
      <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Eight</span>
    <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare

    <span class="doc">(** Attribute form  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Form</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Addr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">String</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Block</span> <span class="keyword">of</span> lenspec
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Const</span> <span class="keyword">of</span> lenspec
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Flag_present</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Strp</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Ref</span> <span class="keyword">of</span> lenspec
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Indirect</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Offset</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Expr</span>
        <span class="tuareg-font-lock-operator">|</span> <span class="tuareg-font-lock-constructor">Sig</span>
      <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare<span class="tuareg-font-lock-operator">,</span>variants
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">type</span> <span class="type">tag</span>  <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Tag.</span>t  <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare
    <span class="tuareg-font-lock-governing">type</span> <span class="type">attr</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Attr.</span>t <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare
    <span class="tuareg-font-lock-governing">type</span> <span class="type">form</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Form.</span>t <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare
    <span class="tuareg-font-lock-governing">type</span> <span class="type">section</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Section.</span>t <span class="keyword">with</span> sexp<span class="tuareg-font-lock-operator">,</span>bin_io<span class="tuareg-font-lock-operator">,</span>compare
    <span class="tuareg-font-lock-governing">type</span> <span class="type">fn</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp

    <span class="doc">(** Current function representation.  *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Fn</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">=</span> fn <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> compare<span class="tuareg-font-lock-operator">,</span> sexp
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pc_lo</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pc_hi</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> addr option
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">Identifiable.S</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">t</span> <span class="tuareg-font-lock-operator">:=</span> t
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Fbi</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>

      <span class="doc">(** [create data] tries to create a DWARF reader, from
          supplied [data]. May yield an error, if there wasn't sufficient
          sections, or if format is not understandable.

          To provide information about functions parser needs at least this
          three sections:

          - .debug_abbrev [Section.Abbr]
          - .debug_info   [Section.Info]
          - .debug_str    [Section.Str]
      *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> string <span class="tuareg-font-lock-module">Dwarf_data.</span>t <span class="tuareg-font-lock-operator">-&gt;</span> t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** [functions searcher] enumerates functions  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">functions</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>string <span class="tuareg-font-lock-operator">*</span> fn<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-module">Sequence.</span>t
    <span class="tuareg-font-lock-governing">end</span>

    <span class="doc">(** Buffer is a light abstraction over [string] and [bigstring],
        that can allow one to share the same string for different sections
        without explicit copying.
    *)</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Buffer</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span>
      <span class="doc">(** [create ~pos:0 ] creates a buffer from a data  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span><span class="tuareg-font-lock-operator">:</span> <span class="constant">?pos</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> 'a <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

      <span class="doc">(** [with_pos buf pos] creates a new buffer that shares data with
          [buf], but has different starting position  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">with_pos</span><span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

      <span class="doc">(** [with_off buf off] creates a new buffer that shares data with
          [buf], but has different starting position equal to [pos buf + off] *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">with_off</span><span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> 'a t

      <span class="doc">(** [pos buf] starting position  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pos</span><span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> int

      <span class="doc">(** [data pos] actual data.

          Note: it doesn't start from [pos], it start from [0] *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">data</span><span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> 'a
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Data</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">'a t</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">'a buffer</span> <span class="tuareg-font-lock-operator">=</span> 'a <span class="tuareg-font-lock-module">Buffer.</span>t

      <span class="doc">(** [create endian sections] creates data representation from a assoc list
          of sections. Will complain if there're repeating sections.  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span><span class="tuareg-font-lock-operator">:</span> endian <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>section <span class="tuareg-font-lock-operator">*</span> 'a buffer<span class="tuareg-font-lock-operator">)</span> list <span class="tuareg-font-lock-operator">-&gt;</span> 'a t <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** [section data] lookups for a [section] in [data]  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">section</span><span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> section <span class="tuareg-font-lock-operator">-&gt;</span> 'a buffer <span class="tuareg-font-lock-module">Or_error.</span>t

      <span class="doc">(** [endian data] the endianness of [data]  *)</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">endian</span><span class="tuareg-font-lock-operator">:</span> 'a t <span class="tuareg-font-lock-operator">-&gt;</span> endian
    <span class="tuareg-font-lock-governing">end</span>

  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {4 Binary Signatures Storage}  *)</span>
  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Signatures</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">save</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?comp</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">mode</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">path</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> string <span class="tuareg-font-lock-operator">-&gt;</span> unit
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">load</span> <span class="tuareg-font-lock-operator">:</span> <span class="constant">?comp</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">?path</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">mode</span><span class="tuareg-font-lock-operator">:</span>string <span class="tuareg-font-lock-operator">-&gt;</span> arch <span class="tuareg-font-lock-operator">-&gt;</span> string option
    <span class="tuareg-font-lock-governing">val</span> <span class="function-name">default_path</span> <span class="tuareg-font-lock-operator">:</span> string
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(** {4 Byteweight Algorithm implementation}  *)</span>

  <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Byteweight</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">Corpus</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">key</span>
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">look</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">length</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> key option
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-governing">type</span> <span class="tuareg-font-lock-module">S</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">t</span> <span class="keyword">with</span> bin_io<span class="tuareg-font-lock-operator">,</span> sexp
      <span class="tuareg-font-lock-governing">type</span> <span class="type">key</span>
      <span class="tuareg-font-lock-governing">type</span> <span class="type">corpus</span>

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">create</span> <span class="tuareg-font-lock-operator">:</span> unit <span class="tuareg-font-lock-operator">-&gt;</span> t
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">train</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">max_length</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="tuareg-font-lock-operator">(</span>key <span class="tuareg-font-lock-operator">-&gt;</span> bool<span class="tuareg-font-lock-operator">)</span> <span class="tuareg-font-lock-operator">-&gt;</span> corpus <span class="tuareg-font-lock-operator">-&gt;</span> unit
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">length</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> int

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">next</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">length</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span>
        <span class="constant">threshold</span><span class="tuareg-font-lock-operator">:</span>float <span class="tuareg-font-lock-operator">-&gt;</span>
        corpus <span class="tuareg-font-lock-operator">-&gt;</span> int <span class="tuareg-font-lock-operator">-&gt;</span> int option

      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">pp</span> <span class="tuareg-font-lock-operator">:</span> t printer
    <span class="tuareg-font-lock-governing">end</span>

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Make</span>
        <span class="tuareg-font-lock-operator">(</span><span class="variable-name">Corpus </span><span class="tuareg-font-lock-operator">:</span><span class="variable-name"> </span><span class="tuareg-font-lock-module">Corpus</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name">
        </span><span class="tuareg-font-lock-operator">(</span><span class="variable-name">Trie </span><span class="tuareg-font-lock-operator">:</span><span class="variable-name"> </span><span class="tuareg-font-lock-module">Trie </span><span class="tuareg-font-lock-governing">with type</span><span class="tuareg-font-lock-module"> </span><span class="type">key</span><span class="tuareg-font-lock-module"> </span><span class="tuareg-font-lock-operator">=</span><span class="tuareg-font-lock-module"> Corpus.key</span><span class="tuareg-font-lock-operator">)</span><span class="variable-name"> </span><span class="tuareg-font-lock-operator">:</span>
      <span class="tuareg-font-lock-module">S</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Corpus.</span>key
         <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">corpus</span> <span class="tuareg-font-lock-operator">=</span> <span class="tuareg-font-lock-module">Corpus.</span>t

    <span class="tuareg-font-lock-governing">module</span> <span class="tuareg-font-lock-module">Bytes</span> <span class="tuareg-font-lock-operator">:</span> <span class="tuareg-font-lock-governing">sig</span>
      <span class="tuareg-font-lock-governing">include</span> <span class="tuareg-font-lock-module">S</span> <span class="tuareg-font-lock-governing">with type</span> <span class="type">key</span> <span class="tuareg-font-lock-operator">=</span> mem
                 <span class="tuareg-font-lock-governing">and type</span><span class="variable-name"> </span><span class="type">corpus</span> <span class="tuareg-font-lock-operator">=</span> mem
      <span class="tuareg-font-lock-governing">val</span> <span class="function-name">find</span> <span class="tuareg-font-lock-operator">:</span> t <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">length</span><span class="tuareg-font-lock-operator">:</span>int <span class="tuareg-font-lock-operator">-&gt;</span> <span class="constant">threshold</span><span class="tuareg-font-lock-operator">:</span>float <span class="tuareg-font-lock-operator">-&gt;</span> corpus <span class="tuareg-font-lock-operator">-&gt;</span> addr list
    <span class="tuareg-font-lock-governing">end</span>
  <span class="tuareg-font-lock-governing">end</span>

  <span class="doc">(**/**)</span>

<span class="tuareg-font-lock-governing">end</span>
</pre>
  </body>
</html>
