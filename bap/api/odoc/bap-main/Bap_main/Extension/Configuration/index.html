<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Configuration (bap-main.Bap_main.Extension.Configuration)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../index.html">bap-main</a> &#x00BB; <a href="../../index.html">Bap_main</a> &#x00BB; <a href="../index.html">Extension</a> &#x00BB; Configuration</nav><h1>Module <code>Extension.Configuration</code></h1><p>Configuration Parameters.</p><p>Use this module to declare and use configuration parameters for your plugins. Although configuration parameters could be specified via the command line, they are different from the corresponding parameters of commands in several ways:</p><ul><li>configuration parameters could be still passed even when there is no command line interface (via configuration files and environment);</li></ul><ul><li>they are specific to plugins and are always prefixed with the plugin name.</li></ul></header><dl><dt class="spec type" id="type-param"><a href="#type-param" class="anchor"></a><code><span class="keyword">type</span> <span>'a param</span></code></dt><dd><p>a configuration parameter</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code><code> = <a href="../../index.html#type-ctxt">ctxt</a></code></dt><dd><p>the current configuration.</p></dd></dl><dl><dt class="spec type" id="type-info"><a href="#type-info" class="anchor"></a><code><span class="keyword">type</span> info</code></dt><dd><p>a piece of information about a system component.</p></dd></dl><dl><dt class="spec value" id="val-get"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-param">param</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>get ctxt parameter</code> gets the value of the <code>parameter</code>.</p><p>Accesses the value of the previously defined <code>parameter</code>.</p><p>The <code>Extension.Syntax</code> module also provides an infix version of this function under the <code>--&gt;</code> name.</p></dd></dl><dl><dt class="spec value" id="val-parameter"><a href="#val-parameter" class="anchor"></a><code><span class="keyword">val</span> parameter : <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span>?&#8288;as_flag:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;aliases:<span>string list</span></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../index.html#type-typ">typ</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-param">param</a></span></code></dt><dd><p><code>parameter t name</code> declares a configuration parameter.</p><p>This declaration extends the <code>common-options</code> grammar by adding the following rules</p><pre>          common-options =
            ...
            | common-options, R | R, common-options
          R = [&quot;--&lt;plugin&gt;-&lt;name&gt;&quot;, [&quot;=&quot;], t]</pre><p>,</p><p>where <code>&lt;plugin&gt;</code> is the name of the plugin in which the configuration parameter is specified. (Note, the name of a plugin is the name of the file in which it is packed without the extension, e.g., a plugin <code>foo.plugin</code> has name <code>foo</code>).</p><p>When the <code>--&lt;plugin&gt;-&lt;name&gt; v</code> is specified on the command line, or a configuration file, or in the environment, then <code>get ctxt p</code> will evaluate to <code>v</code>, where <code>p</code> is the declared parameter.</p><p>The <code>as_flag</code> option makes the value part optional on the command line, so that <code>declare ~as_flag=v t name</code> extends the grammar by adding the following rules</p><pre>          common-options =
            ...
            | common-options, R | R, common-options
          R = [&quot;--&lt;plugin&gt;-&lt;name&gt;&quot;, [[&quot;=&quot;], t]]</pre><p>,</p><p>Then, if the parameter was specified on the command line without an argument, then <code>v</code> will be used as the value of the parameter.</p><p>When <code>aliases</code> are specified, then for each <code>name</code> in the aliases a <code>--&lt;plugin&gt;-&lt;name&gt;</code> option will be added.</p><p>Note, even if the name is short (i.e., consisting only of one letter) it will still be prefixed with the plugin name and interpreted as a long option, e.g., if name is <code>&quot;k&quot;</code> and the plugin name is <code>&quot;foo&quot;</code>, then the option name will be <code>&quot;--foo-k&quot;</code>.</p><p><code>Examples</code></p><p>Declaring a simple configuration parameter:</p><pre><code class="ml">open Core_kernel
open Bap_main.Extension

let depth = Configuration.parameter Type.int &quot;depth&quot;

let () =
  Bap_main.Extension.declare @@ fun ctxt -&gt;
  printf &quot;Will dive to depth %d\n&quot;
    (Configuration.get ctxt depth)</code></pre><p>The <code>Extension.Syntax</code> module adds an infix <code>(--&gt;)</code> operator for the <code>get</code> function. Using this operator the previous example could be rewritten as:</p><pre><code class="ml">open Core_kernel
open Bap_main.Extension
open Bap_main.Extension.Syntax

let depth = Configuration.parameter Type.int &quot;depth&quot;

let () =
  Bap_main.Extension.declare @@ fun ctxt -&gt;
  printf &quot;Will dive to depth %d\n&quot; (ctxt--&gt;depth)</code></pre></dd></dl><dl><dt class="spec value" id="val-parameters"><a href="#val-parameters" class="anchor"></a><code><span class="keyword">val</span> parameters : <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span>?&#8288;as_flag:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;aliases:<span>string list</span></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../index.html#type-typ">typ</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> list</span> <a href="index.html#type-param">param</a></span></code></dt><dd><p><code>parameters t name</code> declares a multi-occurring parameter.</p><p>This declaration extends the <code>common-options</code> grammar by adding the following rules</p><pre>          common-options =
            ...
            | common-options, R | R, common-options
          R = {&quot;--&lt;plugin&gt;-&lt;name&gt;&quot;, [&quot;=&quot;], t}</pre><p>,</p><p>where <code>&lt;plugin&gt;</code> is the name of the plugin in which the configuration parameter is specified. (Note, the name of a plugin is the name of the file in which it is packed without the extension, e.g., a plugin <code>foo.plugin</code> has name <code>foo</code>).</p><p>Every time the <code>--&lt;plugin&gt;-&lt;name&gt; v</code> is specified on the command line, or a configuration file, or in the environment, then <code>v</code> is added to the list to which <code>get ctxt p</code>, where <code>p</code> is the declared parameter.</p><p>The rest of the parameters have the same meaning as in the <a href="index.html#val-parameter"><code>parameter</code></a> function.</p></dd></dl><dl><dt class="spec value" id="val-flag"><a href="#val-flag" class="anchor"></a><code><span class="keyword">val</span> flag : <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span>?&#8288;aliases:<span>string list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>bool <a href="index.html#type-param">param</a></span></code></dt><dd><p><code>flag name</code> declares a parameter that can be used as a flag.</p><p>This is a specialization of a more general <a href="index.html#val-parameter"><code>parameter</code></a> function. The <code>common-options</code> grammar is extended with the following rules:</p><pre>          common-options =
            ...
            | common-options, R | R, common-options
          R = [&quot;--&lt;plugin&gt;-&lt;name&gt;&quot;]</pre><p>,</p><p>where <code>&lt;plugin&gt;</code> is the name of the plugin in which the configuration parameter is specified. (Note, the name of a plugin is the name of the file in which it is packed without the extension, e.g., a plugin <code>foo.plugin</code> has name <code>foo</code>).</p><p>When the <code>--&lt;plugin&gt;-&lt;name&gt; v</code> is specified on the command line, or in the environment, then <code>get ctxt p</code> will evaluate to <code>true</code>, where <code>p</code> is the declared parameter.</p></dd></dl><dl><dt class="spec value" id="val-determined"><a href="#val-determined" class="anchor"></a><code><span class="keyword">val</span> determined : <span><span class="type-var">'a</span> <a href="index.html#type-param">param</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../../bap-future/Bap_future/Std/index.html#type-future">Bap_future.Std.future</a></span></code></dt><dd><p><code>determined p</code> is a future that becomes determined when context is ready.</p></dd></dl><dl><dt class="spec value" id="val-version"><a href="#val-version" class="anchor"></a><code><span class="keyword">val</span> version : string</code></dt><dd><p><code>version</code> is the preconfigured application version.</p></dd></dl><dl><dt class="spec value" id="val-datadir"><a href="#val-datadir" class="anchor"></a><code><span class="keyword">val</span> datadir : string</code></dt><dd><p><code>datadir</code> a directory for user-specific BAP readonly data.</p><p>The folder is either $XDG_DATA_HOME/bap or $HOME/.local/share/bap if the former is not set.</p><p>If $HOME is also not set then it defaults just to the current workding directory.</p><p>Plugins are encouraged to use this folder as the base folder and store their information in subfolders of it.</p><p>before 2.3.0 the value of this parameter was equal to <code>sysconfdir</code></p></dd></dl><dl><dt class="spec value" id="val-cachedir"><a href="#val-cachedir" class="anchor"></a><code><span class="keyword">val</span> cachedir : string</code></dt><dd><p><code>cachedir</code> folder for user-specific non-essential data files.</p><p>It is either $XDG_CACHE_HOME/bap or $HOME/.cache/bap or $TMP/bap/cache, depending on whether the corresponding variables are set.</p><dl><dt>since</dt><dd>2.3.0</dd></dl></dd></dl><dl><dt class="spec value" id="val-sysdatadir"><a href="#val-sysdatadir" class="anchor"></a><code><span class="keyword">val</span> sysdatadir : string</code></dt><dd><p><code>sysdatadir</code> a directory for system-specific BAP readonly data</p><dl><dt>since</dt><dd>2.3.0 before that version it was named [datadir]</dd></dl></dd></dl><dl><dt class="spec value" id="val-libdir"><a href="#val-libdir" class="anchor"></a><code><span class="keyword">val</span> libdir : string</code></dt><dd><p><code>libdir</code> a directory for BAP object files, libraries, and internal binaries that are not intended to be executed directly.</p></dd></dl><dl><dt class="spec value" id="val-confdir"><a href="#val-confdir" class="anchor"></a><code><span class="keyword">val</span> confdir : string</code></dt><dd><p><code>confdir</code> a directory for BAP specific configuration files</p></dd></dl><dl><dt class="spec value" id="val-refine"><a href="#val-refine" class="anchor"></a><code><span class="keyword">val</span> refine : <span>?&#8288;provides:<span>string list</span></span> <span>&#45;&gt;</span> <span>?&#8288;exclude:<span>string list</span></span> <span>&#45;&gt;</span> <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> <a href="../../index.html#type-ctxt">ctxt</a></code></dt><dd><p><code>refine ~provides ~exclude ctxt</code> refines the context.</p><p>Refine the context by excluding from it all parameters of the plugins that do not provide a feature from <code>provides</code> or provide a feature from <code>excluded</code>.</p><p>@parameter provides (defaults to set of all features) the set of features that should be left.</p><p>@parameter exclude (defaults to the empty set) the set of features that should be excluded.</p></dd></dl><dl><dt class="spec value" id="val-plugins"><a href="#val-plugins" class="anchor"></a><code><span class="keyword">val</span> plugins : <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> <span><a href="index.html#type-info">info</a> list</span></code></dt><dd><p><code>plugins ctxt</code> enumerates all enabled plugins.</p><p>If <code>provides</code> is specified, then enumerates only plugins than provide at least one of specified feature.</p><p>If <code>exclude</code> is specified, then exclude from the list plugins, that has one of the feature specified in the <code>exclude</code> list.</p></dd></dl><dl><dt class="spec value" id="val-commands"><a href="#val-commands" class="anchor"></a><code><span class="keyword">val</span> commands : <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> <span><a href="index.html#type-info">info</a> list</span></code></dt><dd><p><code>commands ctxt</code> enumerates all available commands.</p><p>If <code>features</code> and/or <code>exclude</code> are specified, then they have the same meaning as in <code>plugins ~features ~exclude</code>.</p></dd></dl><dl><dt class="spec value" id="val-info_name"><a href="#val-info_name" class="anchor"></a><code><span class="keyword">val</span> info_name : <a href="index.html#type-info">info</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>name info</code> returns the name of a plugin or command.</p></dd></dl><dl><dt class="spec value" id="val-info_doc"><a href="#val-info_doc" class="anchor"></a><code><span class="keyword">val</span> info_doc : <a href="index.html#type-info">info</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>doc info</code> returns the short documentation.</p></dd></dl><dl><dt class="spec value" id="val-digest"><a href="#val-digest" class="anchor"></a><code><span class="keyword">val</span> digest : <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>digest context</code> returns the <code>context</code> digest.</p><p>The digest is a 128-bit MD5 sum of all options of all plugins that were selected in the context and match the filters specified by the <code>features</code> and <code>exclude</code> parameters.</p><p>See the <a href="index.html#val-plugins"><code>plugins</code></a> function for the description of the <code>features</code> and <code>exclude</code> parameters.</p><p>Note: the digest doesn't include the command options and arguments only plugins configuration options.</p></dd></dl><dl><dt class="spec value" id="val-features"><a href="#val-features" class="anchor"></a><code><span class="keyword">val</span> features : <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> <span>string list</span></code></dt><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : Stdlib.Format.formatter <span>&#45;&gt;</span> <a href="../../index.html#type-ctxt">ctxt</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>prints the context</p></dd></dl></div></body></html>