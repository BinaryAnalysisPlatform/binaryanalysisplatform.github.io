<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Compdynlink (ocaml.Compdynlink)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">ocaml</a> &#x00BB; Compdynlink</nav><h1>Module <code>Compdynlink</code></h1><p>Dynamic loading of object files.</p><nav class="toc"><ul><li><a href="#dynamic-loading-of-compiled-files">Dynamic loading of compiled files</a></li><li><a href="#access-control">Access control</a></li><li><a href="#deprecated,-low-level-api-for-access-control">Deprecated, low-level API for access control</a></li><li><a href="#deprecated,-initialization">Deprecated, initialization</a></li><li><a href="#error-reporting">Error reporting</a></li></ul></nav></header><dl><dt class="spec value" id="val-is_native"><a href="#val-is_native" class="anchor"></a><code><span class="keyword">val</span> is_native : bool</code></dt><dd><p><code>true</code> if the program is native, <code>false</code> if the program is bytecode.</p></dd></dl><section><header><h2 id="dynamic-loading-of-compiled-files"><a href="#dynamic-loading-of-compiled-files" class="anchor"></a>Dynamic loading of compiled files</h2></header><dl><dt class="spec value" id="val-loadfile"><a href="#val-loadfile" class="anchor"></a><code><span class="keyword">val</span> loadfile : string <span>&#45;&gt;</span> unit</code></dt><dd><p>In bytecode: load the given bytecode object file (<code>.cmo</code> file) or bytecode library file (<code>.cma</code> file), and link it with the running program. In native code: load the given OCaml plugin file (usually <code>.cmxs</code>), and link it with the running program. All toplevel expressions in the loaded compilation units are evaluated. No facilities are provided to access value names defined by the unit. Therefore, the unit must register itself its entry points with the main program, e.g. by modifying tables of functions.</p></dd></dl><dl><dt class="spec value" id="val-loadfile_private"><a href="#val-loadfile_private" class="anchor"></a><code><span class="keyword">val</span> loadfile_private : string <span>&#45;&gt;</span> unit</code></dt><dd><p>Same as <code>loadfile</code>, except that the compilation units just loaded are hidden (cannot be referenced) from other modules dynamically loaded afterwards.</p></dd></dl><dl><dt class="spec value" id="val-adapt_filename"><a href="#val-adapt_filename" class="anchor"></a><code><span class="keyword">val</span> adapt_filename : string <span>&#45;&gt;</span> string</code></dt><dd><p>In bytecode, the identity function. In native code, replace the last extension with <code>.cmxs</code>.</p></dd></dl></section><section><header><h2 id="access-control"><a href="#access-control" class="anchor"></a>Access control</h2></header><dl><dt class="spec value" id="val-allow_only"><a href="#val-allow_only" class="anchor"></a><code><span class="keyword">val</span> allow_only : <span>string list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>allow_only units</code> restricts the compilation units that dynamically-linked units can reference: it forbids all references to units other than those named in the list <code>units</code>. References to any other compilation unit will cause a <code>Unavailable_unit</code> error during <code>loadfile</code> or <code>loadfile_private</code>.</p><p>Initially (or after calling <code>default_available_units</code>) all compilation units composing the program currently running are available for reference from dynamically-linked units. <code>allow_only</code> can be used to restrict access to a subset of these units, e.g. to the units that compose the API for dynamically-linked code, and prevent access to all other units, e.g. private, internal modules of the running program. If <code>allow_only</code> is called several times, access will be restricted to the intersection of the given lists (i.e. a call to <code>allow_only</code> can never increase the set of available units).</p></dd></dl><dl><dt class="spec value" id="val-prohibit"><a href="#val-prohibit" class="anchor"></a><code><span class="keyword">val</span> prohibit : <span>string list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>prohibit units</code> prohibits dynamically-linked units from referencing the units named in list <code>units</code>. This can be used to prevent access to selected units, e.g. private, internal modules of the running program.</p></dd></dl><dl><dt class="spec value" id="val-default_available_units"><a href="#val-default_available_units" class="anchor"></a><code><span class="keyword">val</span> default_available_units : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Reset the set of units that can be referenced from dynamically-linked code to its default value, that is, all units composing the currently running program.</p></dd></dl><dl><dt class="spec value" id="val-allow_unsafe_modules"><a href="#val-allow_unsafe_modules" class="anchor"></a><code><span class="keyword">val</span> allow_unsafe_modules : bool <span>&#45;&gt;</span> unit</code></dt><dd><p>Govern whether unsafe object files are allowed to be dynamically linked. A compilation unit is 'unsafe' if it contains declarations of external functions, which can break type safety. By default, dynamic linking of unsafe object files is not allowed. In native code, this function does nothing; object files with external functions are always allowed to be dynamically linked.</p></dd></dl></section><section><header><h2 id="deprecated,-low-level-api-for-access-control"><a href="#deprecated,-low-level-api-for-access-control" class="anchor"></a>Deprecated, low-level API for access control</h2></header><aside><dl><dt>deprecated</dt><dd><p>The functions <code>add_interfaces</code>, <code>add_available_units</code> and <code>clear_available_units</code> should not be used in new programs, since the default initialization of allowed units, along with the <code>allow_only</code> and <code>prohibit</code> function, provides a better, safer mechanism to control access to program units. The three functions below are provided for backward compatibility only and are not available in native code.</p></dd></dl></aside><dl><dt class="spec value" id="val-add_interfaces"><a href="#val-add_interfaces" class="anchor"></a><code><span class="keyword">val</span> add_interfaces : <span>string list</span> <span>&#45;&gt;</span> <span>string list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>add_interfaces units path</code> grants dynamically-linked object files access to the compilation units named in list <code>units</code>. The interfaces (<code>.cmi</code> files) for these units are searched in <code>path</code> (a list of directory names).</p></dd></dl><dl><dt class="spec value" id="val-add_available_units"><a href="#val-add_available_units" class="anchor"></a><code><span class="keyword">val</span> add_available_units : <span><span>(string * <a href="../Stdlib/Digest/index.html#type-t">Stdlib.Digest.t</a>)</span> list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Same as <a href="../Dynlink/index.html#val-add_interfaces"><code>Dynlink.add_interfaces</code></a>, but instead of searching <code>.cmi</code> files to find the unit interfaces, uses the interface digests given for each unit. This way, the <code>.cmi</code> interface files need not be available at run-time. The digests can be extracted from <code>.cmi</code> files using the <code>extract_crc</code> program installed in the OCaml standard library directory.</p></dd></dl><dl><dt class="spec value" id="val-clear_available_units"><a href="#val-clear_available_units" class="anchor"></a><code><span class="keyword">val</span> clear_available_units : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Empty the list of compilation units accessible to dynamically-linked programs.</p></dd></dl></section><section><header><h2 id="deprecated,-initialization"><a href="#deprecated,-initialization" class="anchor"></a>Deprecated, initialization</h2></header><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : unit <span>&#45;&gt;</span> unit</code></dt><dd><dl><dt>deprecated</dt><dd><p>Initialize the <code>Dynlink</code> library. This function is called automatically when needed.</p></dd></dl></dd></dl></section><section><header><h2 id="error-reporting"><a href="#error-reporting" class="anchor"></a>Error reporting</h2></header><dl><dt class="spec type" id="type-linking_error"><a href="#type-linking_error" class="anchor"></a><code><span class="keyword">type</span> linking_error</code><code> = </code><table class="variant"><tr id="type-linking_error.Undefined_global" class="anchored"><td class="def constructor"><a href="#type-linking_error.Undefined_global" class="anchor"></a><code>| </code><code><span class="constructor">Undefined_global</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-linking_error.Unavailable_primitive" class="anchored"><td class="def constructor"><a href="#type-linking_error.Unavailable_primitive" class="anchor"></a><code>| </code><code><span class="constructor">Unavailable_primitive</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-linking_error.Uninitialized_global" class="anchored"><td class="def constructor"><a href="#type-linking_error.Uninitialized_global" class="anchor"></a><code>| </code><code><span class="constructor">Uninitialized_global</span> <span class="keyword">of</span> string</code></td></tr></table></dt><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error</code><code> = </code><table class="variant"><tr id="type-error.Not_a_bytecode_file" class="anchored"><td class="def constructor"><a href="#type-error.Not_a_bytecode_file" class="anchor"></a><code>| </code><code><span class="constructor">Not_a_bytecode_file</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-error.Inconsistent_import" class="anchored"><td class="def constructor"><a href="#type-error.Inconsistent_import" class="anchor"></a><code>| </code><code><span class="constructor">Inconsistent_import</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-error.Unavailable_unit" class="anchored"><td class="def constructor"><a href="#type-error.Unavailable_unit" class="anchor"></a><code>| </code><code><span class="constructor">Unavailable_unit</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-error.Unsafe_file" class="anchored"><td class="def constructor"><a href="#type-error.Unsafe_file" class="anchor"></a><code>| </code><code><span class="constructor">Unsafe_file</span></code></td></tr><tr id="type-error.Linking_error" class="anchored"><td class="def constructor"><a href="#type-error.Linking_error" class="anchor"></a><code>| </code><code><span class="constructor">Linking_error</span> <span class="keyword">of</span> string * <a href="index.html#type-linking_error">linking_error</a></code></td></tr><tr id="type-error.Corrupted_interface" class="anchored"><td class="def constructor"><a href="#type-error.Corrupted_interface" class="anchor"></a><code>| </code><code><span class="constructor">Corrupted_interface</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-error.File_not_found" class="anchored"><td class="def constructor"><a href="#type-error.File_not_found" class="anchor"></a><code>| </code><code><span class="constructor">File_not_found</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-error.Cannot_open_dll" class="anchored"><td class="def constructor"><a href="#type-error.Cannot_open_dll" class="anchor"></a><code>| </code><code><span class="constructor">Cannot_open_dll</span> <span class="keyword">of</span> string</code></td></tr><tr id="type-error.Inconsistent_implementation" class="anchored"><td class="def constructor"><a href="#type-error.Inconsistent_implementation" class="anchor"></a><code>| </code><code><span class="constructor">Inconsistent_implementation</span> <span class="keyword">of</span> string</code></td></tr></table></dt></dl><dl><dt class="spec exception" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Error</span> <span class="keyword">of</span> <a href="index.html#type-error">error</a></code></dt><dd><p>Errors in dynamic linking are reported by raising the <code>Error</code> exception with a description of the error.</p></dd></dl><dl><dt class="spec value" id="val-error_message"><a href="#val-error_message" class="anchor"></a><code><span class="keyword">val</span> error_message : <a href="index.html#type-error">error</a> <span>&#45;&gt;</span> string</code></dt><dd><p>Convert an error description to a printable message.</p></dd></dl></section></div></body></html>