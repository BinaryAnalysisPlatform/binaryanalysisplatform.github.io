<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bap_byteweight_signatures (bap-byteweight.Bap_byteweight_signatures)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">bap-byteweight</a> &#x00BB; Bap_byteweight_signatures</nav><header class="odoc-preamble"><h1>Module <code><span>Bap_byteweight_signatures</span></code></h1><p>Interface to the unified storage of signatures.</p><p>The signatures a key-value pairs (entries) located in one or more archives. Keys are target/compiler descriptions and values are arbitrary data.</p><p>The data types of the signature are described with the <code>Data</code> module. This library doesn't specify any data types of signature values and they are commonly provided by the libraries that define those data types, e.g., <code>Bap_byteweight.Bytes</code>.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-error"><a href="#type-error" class="anchor"></a><code><span><span class="keyword">type</span> error</span><span> = </span><span>[ </span></code><ol><li id="type-error.Corrupted" class="def constructor anchored"><a href="#type-error.Corrupted" class="anchor"></a><code><span>| </span></code><code><span>`Corrupted <span class="keyword">of</span> string</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Signature file is corrupted</p><span class="comment-delim">*)</span></div></li><li id="type-error.No_signatures" class="def constructor anchored"><a href="#type-error.No_signatures" class="anchor"></a><code><span>| </span></code><code><span>`No_signatures</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Signature file is not found</p><span class="comment-delim">*)</span></div></li><li id="type-error.No_entry" class="def constructor anchored"><a href="#type-error.No_entry" class="anchor"></a><code><span>| </span></code><code><span>`No_entry <span class="keyword">of</span> string</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Corresponding entry not found</p><span class="comment-delim">*)</span></div></li><li id="type-error.Sys_error" class="def constructor anchored"><a href="#type-error.Sys_error" class="anchor"></a><code><span>| </span></code><code><span>`Sys_error <span class="keyword">of</span> string</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>System error has occurred</p><span class="comment-delim">*)</span></div></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Error conditions</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-data"><a href="#type-data" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a data</span></span></code></div><div class="spec-doc"><p>the descriptor of the data type stored in the signature entry.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup"><a href="#val-lookup" class="anchor"></a><code><span><span class="keyword">val</span> lookup : 
  <span>?paths:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?compiler:<a href="../../bap-core-theory/Bap_core_theory/Theory/index.html#type-compiler">Bap_core_theory.Theory.compiler</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-data">data</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Core_kernel</span>.Result.t</span></span></code></div><div class="spec-doc"><p><code>lookup t f</code> looks up for the matching entry in the signature database.</p><p>The search is performed over the <code>paths</code> list that is a list of filenames. The first matching entry is selected. If a file in the <code>paths</code> list doesn't exist then it is skipped. If it exists but unreadable an error is returned.</p><p>The paths list is always appended by <code>[default_path; system_path]</code>, in that specific order.</p><p>If <code>compiler</code> is specified, then only entries that list matching compiler will be selected.</p><p>The target matches are performed with the <code>Theory.Target.matches</code> function.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : 
  <span>?compiler:<a href="../../bap-core-theory/Bap_core_theory/Theory/index.html#type-compiler">Bap_core_theory.Theory.compiler</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-data">data</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Core_kernel</span>.Result.t</span></span></code></div><div class="spec-doc"><p><code>update t f x path</code> updates or creates an entry in the signature database.</p><p>Removes all entries that match with the specified compiler, target, and data type and adds a new entry with the provided data. All unmatching entries are preserved.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Data"><a href="#module-Data" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Data/index.html">Data</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Interface for declaring signature database data types.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-save"><a href="#val-save" class="anchor"></a><code><span><span class="keyword">val</span> save : 
  <span>?comp:string <span class="arrow">&#45;&gt;</span></span>
  <span>mode:string <span class="arrow">&#45;&gt;</span></span>
  <span>path:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../bap/Bap/Std/index.html#type-arch">Bap.Std.arch</a> <span class="arrow">&#45;&gt;</span></span>
  <span>bytes <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Core_kernel</span>.Result.t</span></span></code></div><div class="spec-doc"><p><code>save ?comp ~mode ~path arch data</code> store signatures data in the database of signatures specified by the <code>path</code> parameter.</p><p>The triple <code>arch-comp-mode</code> defines a key for the created entry. If an entry with the same name existed, then it would be overwritten with the new data. If the database, doesn't exist, then it will be created and the specified destination.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> since 2022-02 use [lookup]</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : 
  <span>?comp:string <span class="arrow">&#45;&gt;</span></span>
  <span>?path:string <span class="arrow">&#45;&gt;</span></span>
  <span>mode:string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../bap/Bap/Std/index.html#type-arch">Bap.Std.arch</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(bytes, <a href="#type-error">error</a>)</span> <span class="xref-unresolved">Core_kernel</span>.Result.t</span></span></code></div><div class="spec-doc"><p><code>load ?comp ?path ~mode arch</code> finds a signature for the specified <code>arch-comp-path</code> triple.</p><p>If <code>path</code> is not set, the the signatures are looked up first in <code>default_path</code> and, if not found, in <code>system_path</code>.</p><p>Since 2.3.0 the path search has changed to look into two locations.</p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> since 2022-02 use [update]</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_path"><a href="#val-default_path" class="anchor"></a><code><span><span class="keyword">val</span> default_path : string</span></code></div><div class="spec-doc"><p>default path for the user's signatures database.</p><p>Since 2.3.0 it is pointed to the user-specific location, not to the system-wide. See also <a href="#val-system_path"><code>system_path</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-system_path"><a href="#val-system_path" class="anchor"></a><code><span><span class="keyword">val</span> system_path : string</span></code></div><div class="spec-doc"><p>the path to the system-wide location of signatures.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.3.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string_of_error"><a href="#val-string_of_error" class="anchor"></a><code><span><span class="keyword">val</span> string_of_error : <span><a href="#type-error">error</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>a human readable representation of an error.</p></div></div></div></body></html>