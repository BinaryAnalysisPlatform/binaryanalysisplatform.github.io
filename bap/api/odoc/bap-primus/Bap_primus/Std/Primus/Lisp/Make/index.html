<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (bap-primus.Bap_primus.Std.Primus.Lisp.Make)</title><link rel="stylesheet" href="../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../../index.html">Bap_primus</a> &#x00BB; <a href="../../../index.html">Std</a> &#x00BB; <a href="../../index.html">Primus</a> &#x00BB; <a href="../index.html">Lisp</a> &#x00BB; Make</nav><h1>Module <code>Lisp.Make</code></h1><p>Make(Machine) creates a Lisp machine embedded into the Primus <code>Machine</code>.</p></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-Machine/index.html">Machine</a> : <a href="../../Machine/index.html#module-type-S">Machine.S</a></code></li></ul><h3 class="heading">Signature</h3><dl><dt class="spec value" id="val-link_program"><a href="#val-link_program" class="anchor"></a><code><span class="keyword">val</span> link_program : <a href="../index.html#type-program">program</a> <span>&#45;&gt;</span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>link_program p</code> links the program <code>p</code> into the Lisp Machine. Previous program, if any, is discarded.</p></dd></dl><dl><dt class="spec value" id="val-program"><a href="#val-program" class="anchor"></a><code><span class="keyword">val</span> program : <span><a href="../index.html#type-program">program</a> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>program</code> is the current Machine program.</p></dd></dl><dl><dt class="spec value" id="val-types"><a href="#val-types" class="anchor"></a><code><span class="keyword">val</span> types : <span><a href="../Type/index.html#type-env">Type.env</a> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>types</code> returns Primus Lisp typing environment.</p></dd></dl><dl><dt class="spec value" id="val-define"><a href="#val-define" class="anchor"></a><code><span class="keyword">val</span> define : <span>?&#8288;types:<a href="../Type/index.html#type-signature">Type.signature</a></span> <span>&#45;&gt;</span> <span>?&#8288;docs:string</span> <span>&#45;&gt;</span> <span>?&#8288;package:string</span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="../index.html#type-closure">closure</a> <span>&#45;&gt;</span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>define ?docs name code</code> defines a lisp primitive with the given <code>name</code> and an optional documentation string <code>doscs</code>.</p><p>Example:</p><pre><code class="ml">open Bap_primus.Std

type Primus.exn += Bad_abs_call

module Abs(Machine : Primus.Machine.S) = struct
  let run = function
    | [x] -&gt; Value.abs x
    | _ -&gt; Machine.raise Bad_abs_call
end

...

module Library(Machine : Primus.Machine.S) = struct
  module Lisp = Primus.Lisp.Make(Machine)
  let init () = Machine.sequence [
      Lisp.define &quot;abs&quot; (module Abs);
      ...;
    ]
end</code></pre></dd></dl><dl><dt class="spec value" id="val-signal"><a href="#val-signal" class="anchor"></a><code><span class="keyword">val</span> signal : <span>?&#8288;params:<span>[&lt; <a href="../Type/index.html#type-parameters">Type.parameters</a> ]</span></span> <span>&#45;&gt;</span> <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../index.html#type-observation">observation</a></span> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span><a href="../../index.html#type-value">value</a> list</span> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span>)</span> <span>&#45;&gt;</span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>signal ?params ?docs obs proj</code> defines a new signal.</p><p>Primus Observations are reflected onto Primus Lisp signals. Each reflection is defined via the <code>signal</code> operator that establishes a mapping between an observation and a signal.</p><p>After the signal is defined, every time the observation <code>obs</code> is made, the signal <code>(signal args)</code> will be sent, where <code>signal = Observation.name obs</code> and <code>args</code> is a mapping from the observation value to a list of values.</p><p>The signal will match with the observation name. Though the same observation may produce signals with different arities.</p><dl><dt>parameter params</dt><dd><p>optional type specification</p></dd></dl><dl><dt>parameter doc</dt><dd><p>optional documentation string</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-failf"><a href="#val-failf" class="anchor"></a><code><span class="keyword">val</span> failf : <span><span>(<span class="type-var">'a</span>, unit, string, unit <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span>)</span> Core_kernel.format4</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>failf msg a1 ... am ()</code> terminates a lisp machine, and correspondingly the Primus machine with the <code>Runtime_error</code>.</p></dd></dl><dl><dt class="spec value" id="val-eval_fun"><a href="#val-eval_fun" class="anchor"></a><code><span class="keyword">val</span> eval_fun : string <span>&#45;&gt;</span> <span><a href="../../index.html#type-value">value</a> list</span> <span>&#45;&gt;</span> <span><a href="../../index.html#type-value">value</a> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>eval_fun name args</code> calls a lisp function with the given <code>name</code>, that is the most specific to the current context and is applicable to the specified list of arguments.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-eval_method"><a href="#val-eval_method" class="anchor"></a><code><span class="keyword">val</span> eval_method : string <span>&#45;&gt;</span> <span><a href="../../index.html#type-value">value</a> list</span> <span>&#45;&gt;</span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>eval_method name args</code> invokes all methods with the given <code>name</code> that are applicable in the current context to the specified list of arguments.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-link_primitives"><a href="#val-link_primitives" class="anchor"></a><code><span class="keyword">val</span> link_primitives : <a href="../index.html#type-primitives">primitives</a> <span>&#45;&gt;</span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></code></dt><dd><p><code>link_primitives prims</code> provides the primitives <code>prims</code></p></dd></dl></div></body></html>