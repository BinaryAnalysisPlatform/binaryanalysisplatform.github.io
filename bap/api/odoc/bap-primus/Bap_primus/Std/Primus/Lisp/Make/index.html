<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (bap-primus.Bap_primus.Std.Primus.Lisp.Make)</title><link rel="stylesheet" href="../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../../index.html">Bap_primus</a> &#x00BB; <a href="../../../index.html">Std</a> &#x00BB; <a href="../../index.html">Primus</a> &#x00BB; <a href="../index.html">Lisp</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Lisp.Make</span></code></h1><p>Make(Machine) creates a Lisp machine embedded into the Primus <code>Machine</code>.</p></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature_3">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Machine"><a href="#argument-1-Machine" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Machine/index.html">Machine</a></span><span> : <a href="../../Machine/module-type-S/index.html">Machine.S</a></span></code></div></div><h2 id="signature_3"><a href="#signature_3" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec value anchored" id="val-link_program"><a href="#val-link_program" class="anchor"></a><code><span><span class="keyword">val</span> link_program : <span><a href="../index.html#type-program">program</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>link_program p</code> links the program <code>p</code> into the Lisp Machine. Previous program, if any, is discarded.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-program"><a href="#val-program" class="anchor"></a><code><span><span class="keyword">val</span> program : <span><a href="../index.html#type-program">program</a> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>program</code> is the current Machine program.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-types"><a href="#val-types" class="anchor"></a><code><span><span class="keyword">val</span> types : <span><a href="../Type/index.html#type-env">Type.env</a> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>types</code> returns Primus Lisp typing environment.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-define"><a href="#val-define" class="anchor"></a><code><span><span class="keyword">val</span> define : 
  <span>?types:<a href="../Type/index.html#type-signature">Type.signature</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?docs:string <span class="arrow">&#45;&gt;</span></span>
  <span>?package:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../index.html#type-closure">closure</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>define ?docs name code</code> defines a lisp primitive with the given <code>name</code> and an optional documentation string <code>doscs</code>.</p><p>Example:</p><pre class="language-ocaml"><code>open Bap_primus.Std

type Primus.exn += Bad_abs_call

module Abs(Machine : Primus.Machine.S) = struct
  let run = function
    | [x] -&gt; Value.abs x
    | _ -&gt; Machine.raise Bad_abs_call
end

...

module Library(Machine : Primus.Machine.S) = struct
  module Lisp = Primus.Lisp.Make(Machine)
  let init () = Machine.sequence [
      Lisp.define &quot;abs&quot; (module Abs);
      ...;
    ]
end</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-signal"><a href="#val-signal" class="anchor"></a><code><span><span class="keyword">val</span> signal : 
  <span>?params:<span>[&lt; <a href="../Type/index.html#type-parameters">Type.parameters</a> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?doc:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../index.html#type-observation">observation</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../index.html#type-value">value</a> list</span> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>signal ?params ?docs obs proj</code> defines a new signal.</p><p>Primus Observations are reflected onto Primus Lisp signals. Each reflection is defined via the <code>signal</code> operator that establishes a mapping between an observation and a signal.</p><p>After the signal is defined, every time the observation <code>obs</code> is made, the signal <code>(signal args)</code> will be sent, where <code>signal = Observation.name obs</code> and <code>args</code> is a mapping from the observation value to a list of values.</p><p>The signal will match with the observation name. Though the same observation may produce signals with different arities.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">params</span> <p>optional type specification</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">doc</span> <p>optional documentation string</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-failf"><a href="#val-failf" class="anchor"></a><code><span><span class="keyword">val</span> failf : <span><span><span>(<span class="type-var">'a</span>, unit, string, <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span>)</span> <span class="xref-unresolved">Core_kernel</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>failf msg a1 ... am ()</code> terminates a lisp machine, and correspondingly the Primus machine with the <code>Runtime_error</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_fun"><a href="#val-eval_fun" class="anchor"></a><code><span><span class="keyword">val</span> eval_fun : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../index.html#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../index.html#type-value">value</a> <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>eval_fun name args</code> calls a lisp function with the given <code>name</code>, that is the most specific to the current context and is applicable to the specified list of arguments.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 1.5</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eval_method"><a href="#val-eval_method" class="anchor"></a><code><span><span class="keyword">val</span> eval_method : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../index.html#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>eval_method name args</code> invokes all methods with the given <code>name</code> that are applicable in the current context to the specified list of arguments.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 1.5</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-link_primitives"><a href="#val-link_primitives" class="anchor"></a><code><span><span class="keyword">val</span> link_primitives : <span><a href="../index.html#type-primitives">primitives</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="argument-1-Machine/index.html#type-t">Machine.t</a></span></span></code></div><div class="spec-doc"><p><code>link_primitives prims</code> provides the primitives <code>prims</code></p><ul class="at-tags"><li class="deprecated"><span class="at-tag">deprecated</span> [since 2018-03] use link_primitive instead</li></ul></div></div></div></body></html>