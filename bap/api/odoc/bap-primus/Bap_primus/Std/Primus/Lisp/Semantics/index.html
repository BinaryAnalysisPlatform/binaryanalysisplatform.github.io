<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Semantics (bap-primus.Bap_primus.Std.Primus.Lisp.Semantics)</title><link rel="stylesheet" href="../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../../index.html">Bap_primus</a> &#x00BB; <a href="../../../index.html">Std</a> &#x00BB; <a href="../../index.html">Primus</a> &#x00BB; <a href="../index.html">Lisp</a> &#x00BB; Semantics</nav><header class="odoc-preamble"><h1>Module <code><span>Lisp.Semantics</span></code></h1><p>The static semantics of Primus Lisp program.</p><p>@warning this module is currently highly experimental and is subject to change. Use with caution.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.3.0</li></ul></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-value" class="anchored"><a href="#type-value" class="anchor"></a><code><span><span class="keyword">type</span> value</span><span> = <span>unit <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-t">Bap_core_theory.Theory.Value.t</a></span></span></code></div><div class="spec-doc"><p>the representation of semantic values.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.4.0</li></ul></div></div><div class="odoc-spec"><div class="spec type extension" id="extension-decl-Unresolved_definition" class="anchored"><a href="#extension-decl-Unresolved_definition" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_core_theory.KB.conflict</a> += </span></code><table><tr id="extension-Unresolved_definition" class="anchored"><td class="def extension"><a href="#extension-Unresolved_definition" class="anchor"></a><code><span>| </span><span><span class="extension">Unresolved_definition</span> <span class="keyword">of</span> string</span></code></td></tr></table></div><div class="spec-doc"><p>occurs when no matching definition is found</p><p>The reason why no match is selected is provided as the payload.</p></div></div><div class="odoc-spec"><div class="spec type extension" id="extension-decl-Illtyped_program" class="anchored"><a href="#extension-decl-Illtyped_program" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_core_theory.KB.conflict</a> += </span></code><table><tr id="extension-Illtyped_program" class="anchored"><td class="def extension"><a href="#extension-Illtyped_program" class="anchor"></a><code><span>| </span><span><span class="extension">Illtyped_program</span> <span class="keyword">of</span> <span><a href="../Type/index.html#type-error">Type.error</a> list</span></span></code></td></tr></table></div><div class="spec-doc"><p>occurs when the Lisp program is ill-typed</p></div></div><div class="odoc-spec"><div class="spec type extension" id="extension-decl-Failed_primitive" class="anchored"><a href="#extension-decl-Failed_primitive" class="anchor"></a><code><span><span class="keyword">type</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_core_theory.KB.conflict</a> += </span></code><table><tr id="extension-Failed_primitive" class="anchored"><td class="def extension"><a href="#extension-Failed_primitive" class="anchor"></a><code><span>| </span><span><span class="extension">Failed_primitive</span> <span class="keyword">of</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/Name/index.html#type-t">Bap_core_theory.KB.Name.t</a> * string</span></code></td></tr></table></div><div class="spec-doc"><p>occurs when a primitive fails.</p><p>See also, <a href="#val-failp"><code>failp</code></a></p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.4.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-program" class="anchored"><a href="#val-program" class="anchor"></a><code><span><span class="keyword">val</span> program : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Source/index.html#type-cls">Bap_core_theory.Theory.Source.cls</a>, <a href="../index.html#type-program">program</a> )</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>a property of the program source object in which a Lisp program is stored.</p><p>This property is used by the Lisp semantics provider to lookup for the definitions.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-context" class="anchored"><a href="#val-context" class="anchor"></a><code><span><span class="keyword">val</span> context : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Unit/index.html#type-cls">Bap_core_theory.Theory.Unit.cls</a>, <a href="../index.html#type-context">context</a> )</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>Primus Lisp definitions constraints.</p><p>The set of type classes that describe the unit constraints and limits applicability of Primus Lisp definitions to the selected compilation unit.</p><p>Each Primus Lisp definition has a <a href="#val-context"><code>context</code></a> class of its applicability. The definition will only be used if its context is a subtype of the unit context.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-definition" class="anchored"><a href="#val-definition" class="anchor"></a><code><span><span class="keyword">val</span> definition : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>, <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Label/index.html#type-t">Bap_core_theory.Theory.Label.t</a> option</span> )</span>
    <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>The Primus Lisp definition to which the program belongs.</p><p>This property stores the label to the original program for which the semantics was requested. It is useful in the implementation of primitives that require access to the context, for example, to access the original instruction address (when Primus Lisp is used to represent the semantics of an instruction) or to the declared attribute of the Primus Lisp definition.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-name" class="anchored"><a href="#val-name" class="anchor"></a><code><span><span class="keyword">val</span> name : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>, <span><a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/Name/index.html#type-t">Bap_core_theory.KB.Name.t</a> option</span> )</span>
    <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>the name of a lisp program</p></div></div><div class="odoc-spec"><div class="spec value" id="val-args" class="anchored"><a href="#val-args" class="anchor"></a><code><span><span class="keyword">val</span> args : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>,
    <span><span><span>unit <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-t">Bap_core_theory.Theory.Value.t</a></span> list</span> option</span> )</span>
    <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>the arguments of a lisp program</p></div></div><div class="odoc-spec"><div class="spec value" id="val-symbol" class="anchored"><a href="#val-symbol" class="anchor"></a><code><span><span class="keyword">val</span> symbol : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-cls">Bap_core_theory.Theory.Value.cls</a>, <span><span class="xref-unresolved">Core_kernel</span>.String.t option</span> )</span>
    <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>a statically known symbolic value</p></div></div><div class="odoc-spec"><div class="spec value" id="val-static" class="anchored"><a href="#val-static" class="anchor"></a><code><span><span class="keyword">val</span> static : 
  <span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-cls">Bap_core_theory.Theory.Value.cls</a>, <span><a href="../../../../../../bitvec/Bitvec/index.html#type-t">Bitvec.t</a> option</span> )</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></span></code></div><div class="spec-doc"><p>a statically known value of an operation</p></div></div><div class="odoc-spec"><div class="spec value" id="val-enable" class="anchored"><a href="#val-enable" class="anchor"></a><code><span><span class="keyword">val</span> enable : <span>?stdout:<span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>enable ()</code> enables the semantics of Primus Lisp programs.</p><p>This function registers a rule in the knowledge base that has the following form,</p><pre>              -- reifies Primus Lisp definitions
              primus-lisp-semantics ::=
                bap:primus-lisp-program
                core-theory:unit-target
                core-theory:unit-source
                core-theory:label-unit
                bap:lisp-args
                bap:lisp-name
                -----------------------
                core-theory:semantics</pre><p>The rule provides semantics to the program objects that have a unit with Primus Lisp source code available (the <a href="#val-program"><code>program</code></a> property).</p><p>This function is by default called by the <code>primus-lisp</code> plugin. This plugin also implements core primitives and provides a loader that will load all features specified via the <code>--primus-lisp-load</code> command-line argument to any Primus Lisp unit. Therefore, if the <code>primus-lisp</code> plugin is loaded in order to reify a lisp definition into a <code>Theory</code>.Semantics value, use the following code,</p><pre><code>let reify_def name : unit Theory.eff =
  Theory.Label.for_name name &gt;&gt;= fun obj -&gt;
  Unit.create Theory.Target.unknown &gt;&gt;= fun unit -&gt;
  KB.provide Theory.Label.unit obj (Some unit) &gt;&gt;= fun () -&gt;
  KB.collect Theory.Semantics.slot obj</code></pre><p>Note, if you don't want to use the program loader provided by the <code>primus-lisp</code> plugin then just set manually the source field with the Lisp program of you choice.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">stdout</span> <p>is the formatter that is used by the <code>msg</code> form to print messages.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-declare" class="anchored"><a href="#val-declare" class="anchor"></a><code><span><span class="keyword">val</span> declare : 
  <span>?types:<a href="../Type/index.html#type-signature">Type.signature</a> <span class="arrow">&#45;&gt;</span></span>
  <span>?docs:string <span class="arrow">&#45;&gt;</span></span>
  <span>?package:string <span class="arrow">&#45;&gt;</span></span>
  <span>?body:
    <span>( <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span class="arrow">&#45;&gt;</span></span>
      <span><span>( <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Label/index.html#type-t">Bap_core_theory.Theory.Label.t</a> <span class="arrow">&#45;&gt;</span></span>
        <span><span><a href="#type-value">value</a> list</span> <span class="arrow">&#45;&gt;</span></span>
        <span>unit <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-eff">Bap_core_theory.Theory.eff</a></span> )</span>
        <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-t">Bap_core_theory.KB.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>Primus primitives.</p><p>New primitives are implemented as a knowledge base promises to provide <code>Theory.Semantics.slot</code> for an object that has the <code>primitive</code> property.</p><p>Example,</p><pre><code>KB.promise Theory.Semantics.slot @@ fun obj -&gt;
KB.collect Sema.primitive obj &gt;&gt;= function
| None -&gt; Insn.empty
| Some p -&gt; match Primitive.name p with
  | &quot;boo&quot; -&gt;
    Theory.instance () &gt;&gt;= Theory.require &gt;&gt;=
    fun (module CT) -&gt;
    (* ... operations in CT ... *)

  | _ -&gt; !!Insn.empty</code></pre></div></div><div class="odoc-spec"><div class="spec value" id="val-signal" class="anchored"><a href="#val-signal" class="anchor"></a><code><span><span class="keyword">val</span> signal : 
  <span>?params:<span>[&lt; <a href="../Type/index.html#type-parameters">Type.parameters</a> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?docs:string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>( <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>, <span class="type-var">'p</span> )</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Label/index.html#type-t">Bap_core_theory.Theory.Label.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'p</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-value">value</a> list</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-t">Bap_core_theory.KB.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>signal ~params ~docs property args</code> declares a signal.</p><p>Emits a signal with arguments <code>args l v</code>, when the <code>property</code> value of a program label <code>l</code> changes to <code>v</code>. The name of the signal is the same as the name of the property.</p><p>The signal triggers all methods with the same method name as the signal.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.4.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-failp" class="anchored"><a href="#val-failp" class="anchor"></a><code><span><span class="keyword">val</span> failp : 
  <span><span><span>( <span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span><span class="type-var">'b</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-t">Bap_core_theory.KB.t</a></span> )</span>
    <span class="xref-unresolved">Core_kernel</span>.format4</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>failp err_msg args...</code> terminates a primitive with error.</p><p>Must be called from a primitive implementation to stop the evaluation with the <code>Failed_primitive</code> conflict.</p><p>This conflict should used to report programmer errors that are not representable via the type system (or slipped through the gradual type checker).</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.4.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-documentation" class="anchored"><a href="#val-documentation" class="anchor"></a><code><span><span class="keyword">val</span> documentation : 
  <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Unit/index.html#type-t">Bap_core_theory.Theory.Unit.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Doc/index.html#type-index">Doc.index</a> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-t">Bap_core_theory.KB.t</a></span></span></code></div><div class="spec-doc"><p><code>documentation unit</code> documentation for <code>unit</code>'s lisp source.</p><p>Typechecks and loads the unit lisp source and generates its documentation.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Value" class="anchored"><a href="#module-Value" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Value/index.html">Value</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Pure semantic value.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Effect" class="anchored"><a href="#module-Effect" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Effect/index.html">Effect</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Effectful semantic values.</p></div></div></div></body></html>