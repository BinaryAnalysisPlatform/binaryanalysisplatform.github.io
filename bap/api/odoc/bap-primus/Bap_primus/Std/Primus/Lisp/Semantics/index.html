<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Semantics (bap-primus.Bap_primus.Std.Primus.Lisp.Semantics)</title><link rel="stylesheet" href="../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../../index.html">Bap_primus</a> &#x00BB; <a href="../../../index.html">Std</a> &#x00BB; <a href="../../index.html">Primus</a> &#x00BB; <a href="../index.html">Lisp</a> &#x00BB; Semantics</nav><h1>Module <code>Lisp.Semantics</code></h1><p>The static semantics of Primus Lisp program.</p><p>@warning this module is currently highly experimental and is subject to change. Use with caution.</p><dl><dt>since</dt><dd>2.3.0</dd></dl></header><dl><dt class="spec extension"><code><span class="keyword">type</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_core_theory.KB.conflict</a> += </code><code><span class="extension">Unresolved_definition</span> <span class="keyword">of</span> string</code></dt><dd><p>occurs when no matching definition is found</p><p>The reason why no match is selected is provided as the payload.</p></dd></dl><dl><dt class="spec extension"><code><span class="keyword">type</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_core_theory.KB.conflict</a> += </code><code><span class="extension">Illtyped_program</span> <span class="keyword">of</span> <span><a href="../Type/index.html#type-error">Type.error</a> list</span></code></dt><dd><p>occurs when the Lisp program is ill-typed</p></dd></dl><dl><dt class="spec value" id="val-program"><a href="#val-program" class="anchor"></a><code><span class="keyword">val</span> program : <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Source/index.html#type-cls">Bap_core_theory.Theory.Source.cls</a>, <a href="../index.html#type-program">program</a>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></code></dt><dd><p>a property of the program source object in which a Lisp program is stored.</p><p>This property is used by the Lisp semantics provider to lookup for the definitions.</p></dd></dl><dl><dt class="spec value" id="val-definition"><a href="#val-definition" class="anchor"></a><code><span class="keyword">val</span> definition : <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>, <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Label/index.html#type-t">Bap_core_theory.Theory.Label.t</a> option</span>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></code></dt><dd><p>The Primus Lisp definition to which the program belongs.</p><p>This property stores the label to the original program for which the semantics was requested. It is useful in the implementation of primitives that require access to the context, for example, to access the original instruction address (when Primus Lisp is used to represent the semantics of an instruction) or to the declared attribute of the Primus Lisp definition.</p></dd></dl><dl><dt class="spec value" id="val-name"><a href="#val-name" class="anchor"></a><code><span class="keyword">val</span> name : <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>, <span><a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/Name/index.html#type-t">Bap_core_theory.KB.Name.t</a> option</span>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></code></dt><dd><p>the name of a lisp program</p></dd></dl><dl><dt class="spec value" id="val-args"><a href="#val-args" class="anchor"></a><code><span class="keyword">val</span> args : <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-program">Bap_core_theory.Theory.program</a>, <span><span><span>unit <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-t">Bap_core_theory.Theory.Value.t</a></span> list</span> option</span>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></code></dt><dd><p>the arguments of a lisp program</p></dd></dl><dl><dt class="spec value" id="val-symbol"><a href="#val-symbol" class="anchor"></a><code><span class="keyword">val</span> symbol : <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-cls">Bap_core_theory.Theory.Value.cls</a>, <span>Core_kernel.String.t option</span>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></code></dt><dd><p>a statically known symbolic value</p></dd></dl><dl><dt class="spec value" id="val-static"><a href="#val-static" class="anchor"></a><code><span class="keyword">val</span> static : <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/index.html#type-cls">Bap_core_theory.Theory.Value.cls</a>, <span><a href="../../../../../../bitvec/Bitvec/index.html#type-t">Bitvec.t</a> option</span>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-slot">Bap_core_theory.KB.slot</a></span></code></dt><dd><p>a statically known value of an operation</p></dd></dl><dl><dt class="spec value" id="val-enable"><a href="#val-enable" class="anchor"></a><code><span class="keyword">val</span> enable : <span>?&#8288;stdout:Stdlib.Format.formatter</span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>enable ()</code> enables the semantics of Primus Lisp programs.</p><p>This function registers a rule in the knowledge base that has the following form,</p><pre>              -- reifies Primus Lisp definitions
              primus-lisp-semantics ::=
                bap:primus-lisp-program
                core-theory:unit-target
                core-theory:unit-source
                core-theory:label-unit
                bap:lisp-args
                bap:lisp-name
                -----------------------
                core-theory:semantics</pre><p>The rule provides semantics to the program objects that have a unit with Primus Lisp source code available (the <a href="index.html#val-program"><code>program</code></a> property).</p><p>This function is by default called by the <code>primus-lisp</code> plugin. This plugin also implements core primitives and provides a loader that will load all features specified via the <code>--primus-lisp-load</code> command-line argument to any Primus Lisp unit. Therefore, if the <code>primus-lisp</code> plugin is loaded in order to reify a lisp definition into a <span class="xref-unresolved" title="unresolved reference to &quot;Theory.Semantics&quot;"><code>Theory</code>.Semantics</span> value, use the following code,</p><pre><code class="ml">let reify_def name : unit Theory.eff =
  Theory.Label.for_name name &gt;&gt;= fun obj -&gt;
  Unit.create Theory.Target.unknown &gt;&gt;= fun unit -&gt;
  KB.provide Theory.Label.unit obj (Some unit) &gt;&gt;= fun () -&gt;
  KB.collect Theory.Semantics.slot obj</code></pre><p>Note, if you don't want to use the program loader provided by the <code>primus-lisp</code> plugin then just set manually the source field with the Lisp program of you choice.</p><dl><dt>parameter stdout</dt><dd><p>is the formatter that is used by the <code>msg</code> form to print messages.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-declare"><a href="#val-declare" class="anchor"></a><code><span class="keyword">val</span> declare : <span>?&#8288;types:<a href="../Type/index.html#type-signature">Type.signature</a></span> <span>&#45;&gt;</span> <span>?&#8288;docs:string</span> <span>&#45;&gt;</span> <span>?&#8288;package:string</span> <span>&#45;&gt;</span> <span>?&#8288;body:<span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span>&#45;&gt;</span> <span><span>(<a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Label/index.html#type-t">Bap_core_theory.Theory.Label.t</a> <span>&#45;&gt;</span> <span><a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Value/Top/index.html#type-t">Bap_core_theory.Theory.Value.Top.t</a> list</span> <span>&#45;&gt;</span> <span>unit <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/index.html#type-eff">Bap_core_theory.Theory.eff</a></span>)</span> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-t">Bap_core_theory.KB.t</a></span>)</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p>Primus primitives.</p><p>New primitives are implemented as a knowledge base promises to provide <code>Theory.Semantics.slot</code> for an object that has the <code>primitive</code> property.</p><p>Example,</p><pre><code class="ml">KB.promise Theory.Semantics.slot @@ fun obj -&gt;
KB.collect Sema.primitive obj &gt;&gt;= function
| None -&gt; Insn.empty
| Some p -&gt; match Primitive.name p with
  | &quot;boo&quot; -&gt;
    Theory.instance () &gt;&gt;= Theory.require &gt;&gt;=
    fun (module CT) -&gt;
    (* ... operations in CT ... *)

  | _ -&gt; !!Insn.empty</code></pre></dd></dl><dl><dt class="spec value" id="val-documentation"><a href="#val-documentation" class="anchor"></a><code><span class="keyword">val</span> documentation : <a href="../../../../../../bap-core-theory/Bap_core_theory/Theory/Unit/index.html#type-t">Bap_core_theory.Theory.Unit.t</a> <span>&#45;&gt;</span> <span><a href="../Doc/index.html#type-index">Doc.index</a> <a href="../../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-t">Bap_core_theory.KB.t</a></span></code></dt><dd><p><code>documentation unit</code> documentation for <code>unit</code>'s lisp source.</p><p>Typechecks and loads the unit lisp source and generates its documentation.</p></dd></dl></div></body></html>