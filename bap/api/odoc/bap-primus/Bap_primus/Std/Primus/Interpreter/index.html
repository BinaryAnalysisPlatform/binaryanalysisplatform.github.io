<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Interpreter (bap-primus.Bap_primus.Std.Primus.Interpreter)</title><link rel="stylesheet" href="../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../index.html">Bap_primus</a> &#x00BB; <a href="../../index.html">Std</a> &#x00BB; <a href="../index.html">Primus</a> &#x00BB; Interpreter</nav><h1>Module <code>Primus.Interpreter</code></h1><p>The Interpreter.</p><p>The Interpreter is the core component of the Primus Machine. It provides lots of observations, giving other components an ability to track every event that happens during the program evaluation. The components can affect the results of evaluation in a limited way, by affecting the state of the components that are used by the Interpreter, name the Environment and the Memory.</p><p>Note: we the <code>observation (x,y,z)</code> notation in the documentation to denote an observation of a value represented with the <code>(x,y,z)</code> tuple, that in fact corresponds to <code>observation &gt;&gt;&gt; fun (x,y,z)</code> -&gt; ...</p></header><dl><dt class="spec value" id="val-pc_change"><a href="#val-pc_change" class="anchor"></a><code><span class="keyword">val</span> pc_change : <span><a href="../../../../../bap/Bap/Std/index.html#type-addr">Bap.Std.addr</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>pc_change x</code> happens every time a code at address <code>x</code> is executed.</p></dd></dl><dl><dt class="spec value" id="val-loading"><a href="#val-loading" class="anchor"></a><code><span class="keyword">val</span> loading : <span><a href="../index.html#type-value">value</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>loading x</code> happens before a value from the address <code>x</code> is loaded by the interpreter from the memory.</p></dd></dl><dl><dt class="spec value" id="val-loaded"><a href="#val-loaded" class="anchor"></a><code><span class="keyword">val</span> loaded : <span><span>(<a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>loaded (addr,value)</code> happens after the <code>value</code> is loaded from the address <code>addr</code>.</p></dd></dl><dl><dt class="spec value" id="val-storing"><a href="#val-storing" class="anchor"></a><code><span class="keyword">val</span> storing : <span><a href="../index.html#type-value">value</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>storing x</code> happens before a value is stored at address <code>x</code></p></dd></dl><dl><dt class="spec value" id="val-stored"><a href="#val-stored" class="anchor"></a><code><span class="keyword">val</span> stored : <span><span>(<a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>stored (addr,value)</code> happens after the <code>value</code> is stored at the address <code>addr</code></p></dd></dl><dl><dt class="spec value" id="val-reading"><a href="#val-reading" class="anchor"></a><code><span class="keyword">val</span> reading : <span><a href="../../../../../bap/Bap/Std/index.html#type-var">Bap.Std.var</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>reading x</code> happens before the variable <code>x</code> is read from the environment.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <span><span>(<a href="../../../../../bap/Bap/Std/index.html#type-var">Bap.Std.var</a> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>read (var,x)</code> happens after a variable <code>var</code> is evaluated to the value <code>x</code></p></dd></dl><dl><dt class="spec value" id="val-writing"><a href="#val-writing" class="anchor"></a><code><span class="keyword">val</span> writing : <span><a href="../../../../../bap/Bap/Std/index.html#type-var">Bap.Std.var</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>writing v</code> happens before a value is written to the variable <code>v</code></p></dd></dl><dl><dt class="spec value" id="val-written"><a href="#val-written" class="anchor"></a><code><span class="keyword">val</span> written : <span><span>(<a href="../../../../../bap/Bap/Std/index.html#type-var">Bap.Std.var</a> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>written (v,x)</code> happens after <code>x</code> is assigned to <code>v</code></p></dd></dl><dl><dt class="spec value" id="val-jumping"><a href="#val-jumping" class="anchor"></a><code><span class="keyword">val</span> jumping : <span><span>(<a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>jumping (cond,dest)</code> happens just before a jump to <code>dest</code> is taken under the specified condition <code>cond</code>. Note: <code>cond</code> is always <code>true</code></p><dl><dt>since</dt><dd>1.5.0</dd></dl></dd></dl><dl><dt class="spec value" id="val-eval_cond"><a href="#val-eval_cond" class="anchor"></a><code><span class="keyword">val</span> eval_cond : <span><a href="../index.html#type-value">value</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>eval_cond v</code> occurs every time the <code>cond</code> part of a jump is evaluated.</p><dl><dt>since</dt><dd>1.5.0</dd></dl></dd></dl><dl><dt class="spec value" id="val-undefined"><a href="#val-undefined" class="anchor"></a><code><span class="keyword">val</span> undefined : <span><a href="../index.html#type-value">value</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>undefined x</code> happens when a computation produces an undefined value <code>x</code>.</p></dd></dl><dl><dt class="spec value" id="val-const"><a href="#val-const" class="anchor"></a><code><span class="keyword">val</span> const : <span><a href="../index.html#type-value">value</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>const x</code> happens when a constant <code>x</code> is created</p></dd></dl><dl><dt class="spec value" id="val-binop"><a href="#val-binop" class="anchor"></a><code><span class="keyword">val</span> binop : <span><span>(<span>(<a href="../../../../../bap/Bap/Std/index.html#type-binop">Bap.Std.binop</a> * <a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a>)</span> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>binop ((op,x,y),r)</code> happens after the binary operation <code>op</code> is applied to values <code>x</code> and <code>y</code> and evaluates to <code>r</code></p></dd></dl><dl><dt class="spec value" id="val-unop"><a href="#val-unop" class="anchor"></a><code><span class="keyword">val</span> unop : <span><span>(<span>(<a href="../../../../../bap/Bap/Std/index.html#type-unop">Bap.Std.unop</a> * <a href="../index.html#type-value">value</a>)</span> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>unop ((op,x),r)</code> happens after the unary operation <code>op</code> is applied to <code>x</code> and results <code>r</code></p></dd></dl><dl><dt class="spec value" id="val-cast"><a href="#val-cast" class="anchor"></a><code><span class="keyword">val</span> cast : <span><span>(<span>(<a href="../../../../../bap/Bap/Std/index.html#type-cast">Bap.Std.cast</a> * int * <a href="../index.html#type-value">value</a>)</span> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>cast ((t,x),r)</code> happens after <code>x</code> is casted to <code>r</code> using the casting type <code>t</code></p></dd></dl><dl><dt class="spec value" id="val-extract"><a href="#val-extract" class="anchor"></a><code><span class="keyword">val</span> extract : <span><span>(<span>(int * int * <a href="../index.html#type-value">value</a>)</span> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>extract ((hi,lo,x),r)</code> happens after <code>r</code> is extracted from <code>x</code></p></dd></dl><dl><dt class="spec value" id="val-concat"><a href="#val-concat" class="anchor"></a><code><span class="keyword">val</span> concat : <span><span>(<span>(<a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a>)</span> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>extract ((x,y),z)</code> happens after <code>x</code> is concatenated with <code>y</code> and produces <code>z</code> as a result.</p></dd></dl><dl><dt class="spec value" id="val-ite"><a href="#val-ite" class="anchor"></a><code><span class="keyword">val</span> ite : <span><span>(<span>(<a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a> * <a href="../index.html#type-value">value</a>)</span> * <a href="../index.html#type-value">value</a>)</span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>ite ((cond, yes, no), res)</code> happens after the ite expression that corresponds to ite(<code>cond</code>, <code>yes</code>, <code>no</code>) is evaluated to <code>res</code>.</p></dd></dl><dl><dt class="spec value" id="val-enter_term"><a href="#val-enter_term" class="anchor"></a><code><span class="keyword">val</span> enter_term : <span><a href="../../../../../bap/Bap/Std/index.html#type-tid">Bap.Std.tid</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>an identifier of a term that will be executed next.</p></dd></dl><dl><dt class="spec value" id="val-leave_term"><a href="#val-leave_term" class="anchor"></a><code><span class="keyword">val</span> leave_term : <span><a href="../../../../../bap/Bap/Std/index.html#type-tid">Bap.Std.tid</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>an identifier of a term that just finished the execution.</p></dd></dl><dl><dt class="spec value" id="val-enter_pos"><a href="#val-enter_pos" class="anchor"></a><code><span class="keyword">val</span> enter_pos : <span><a href="../index.html#type-pos">pos</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>new program locatio entered</p></dd></dl><dl><dt class="spec value" id="val-leave_pos"><a href="#val-leave_pos" class="anchor"></a><code><span class="keyword">val</span> leave_pos : <span><a href="../index.html#type-pos">pos</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a program location left</p></dd></dl><dl><dt class="spec value" id="val-enter_sub"><a href="#val-enter_sub" class="anchor"></a><code><span class="keyword">val</span> enter_sub : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a subroutine entered</p></dd></dl><dl><dt class="spec value" id="val-enter_arg"><a href="#val-enter_arg" class="anchor"></a><code><span class="keyword">val</span> enter_arg : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-arg">Bap.Std.arg</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a subroutine argument is entered</p></dd></dl><dl><dt class="spec value" id="val-enter_blk"><a href="#val-enter_blk" class="anchor"></a><code><span class="keyword">val</span> enter_blk : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-blk">Bap.Std.blk</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a basic block is entered</p></dd></dl><dl><dt class="spec value" id="val-enter_phi"><a href="#val-enter_phi" class="anchor"></a><code><span class="keyword">val</span> enter_phi : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-phi">Bap.Std.phi</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a phi-node is entered</p></dd></dl><dl><dt class="spec value" id="val-enter_def"><a href="#val-enter_def" class="anchor"></a><code><span class="keyword">val</span> enter_def : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-def">Bap.Std.def</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a definition is entered</p></dd></dl><dl><dt class="spec value" id="val-enter_jmp"><a href="#val-enter_jmp" class="anchor"></a><code><span class="keyword">val</span> enter_jmp : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-jmp">Bap.Std.jmp</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a jump term is entered</p></dd></dl><dl><dt class="spec value" id="val-leave_sub"><a href="#val-leave_sub" class="anchor"></a><code><span class="keyword">val</span> leave_sub : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a subroutine was left</p></dd></dl><dl><dt class="spec value" id="val-leave_arg"><a href="#val-leave_arg" class="anchor"></a><code><span class="keyword">val</span> leave_arg : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-arg">Bap.Std.arg</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a subroutine argument was left</p></dd></dl><dl><dt class="spec value" id="val-leave_blk"><a href="#val-leave_blk" class="anchor"></a><code><span class="keyword">val</span> leave_blk : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-blk">Bap.Std.blk</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a basic block was left</p></dd></dl><dl><dt class="spec value" id="val-leave_phi"><a href="#val-leave_phi" class="anchor"></a><code><span class="keyword">val</span> leave_phi : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-phi">Bap.Std.phi</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a phi-node was left</p></dd></dl><dl><dt class="spec value" id="val-leave_def"><a href="#val-leave_def" class="anchor"></a><code><span class="keyword">val</span> leave_def : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-def">Bap.Std.def</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a definition was left</p></dd></dl><dl><dt class="spec value" id="val-leave_jmp"><a href="#val-leave_jmp" class="anchor"></a><code><span class="keyword">val</span> leave_jmp : <span><span><a href="../../../../../bap/Bap/Std/index.html#type-jmp">Bap.Std.jmp</a> <a href="../../../../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>a jump term was left</p></dd></dl><dl><dt class="spec value" id="val-enter_exp"><a href="#val-enter_exp" class="anchor"></a><code><span class="keyword">val</span> enter_exp : <span><a href="../../../../../bap/Bap/Std/index.html#type-exp">Bap.Std.exp</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>an expression was entered</p></dd></dl><dl><dt class="spec value" id="val-leave_exp"><a href="#val-leave_exp" class="anchor"></a><code><span class="keyword">val</span> leave_exp : <span><a href="../../../../../bap/Bap/Std/index.html#type-exp">Bap.Std.exp</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>an expression was left</p></dd></dl><dl><dt class="spec value" id="val-halting"><a href="#val-halting" class="anchor"></a><code><span class="keyword">val</span> halting : <span>unit <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p>occurs on <code>halt</code> operation</p></dd></dl><dl><dt class="spec value" id="val-interrupt"><a href="#val-interrupt" class="anchor"></a><code><span class="keyword">val</span> interrupt : <span>int <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>interrupt n</code> occurs on the machine interrupt <code>n</code> (aka CPU exception)</p></dd></dl><dl><dt class="spec value" id="val-division_by_zero"><a href="#val-division_by_zero" class="anchor"></a><code><span class="keyword">val</span> division_by_zero : <span>unit <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>division_by_zero</code> occurs just before the division by zero trap is signaled.</p><p>See the <code>binop</code> operation and <code>division_by_zero_handler</code> for more information.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-pagefault"><a href="#val-pagefault" class="anchor"></a><code><span class="keyword">val</span> pagefault : <span><a href="../../../../../bap/Bap/Std/index.html#type-addr">Bap.Std.addr</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>pagefault x</code> occurs just before the pagefault trap is signaled.</p><p>See <code>load</code> and <code>store</code> operations, and <code>pagefault_handler</code> for more information.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-segfault"><a href="#val-segfault" class="anchor"></a><code><span class="keyword">val</span> segfault : <span><a href="../../../../../bap/Bap/Std/index.html#type-addr">Bap.Std.addr</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>segfault x</code> occurs when an invalid memory operation is performed on the address <code>x</code>. See the <code>load</code> and <code>store</code> operations for more.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-segfault"><a href="#val-segfault" class="anchor"></a><code><span class="keyword">val</span> segfault : <span><a href="../../../../../bap/Bap/Std/index.html#type-addr">Bap.Std.addr</a> <a href="../index.html#type-observation">observation</a></span></code></dt><dd><p><code>cfi_violation x</code> occurs when the CFI is not preserved. The control flow integrity (CFI) is violated when a call doesn't return to an expected place. This might be an indicator of malicious code or an improper control flow graph.</p><p>After the observation is made the <code>cfi_violation</code> trap is signaled, which could be handled via the <code>cfi_violation_handler</code>.</p><dl><dt>since</dt><dd>1.7</dd></dl></dd></dl><dl><dt class="spec extension"><code><span class="keyword">type</span> <a href="../index.html#type-exn">exn</a> += </code><code><span class="extension">Halt</span></code></dt><dd><p>is raised when a computation is halted</p></dd></dl><dl><dt class="spec extension"><code><span class="keyword">type</span> <a href="../index.html#type-exn">exn</a> += </code><code><span class="extension">Division_by_zero</span></code></dt><dd><p>is raised by a machine that attempts to divide by zero</p></dd></dl><dl><dt class="spec extension"><code><span class="keyword">type</span> <a href="../index.html#type-exn">exn</a> += </code><code><span class="extension">Segmentation_fault</span> <span class="keyword">of</span> <a href="../../../../../bap/Bap/Std/index.html#type-addr">Bap.Std.addr</a></code></dt><dd><p>is raised when a memory operation has failed.</p></dd></dl><dl><dt class="spec value" id="val-pagefault_handler"><a href="#val-pagefault_handler" class="anchor"></a><code><span class="keyword">val</span> pagefault_handler : string</code></dt><dd><p><code>pagefault_hanlder</code> is a trap handler that is invoked when the <code>Pagefault</code> exception is raised by the machine memory component. If the handler is provided via the Linker, then it is invoked, otherwise a segmentation fault is raised. If the handler returns normally then the faulty operation is repeated.</p><p>Note, page faults are usually handled together with the <code>pagefault</code> observation.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-division_by_zero_handler"><a href="#val-division_by_zero_handler" class="anchor"></a><code><span class="keyword">val</span> division_by_zero_handler : string</code></dt><dd><p><code>division_by_zero_hanlder</code> is a trap handler for the Division_by_zero exception. If it is linked into the machine, then it will be invoked when the division by zero trap is signaled. If it returns normally, then the result of the faulty operation is undefined.</p><dl><dt>since</dt><dd>1.5</dd></dl></dd></dl><dl><dt class="spec value" id="val-cfi_violation_handler"><a href="#val-cfi_violation_handler" class="anchor"></a><code><span class="keyword">val</span> cfi_violation_handler : string</code></dt><dd><p><code>division_by_zero</code> is the name of a trap handler for the <code>Cfi_violation</code> exception. If it is linked into the machine, then it will be invoked when the cfi-violation trap is signaled. If it returns normally, then the result of the faulty operation is undefined.</p></dd></dl><dl><dt class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-Machine/index.html">Machine</a> : <a href="../Machine/index.html#module-type-S">Machine.S</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Make(Machine) makes an interpreter that computes in the given <code>Machine</code>.</p></dd></dl></div></body></html>