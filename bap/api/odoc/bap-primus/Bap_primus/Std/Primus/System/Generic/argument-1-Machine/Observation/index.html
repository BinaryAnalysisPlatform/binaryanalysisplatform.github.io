<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Observation (bap-primus.Bap_primus.Std.Primus.System.Generic.1-Machine.Observation)</title><link rel="stylesheet" href="../../../../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../../../../index.html">Bap_primus</a> &#x00BB; <a href="../../../../../index.html">Std</a> &#x00BB; <a href="../../../../index.html">Primus</a> &#x00BB; <a href="../../../index.html">System</a> &#x00BB; <a href="../../index.html">Generic</a> &#x00BB; <a href="../index.html">1-Machine</a> &#x00BB; Observation</nav><header class="odoc-preamble"><h1>Module <code><span>1-Machine.Observation</span></code></h1><p>Observations interface.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec value" id="val-observe" class="anchored"><a href="#val-observe" class="anchor"></a><code><span><span class="keyword">val</span> observe : <span><span><span class="type-var">'a</span> <a href="../../../../index.html#type-observation">observation</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>observe obs on_observation</code> subscribes to the given observation <code>obs</code>. Every time the observation <code>obs</code> is made a function <code>on_observation</code> is called. The function can perform arbitrary computations in the machine monad, e.g., make its own computations, or access other components via their interfaces.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-subscribe" class="anchored"><a href="#val-subscribe" class="anchor"></a><code><span><span class="keyword">val</span> subscribe : <span><span><span class="type-var">'a</span> <a href="../../../../index.html#type-observation">observation</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../index.html#type-subscription">subscription</a> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>subscribe obs handler</code> creates a cancelable subscription to the observation <code>obs</code>.</p><p>Returns a subscription handler that could be used to cancel the subscription.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.1.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-cancel" class="anchored"><a href="#val-cancel" class="anchor"></a><code><span><span class="keyword">val</span> cancel : <span><a href="../../../../index.html#type-subscription">subscription</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>cancel sub</code> cancels the given subscription.</p><p>An observation that was registered under this subscription won't be called anymore.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.1.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-watch" class="anchored"><a href="#val-watch" class="anchor"></a><code><span><span class="keyword">val</span> watch : <span><a href="../../../../Observation/index.html#type-provider">Observation.provider</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Core_kernel</span>.Sexp.t <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>watch prov data</code> watches for the data provider.</p><p>This function is the same as <code>observe</code> except that it uses the provider to access the observation and gets the observation in the sexp-serialized form.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-make" class="anchored"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span><span class="type-var">'a</span> <a href="../../../../index.html#type-statement">statement</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>make observation event</code> make an <code>observation</code> of the given <code>event</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-post" class="anchored"><a href="#val-post" class="anchor"></a><code><span><span class="keyword">val</span> post : <span><span><span class="type-var">'a</span> <a href="../../../../index.html#type-statement">statement</a></span> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>(<span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>post observation k</code> makes observation if necessary.</p><p>The continuation <code>k</code> is a function that is called only when the given statement has subscribers.</p><p>Use this function to skip creating an observation if nobody is interested in it. This is useful, when the observation has some cost to construct, so when there no subscribers no machine cycles will be lost.</p><p>The function <code>k</code> receives a <code>provide</code> function that could be used to provide observation once it is ready, e.g.,</p><pre><code>Observation.post big_thing ~f:(fun provide -&gt;
    some_costly_function1 &gt;&gt;= fun x -&gt;
    some_costly_function2 &gt;&gt;= fun y -&gt;
    some_costly_function3 &gt;&gt;= fun z -&gt;
    provide (x,y,z))</code></pre><p>Note: even for observations that are tuples this function is efficient as sometimes the compiler can optimize the closure creation or the closure itself might be smaller than the created observation.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.1.0</li></ul></div></div></div></body></html>