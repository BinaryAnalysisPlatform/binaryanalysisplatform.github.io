<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Jobs (bap-primus.Bap_primus.Std.Primus.Jobs)</title><link rel="stylesheet" href="../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">bap-primus</a> &#x00BB; <a href="../../../index.html">Bap_primus</a> &#x00BB; <a href="../../index.html">Std</a> &#x00BB; <a href="../index.html">Primus</a> &#x00BB; Jobs</nav><h1>Module <code>Primus.Jobs</code></h1><p>A facility to register and run multiple instances of Primus.</p><p>This interface allows only the analysis (specialized) systems.</p><dl><dt>since</dt><dd>2.1.0</dd></dl></header><dl><dt class="spec type" id="type-action"><a href="#type-action" class="anchor"></a><code><span class="keyword">type</span> action</code><code> = </code><table class="variant"><tr id="type-action.Stop" class="anchored"><td class="def constructor"><a href="#type-action.Stop" class="anchor"></a><code>| </code><code><span class="constructor">Stop</span></code></td></tr><tr id="type-action.Continue" class="anchored"><td class="def constructor"><a href="#type-action.Continue" class="anchor"></a><code>| </code><code><span class="constructor">Continue</span></code></td></tr></table></dt><dd><p>an action to take after each job.</p></dd></dl><dl><dt class="spec type" id="type-result"><a href="#type-result" class="anchor"></a><code><span class="keyword">type</span> result</code></dt><dd><p>the final result of running the job queue.</p></dd></dl><dl><dt class="spec value" id="val-enqueue"><a href="#val-enqueue" class="anchor"></a><code><span class="keyword">val</span> enqueue : <span>?&#8288;name:string</span> <span>&#45;&gt;</span> <span>?&#8288;desc:string</span> <span>&#45;&gt;</span> <span>?&#8288;envp:<span>string array</span></span> <span>&#45;&gt;</span> <span>?&#8288;args:<span>string array</span></span> <span>&#45;&gt;</span> <span>?&#8288;init:<span>unit <a href="../Machine/Make/index.html#type-t">Machine.Make(Bap_knowledge.Knowledge).t</a></span></span> <span>&#45;&gt;</span> <span>?&#8288;start:<span>unit <a href="../Machine/Make/index.html#type-t">Machine.Make(Bap_knowledge.Knowledge).t</a></span></span> <span>&#45;&gt;</span> <a href="../index.html#type-system">system</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>enqueue system</code> creates a new job and enqueues it for future run.</p><dl><dt>parameter name</dt><dd><p>a short name of the job for logging (defaults to unnamed)</p></dd></dl><dl><dt>parameter desc</dt><dd><p>a short description of the job task (defaults to <code>&quot;&quot;</code>)</p></dd></dl><dl><dt>parameter envp</dt><dd><p>the array of environment variables</p></dd></dl><dl><dt>parameter argv</dt><dd><p>the array of commandline arguments</p></dd></dl><dl><dt>parameter init</dt><dd><p>runs after machine boots</p></dd></dl><dl><dt>parameter start</dt><dd><p>runs after machine is initialized</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-pending"><a href="#val-pending" class="anchor"></a><code><span class="keyword">val</span> pending : unit <span>&#45;&gt;</span> int</code></dt><dd><p><code>pending ()</code> is the number of jobs still waiting to be run.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <span>?&#8288;on_failure:<span>(<a href="../Job/index.html#type-t">Job.t</a> <span>&#45;&gt;</span> <a href="../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_knowledge.Knowledge.conflict</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> <a href="index.html#type-action">action</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;on_success:<span>(<a href="../Job/index.html#type-t">Job.t</a> <span>&#45;&gt;</span> <a href="../index.html#type-exit_status">exit_status</a> <span>&#45;&gt;</span> <a href="../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-state">Bap_knowledge.Knowledge.state</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> <a href="index.html#type-action">action</a>)</span></span> <span>&#45;&gt;</span> <a href="../../../../../bap/Bap/Std/index.html#type-project">Bap.Std.project</a> <span>&#45;&gt;</span> <a href="../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-state">Bap_knowledge.Knowledge.state</a> <span>&#45;&gt;</span> <a href="index.html#type-result">result</a></code></dt><dd><p><code>run project state</code> runs until there are no more jobs queued or until explicitly stopped.</p><p>The <code>project</code> and <code>state</code> values are used as the initial static program representation and knowledge base.</p><p>Every time a job is finised either <code>on_success</code> or <code>on_conflict</code> is called. These callbacks shall return either <code>Stop</code> or <code>Continue</code>. If either returns <code>Stop</code> then <code>run</code> also stops even if there are more jobs in the queue (the jobs are not cleared, so <code>pending ()</code> might be non-zero).</p><p>Both of the callbacks return <code>Continue</code> by default.</p><dl><dt>parameter on_conflict</dt><dd><p>is called as <code>on_conflict sys conflict</code> when the system <code>sys</code> failes to converge and stops with the knowledge <code>conflict</code>. The returned value should indicate what to do next.</p></dd></dl><dl><dt>parameter on_success</dt><dd><p>is called as <code>on_success sys status kb</code> when the system <code>sys</code> terminates without knowledge conflicts with the exit <code>status</code> and the knowledge stored in <code>kb</code>. The returned value prescribes what to do next.</p><p>Note that the job queue could be extended during analysis, the <code>run</code> function will execute all jobs in the FIFO order, unless explicitly stopped.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-knowledge"><a href="#val-knowledge" class="anchor"></a><code><span class="keyword">val</span> knowledge : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> <a href="../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-state">Bap_knowledge.Knowledge.state</a></code></dt><dd><p><code>knowledge result</code> is the knowledge obtained from running the jobs.</p></dd></dl><dl><dt class="spec value" id="val-project"><a href="#val-project" class="anchor"></a><code><span class="keyword">val</span> project : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> <a href="../../../../../bap/Bap/Std/index.html#type-project">Bap.Std.project</a></code></dt><dd><p><code>project result</code> is the final static representation of program.</p></dd></dl><dl><dt class="spec value" id="val-failures"><a href="#val-failures" class="anchor"></a><code><span class="keyword">val</span> failures : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> <span><span>(<a href="../Job/index.html#type-t">Job.t</a> * <a href="../../../../../bap-knowledge/Bap_knowledge/Knowledge/index.html#type-conflict">Bap_knowledge.Knowledge.conflict</a>)</span> list</span></code></dt><dd><p><code>failures result</code> is the list of failed jobs.</p><p>Each failed is a pair of the job and and the description of the conflict that prevented system from convering.</p><p>The failures are specified in the order in which they happened.</p></dd></dl><dl><dt class="spec value" id="val-finished"><a href="#val-finished" class="anchor"></a><code><span class="keyword">val</span> finished : <a href="index.html#type-result">result</a> <span>&#45;&gt;</span> <span><a href="../Job/index.html#type-t">Job.t</a> list</span></code></dt><dd><p><code>finished result</code> is the final list of jobs that were run in the order in which they were run.</p></dd></dl></div></body></html>