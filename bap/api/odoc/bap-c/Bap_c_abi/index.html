<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Bap_c_abi (bap-c.Bap_c_abi)</title><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">bap-c</a> &#x00BB; Bap_c_abi</nav><header class="odoc-preamble"><h1>Module <code><span>Bap_c_abi</span></code></h1><p>C language ABI.</p><p>This module provides a common interface for building ABI support modules for C language.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-param" class="anchored"><a href="#type-param" class="anchor"></a><code><span><span class="keyword">type</span> param</span><span> = <a href="../Bap_c_data/index.html#type-t">Bap_c_data.t</a> * <a href="../../bap/Bap/Std/index.html#type-exp">Bap.Std.exp</a></span></code></div><div class="spec-doc"><p>Function formal parameter is represented as a pair of an abstraction of data, that is passed via the parameter, and a BIL expression, that denotes the parameter.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-args" class="anchored"><a href="#type-args" class="anchor"></a><code><span><span class="keyword">type</span> args</span><span> = </span><span>{</span></code><table><tr id="type-args.return" class="anchored"><td class="def record field"><a href="#type-args.return" class="anchor"></a><code><span>return : <span><a href="#type-param">param</a> option</span>;</span></code></td></tr><tr id="type-args.hidden" class="anchored"><td class="def record field"><a href="#type-args.hidden" class="anchor"></a><code><span>hidden : <span><span>(<a href="../Bap_c_type/index.html#type-t">Bap_c_type.t</a> * <a href="#type-param">param</a>)</span> list</span>;</span></code></td></tr><tr id="type-args.params" class="anchored"><td class="def record field"><a href="#type-args.params" class="anchor"></a><code><span>params : <span><a href="#type-param">param</a> list</span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>subroutine argument list is split into three parts: <code>return</code> is the return arguments, that is optional; <code>params</code> are regular positional parameters, the length of the <code>params</code> list must equal to the amount of the formals in the function prototype; <code>hidden</code> are hidden parameters, that are inserted by abi to pass special arguments, like <code>this</code> pointer or a pointer to a structural value, for example.</p><p>The api processor, created by this module, will insert arg terms into sub in the following way:</p><ul><li>nth positional argument corresponds to nth arg term (counting from 0).</li><li>the last arg term corresponds to the return argument, if any;</li><li>all hidden arguments are put between the last positional and the return argument.</li></ul></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><table><tr id="type-t.insert_args" class="anchored"><td class="def record field"><a href="#type-t.insert_args" class="anchor"></a><code><span>insert_args : <span><span><a href="../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Bap_c_type/index.html#type-attr">Bap_c_type.attr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bap_c_type/index.html#type-proto">Bap_c_type.proto</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-args">args</a> option</span>;</span></code></td></tr><tr id="type-t.apply_attrs" class="anchored"><td class="def record field"><a href="#type-t.apply_attrs" class="anchor"></a><code><span>apply_attrs : <span><span><a href="../Bap_c_type/index.html#type-attr">Bap_c_type.attr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>an abi processor. Each architecture registers its own abi processor, that is responsible for dispatching the processed subroutine between architecture specific abi processors.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-create_api_processor" class="anchored"><a href="#val-create_api_processor" class="anchor"></a><code><span><span class="keyword">val</span> create_api_processor : <span><a href="../Bap_c_size/class-base/index.html">Bap_c_size.base</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../bap-api/Bap_api/index.html#type-t">Bap_api.t</a></span></code></div><div class="spec-doc"><p><code>create_api_processor size t</code> packs an api processor. The processor will insert arg terms into each recognized subroutine, propagate some known C attributes into corresponding BIR attributes, annotate each inserted arg term with its corresponding C type and datum model, and annotate each regognized subroutine with its C prototype.</p><p>The api processor relies on an availability of a front end parser for C language.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-data" class="anchored"><a href="#val-data" class="anchor"></a><code><span><span class="keyword">val</span> data : <span><a href="../Bap_c_size/class-base/index.html">Bap_c_size.base</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Bap_c_type/index.html#type-t">Bap_c_type.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Bap_c_data/index.html#type-t">Bap_c_data.t</a></span></code></div><div class="spec-doc"><p><code>data size t</code> creates an abstraction of data that is represented by type <code>t</code>. The <code>size</code> parameter defines a data model, e.g., sizes of primitive types, padding and alignment restrictions, etc.</p><p>The abstraction includes inner and trailing paddings, when necessary.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-layout" class="anchored"><a href="#val-layout" class="anchor"></a><code><span><span class="keyword">val</span> layout : <span><a href="../Bap_c_size/class-base/index.html">Bap_c_size.base</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Bap_c_type/index.html#type-t">Bap_c_type.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Bap_c_data/index.html#type-layout">Bap_c_data.layout</a></span></code></div><div class="spec-doc"><p><code>layout size t</code> computes the c data type layout.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-model" class="anchored"><a href="#val-model" class="anchor"></a><code><span><span class="keyword">val</span> model : <span><a href="../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Bap_c_size/class-base/index.html">Bap_c_size.base</a></span></code></div><div class="spec-doc"><p><code>model target</code> returns the data model for the given target.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-apply" class="anchored"><a href="#val-apply" class="anchor"></a><code><span><span class="keyword">val</span> apply : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bap_c_size/class-base/index.html">Bap_c_size.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../Bap_c_type/index.html#type-attr">Bap_c_type.attr</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bap_c_type/index.html#type-proto">Bap_c_type.proto</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../bap/Bap/Std/index.html#type-sub">Bap.Std.sub</a> <a href="../../bap/Bap/Std/index.html#type-term">Bap.Std.term</a></span></span></code></div><div class="spec-doc"><p><code>apply processor attrs proto sub</code> applies the abi processor to the subroutine <code>sub</code>.</p><p>The function inserts arguments and attaches appropriate arguments to the function and its subterms, such as strores the type of each argument, the provided C attributes, stores the prototype, computes and attaches data layouts, etc.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-arg_intent" class="anchored"><a href="#val-arg_intent" class="anchor"></a><code><span><span class="keyword">val</span> arg_intent : <span><a href="../Bap_c_type/index.html#type-t">Bap_c_type.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../bap/Bap/Std/index.html#type-intent">Bap.Std.intent</a></span></code></div><div class="spec-doc"><p><code>arg_intent t</code> infers argument intention based on its C type. If an argument is passed by value, i.e., it is a c basic type, then it is an input argument. If an argument is a reference, but not a function, then it is input/output if any value, referenced by the argument is non-const. A reference to function always has the input intent. If an argyment is a structure or union, then it is input/output if any of its fields is input/output.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-register" class="anchored"><a href="#val-register" class="anchor"></a><code><span><span class="keyword">val</span> register : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>register name t</code> registers an abi processor <code>t</code> named <code>name</code> that may be used by subroutines in this project.</p><p>@after 2.5.0 fails if there is already a processor for the given <code>name</code>. @after 2.5.0 the abi name should be a valid target name.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_processor" class="anchored"><a href="#val-get_processor" class="anchor"></a><code><span><span class="keyword">val</span> get_processor : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p><code>get_processor name</code> is used to access an abi processor with its name.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lookup" class="anchored"><a href="#val-lookup" class="anchor"></a><code><span><span class="keyword">val</span> lookup : <span><a href="../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p><code>lookup t</code> the abi processor associated with the target <code>t</code>.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul></div></div><div class="odoc-spec"><div class="spec module" id="module-Stack" class="anchored"><a href="#module-Stack" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Stack/index.html">Stack</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>An abstraction of a stack, commonly used in C compilers.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Arg" class="anchored"><a href="#module-Arg" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Arg/index.html">Arg</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A monadic eDSL for argument passing semantics specification.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-define" class="anchored"><a href="#val-define" class="anchor"></a><code><span><span class="keyword">val</span> define : 
  <span><a href="../../bap-core-theory/Bap_core_theory/Theory/Target/index.html#type-t">Bap_core_theory.Theory.Target.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Bap_c_size/class-base/index.html">Bap_c_size.base</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span><a href="../Bap_c_type/index.html#type-attr">Bap_c_type.attr</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Bap_c_type/index.html#type-proto">Bap_c_type.proto</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="Arg/index.html#type-semantics">Arg.semantics</a> <a href="Arg/index.html#type-t">Arg.t</a></span> )</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>define target pass</code> the high-level ABI specification function.</p><p>The function creates an abi processor and registers it using the name obtained from the <code>target</code>. The <code>pass</code> function is used to define the <code>insert_args</code> method (with the <code>sub</code> argument ignored).</p><p>The function also registers an ABI pass that checks the project target and if it matches with the passed <code>target</code> the function creates and registers the C API processor.</p></div></div></div></body></html>