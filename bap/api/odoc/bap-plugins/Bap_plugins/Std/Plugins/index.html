<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Plugins (bap-plugins.Bap_plugins.Std.Plugins)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">bap-plugins</a> &#x00BB; <a href="../../index.html">Bap_plugins</a> &#x00BB; <a href="../index.html">Std</a> &#x00BB; Plugins</nav><header class="odoc-preamble"><h1>Module <code><span>Std.Plugins</span></code></h1><p>Plugin loader.</p><p>This module handles the set of plugins, visible to the platform.</p><p>Plugins are looked at the following locations:</p><ul><li>paths explicitly specified by a user (via <code>library</code> parameter);</li><li>paths specified by the <code>BAP_PLUGIN_PATH</code> environment variable (same syntax as PATH variable);</li><li>$prefix/lib/bap, where $prefix is the installation prefix, specified during the installation.</li></ul><p>The latter destination is used by the <code>bapbundle install</code> command, so this is the default repository of plugins.</p><p>The plugin loader is an event driven system. Once, <code>Plugins.run</code> function is called, events of type <code>Plugins.events</code> will start to fire. By default they are intercepted by a logger, and by the default handler (see <a href="#val-run"><code>Plugins.run</code></a> function description about the default handler). The logger will write the information about events, that is useful for debugging issues with plugins.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-event" class="anchored"><a href="#type-event" class="anchor"></a><code><span><span class="keyword">type</span> event</span><span> = </span><span>[ </span></code><table><tr id="type-event.Opening" class="anchored"><td class="def constructor"><a href="#type-event.Opening" class="anchor"></a><code><span>| </span></code><code><span>`Opening <span class="keyword">of</span> string</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>a bundle with a plugin is opened</p><span class="comment-delim">*)</span></td></tr><tr id="type-event.Loading" class="anchored"><td class="def constructor"><a href="#type-event.Loading" class="anchor"></a><code><span>| </span></code><code><span>`Loading <span class="keyword">of</span> <a href="../index.html#type-plugin">plugin</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>a plugin loading process is started</p><span class="comment-delim">*)</span></td></tr><tr id="type-event.Linking" class="anchored"><td class="def constructor"><a href="#type-event.Linking" class="anchor"></a><code><span>| </span></code><code><span>`Linking <span class="keyword">of</span> string</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>a library or module is linked in</p><span class="comment-delim">*)</span></td></tr><tr id="type-event.Loaded" class="anchored"><td class="def constructor"><a href="#type-event.Loaded" class="anchor"></a><code><span>| </span></code><code><span>`Loaded <span class="keyword">of</span> <a href="../index.html#type-plugin">plugin</a></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>a plugin was successfully loaded</p><span class="comment-delim">*)</span></td></tr><tr id="type-event.Errored" class="anchored"><td class="def constructor"><a href="#type-event.Errored" class="anchor"></a><code><span>| </span></code><code><span>`Errored <span class="keyword">of</span> string * <span class="xref-unresolved">Core_kernel</span>.Error.t</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>failed to load a plugin</p><span class="comment-delim">*)</span></td></tr></table><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-sexp_of_event" class="anchored"><a href="#val-sexp_of_event" class="anchor"></a><code><span><span class="keyword">val</span> sexp_of_event : <span><a href="#type-event">event</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Ppx_sexp_conv_lib</span>.Sexp.t</span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-path" class="anchored"><a href="#val-path" class="anchor"></a><code><span><span class="keyword">val</span> path : string</span></code></div><div class="spec-doc"><p><code>path</code> is the default directory where plugins are stored.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-list" class="anchored"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span>?env:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?provides:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?library:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-plugin">plugin</a> list</span></span></code></div><div class="spec-doc"><p><code>list ()</code> is a list of available plugins.</p><p>Returns all plugins that provide features specified by <code>provides</code> and meet the constraint specified by <code>env</code>. If a non-valid plugin is found in the search path, then it is ignored.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">provides</span> <p>if specified then only those plugins that provide at least one feature from the specified list are selected. Otherwise, all plugins are selected.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">env</span> <p>is a set of features provided by the runtime (defaults to none). If specified, then all plugins that require a set of features that is a subset of <code>env</code> will be selected. Note, usually, plugins do not have any requirements (i.e., the have an empty set of requirements), therefore all are selected.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">library</span> <p>is the list of additional directories in which plugins are searched. If specified then it is prepended to the default search path that contains (in that order):</p><ul><li>the list of paths specified by the BAP_PLUGIN_PATH environment variable;</li><li>the <code>Plugins.directory</code> constant.</li></ul><p>Note, any non-files or non-directories are silently excluded from the list.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>?argv:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?provides:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span>?don't_setup_handlers:bool <span class="arrow">&#45;&gt;</span></span> <span>?library:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?exclude:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>run ()</code> loads all plugins.</p><p>This command will load all plugins available in the system (see the <a href="#val-load"><code>load</code></a> and <a href="#val-list"><code>list</code></a> functions for more information on which plugins are available). If an error occurs during an attempt to load a plugin and if <code>don't_setup_handlers</code> option is not set to <code>true</code>, an extended error message is printed to the standard error channel and the currently running program is terminated with exit code 1.</p><p>This function calls the <code>load</code> function and then observes (unless <code>don't_setup_handlers</code> is set) events that occur during loading to intercept any errors. So see the <a href="#val-load"><code>load</code></a> function for more detailed information.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">don't_setup_handlers</span> <p>if set to <code>true</code> (defaults to <code>false</code>) then all erros are silently ignored. Don't use it unless you're implementing your own error handling facility via the event subsystem.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-load" class="anchored"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : <span>?argv:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>?env:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?provides:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span>?library:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?exclude:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<a href="../index.html#type-plugin">plugin</a>, string * <span class="xref-unresolved">Core_kernel</span>.Error.t)</span> <span class="xref-unresolved">Core_kernel</span>.Result.t</span> list</span></span></code></div><div class="spec-doc"><p><code>load ()</code> loads all plugins if they are not loaded yet.</p><p>Loads all plugins available in the system and returns a list of values in which each entry corresponds to a result of a loading attempt, which could be either a successfully loaded plugin or an error, in case if the attempt has failed.</p><p>The list of all plugins is <code>list ?env ?provides ?library ()</code> which is furthermore refined by removing all plugins which names are specified in the <code>exclude</code> blacklist.</p><p>This function returns silently if <code>Plugins.loaded</code> is already decided. No matter the outcome, the <code>Plugins.loaded</code> future will be decided.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-events" class="anchored"><a href="#val-events" class="anchor"></a><code><span><span class="keyword">val</span> events : <span><a href="#type-event">event</a> <a href="../../../../bap-future/Bap_future/Std/index.html#type-stream">Bap_future.Std.stream</a></span></span></code></div><div class="spec-doc"><p>plugin subsystem event stream.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-loaded" class="anchored"><a href="#val-loaded" class="anchor"></a><code><span><span class="keyword">val</span> loaded : <span>unit <a href="../../../../bap-future/Bap_future/Std/index.html#type-future">Bap_future.Std.future</a></span></span></code></div><div class="spec-doc"><p><code>loaded</code> occurs when all plugins are loaded</p></div></div></div></body></html>