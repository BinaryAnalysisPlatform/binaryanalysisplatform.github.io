<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Plugins (bap.Bap_plugins.Std.Plugins)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">bap</a> &#x00BB; <a href="../../index.html">Bap_plugins</a> &#x00BB; <a href="../index.html">Std</a> &#x00BB; Plugins</nav><h1>Module <code>Std.Plugins</code></h1><p>Plugin loader.</p><p>This module handles the set of plugins, visible to the platform.</p><p>Plugins are looked at the following locations:</p><ul><li>paths explicitly specified by a user (via <code>library</code> parameter);</li><li>paths specified by the <code>BAP_PLUGIN_PATH</code> environment variable (same syntax as PATH variable);</li><li>$prefix/lib/bap, where $prefix is the installation prefix, specified during the installation.</li></ul><p>The latter destination is used by the <code>bapbundle install</code> command, so this is the default repository of plugins.</p><p>The plugin loader is an event driven system. Once, <code>Plugins.run</code> function is called, events of type <code>Plugins.events</code> will start to fire. By default they are intercepted by a logger, and by the default handler (see <a href="index.html#val-run"><code>Plugins.run</code></a> function description about the default handler). The logger will write the infromation about events, that is useful for debugging issues with plugins.</p></header><dl><dt class="spec type" id="type-event"><a href="#type-event" class="anchor"></a><code><span class="keyword">type</span> event</code> = <code>[ </code><table class="variant"><tr id="type-event.Opening" class="anchored"><td class="def constructor"><a href="#type-event.Opening" class="anchor"></a><code>| </code><code>`Opening <span class="keyword">of</span> string</code></td><td class="doc"><p>a bundle with a plugin is opened</p></td></tr><tr id="type-event.Loading" class="anchored"><td class="def constructor"><a href="#type-event.Loading" class="anchor"></a><code>| </code><code>`Loading <span class="keyword">of</span> <a href="../index.html#type-plugin">plugin</a></code></td><td class="doc"><p>a plugin loading process is started</p></td></tr><tr id="type-event.Linking" class="anchored"><td class="def constructor"><a href="#type-event.Linking" class="anchor"></a><code>| </code><code>`Linking <span class="keyword">of</span> string</code></td><td class="doc"><p>a library or module is linked in</p></td></tr><tr id="type-event.Loaded" class="anchored"><td class="def constructor"><a href="#type-event.Loaded" class="anchor"></a><code>| </code><code>`Loaded <span class="keyword">of</span> <a href="../index.html#type-plugin">plugin</a></code></td><td class="doc"><p>a plugin was successfully loaded</p></td></tr><tr id="type-event.Errored" class="anchored"><td class="def constructor"><a href="#type-event.Errored" class="anchor"></a><code>| </code><code>`Errored <span class="keyword">of</span> string * <a href="../../../../core_kernel/Core_kernel/Error/index.html#type-t">Core_kernel.Error.t</a></code></td><td class="doc"><p>failed to load a plugin</p></td></tr></table><code> ]</code></dt></dl><div><div class="spec include"><div class="doc"><dl><dt class="spec value" id="val-sexp_of_event"><a href="#val-sexp_of_event" class="anchor"></a><code><span class="keyword">val</span> sexp_of_event : <a href="index.html#type-event">event</a> <span>&#45;&gt;</span> <a href="../../../../sexplib0/Sexplib0/Sexp/index.html#type-t">Ppx_sexp_conv_lib.Sexp.t</a></code></dt></dl></div></div></div><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : ?&#8288;env:string list <span>&#45;&gt;</span> ?&#8288;provides:string list <span>&#45;&gt;</span> ?&#8288;library:string list <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="../index.html#type-plugin">plugin</a> list</code></dt><dd><p><code>list ?env ~provides:features ?library ()</code> scans a list of directories, provided by a <code>library</code> parameter, and, finally, <code>Config.libdir</code> for files with a <code>plugin</code> extension. Returns all plugins that provide a superset of <code>features</code> and has constrains that are subset of <code>env</code>.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : ?&#8288;argv:string array <span>&#45;&gt;</span> ?&#8288;env:string list <span>&#45;&gt;</span> ?&#8288;provides:string list <span>&#45;&gt;</span> ?&#8288;don't_setup_handlers:bool <span>&#45;&gt;</span> ?&#8288;library:string list <span>&#45;&gt;</span> ?&#8288;exclude:string list <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> unit</code></dt><dd><p><code>run ?env ?provides ?library ?exclude</code> load and execute all plugins that can be found in the <code>library</code> paths, and are not in the <code>exclude</code> list. The default event handler will abort the program if there is any <code>Errored</code> event occurs, a message will be printed to the standard output. If <code>don't_setup_handlers</code> option is chosen, then events are not treated, so that a host program may setup a more fine granular error handling.</p></dd></dl><dl><dt class="spec value" id="val-load"><a href="#val-load" class="anchor"></a><code><span class="keyword">val</span> load : ?&#8288;argv:string array <span>&#45;&gt;</span> ?&#8288;env:string list <span>&#45;&gt;</span> ?&#8288;provides:string list <span>&#45;&gt;</span> ?&#8288;library:string list <span>&#45;&gt;</span> ?&#8288;exclude:string list <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> (<a href="../index.html#type-plugin">plugin</a>, string * <a href="../../../../core_kernel/Core_kernel/Error/index.html#type-t">Core_kernel.Error.t</a>) <a href="../../../../core_kernel/Core_kernel/Result/index.html#type-t">Core_kernel.Result.t</a> list</code></dt><dd><p><code>load ?env ?provides ?library ?exclude</code> is like <code>run</code>, but will not setup handlers, and will return a result of loading. Each element of the list is either an <code>Ok plugin</code> if a <code>plugin</code> was successfully loaded, or <code>Error (name,error)</code> if a plugin with the given <code>name</code> failed with <code>error</code>.</p></dd></dl><dl><dt class="spec value" id="val-events"><a href="#val-events" class="anchor"></a><code><span class="keyword">val</span> events : <a href="index.html#type-event">event</a> <a href="../../../../bap-future/Bap_future/Std/index.html#type-stream">Bap_future.Std.stream</a></code></dt><dd><p>plugin subsystem event stream.</p></dd></dl><dl><dt class="spec value" id="val-loaded"><a href="#val-loaded" class="anchor"></a><code><span class="keyword">val</span> loaded : unit <a href="../../../../bap-future/Bap_future/Std/index.html#type-future">Bap_future.Std.future</a></code></dt><dd><p><code>loaded</code> occurs when all plugins are loaded</p></dd></dl></div></body></html>