<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Live (bap.Bap.Std.Live)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">bap</a> &#x00BB; <a href="../../index.html">Bap</a> &#x00BB; <a href="../index.html">Std</a> &#x00BB; Live</nav><header class="odoc-preamble"><h1>Module <code><span>Std.Live</span></code></h1><p>Live Variables.</p><p>Computes the set of live variables for each block in a subroutine, taking into account subroutine arguments.</p><p>A variable <code>v</code> is <i>live</i> at a program point <code>x</code> if there exists a path from <code>x</code> to a use of <code>v</code> that doesn't go through a definition of <code>v</code>.</p><p>This module computes liveness on the block granularity, which gives rise to the following notions.</p><p>A variable is <i>live-in</i> at a basic block <code>x</code> if it is live at the begining of the block <code>x</code>.</p><p>A variable is <i>live-out</i> at a basic block <code>x</code> if it is live on any of the outcoming edges of <code>x</code>.</p><p>A variable is <i>live-through</i> at a basic block <code>x</code> if it is both live-in and live-out at it.</p></header><nav class="odoc-toc"><ul><li><a href="#liveness-in-the-ssa-form">Liveness in the SSA form</a></li></ul></nav><div class="odoc-content"><h4 id="liveness-in-the-ssa-form"><a href="#liveness-in-the-ssa-form" class="anchor"></a>Liveness in the SSA form</h4><p>The algorithm works with the SSA form. From the perspective of liveness, the phi-nodes define their right-hand sides on the edges incoming from the corresponding blocks. More formally, for a phi-node at block <code>b0</code>, <code>x0 := phi([b1,x1; b2,x2;...;bN,xN])</code>, the defined variable <code>x0</code> is considered to be defined at blocks <code>bi</code> and the variable <code>xi</code> live-out of basic block <code>bi</code>, for <code>0 &lt; i &lt;= N</code>.</p><p>Intuitively, this can be visualized as if the following program,</p><pre>        b1:
        x.1 := 1
        goto b3

        b2:
        x.2 := 2
        goto b3

        b3:
        x.3 &lt;- phi([b1,x1]; [b2, x2])
        ...</pre><p>is rewritten to an equivalent (but not in SSA) program,</p><pre>        b1:
        x.1 := 1
        x.3 := x1
        goto b3

        b2:
        x.2 := 2
        x.3 := x2
        goto b3

        b3:
        ...</pre><p>That means that a variable defined by a phi-node in a block <code>x</code> could be live-in at the block <code>x</code>.</p><p>The <a href="#val-defs"><code>Live.defs</code></a> and <a href="#val-uses"><code>Live.uses</code></a> includes the variables from the corresponding phi-nodes, e.g., <code>Live.defs b1</code> will is <code>{x1,x3}</code> and <code>Live.uses b1</code> is <code>{x1}</code>.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 2.5.0</li></ul><ul class="at-tags"><li class="before"><span class="at-tag">before</span> <span class="value">2.5.0</span> <p>see <a href="../Sub/index.html#val-compute_liveness"><code>Sub.compute_liveness</code></a></p></li></ul><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compute"><a href="#val-compute" class="anchor"></a><code><span><span class="keyword">val</span> compute : <span>?keep:<a href="../Var/Set/index.html#type-t">Var.Set.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../index.html#type-sub">sub</a> <a href="../index.html#type-term">term</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>compute sub</code> computes the subroutine liveness information.</p><p>Variables specified by <code>keep</code> will be kept live at the exit from the function. In addition to the variables in <code>keep</code>, all free variables used by in and in/out arguments of the subroutine will be kept alive at the exit.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-vars"><a href="#val-vars" class="anchor"></a><code><span><span class="keyword">val</span> vars : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Var/Set/index.html#type-t">Var.Set.t</a></span></code></div><div class="spec-doc"><p><code>vars live</code> the variables that are live in the subroutine.</p><p>The set of variables that are live-in on the entry block of the subroutine that was used to compute <code>live</code>. The live variables of the subroutine also called free variables or upper-exposed variables. They may be used in the subroutine before they are assigned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ins"><a href="#val-ins" class="anchor"></a><code><span><span class="keyword">val</span> ins : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Var/Set/index.html#type-t">Var.Set.t</a></span></code></div><div class="spec-doc"><p><code>ins live blk</code> the set of live-in variables at <code>blk</code>.</p><p>The set of variables that are live at the entry to the basic block <code>blk</code>.</p><p>Returns an empty set if <code>blk</code> doesn't belong to the <code>sub</code> graph.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-outs"><a href="#val-outs" class="anchor"></a><code><span><span class="keyword">val</span> outs : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Var/Set/index.html#type-t">Var.Set.t</a></span></code></div><div class="spec-doc"><p><code>outs live blk</code> the set of live-outs variables at <code>blk</code>.</p><p>The set of variables that are live at the exist from the basic block <code>blk</code>.</p><p>Returns an empty set if <code>blk</code> doesn't belong to the <code>sub</code> graph.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-blks"><a href="#val-blks" class="anchor"></a><code><span><span class="keyword">val</span> blks : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-var">var</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Core_kernel</span>.Set.M(<span class="xref-unresolved">Tid</span>).t</span></code></div><div class="spec-doc"><p><code>blks live var</code> the set of blks where <code>var</code> is live-in.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-defs"><a href="#val-defs" class="anchor"></a><code><span><span class="keyword">val</span> defs : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Var/Set/index.html#type-t">Var.Set.t</a></span></code></div><div class="spec-doc"><p><code>defs live blk</code> the set of variables defined by <code>blk</code>.</p><p>Aka the <i>KILL</i> set, i.e., the set of variables whose liveness is killed in the block <code>blk</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-uses"><a href="#val-uses" class="anchor"></a><code><span><span class="keyword">val</span> uses : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Var/Set/index.html#type-t">Var.Set.t</a></span></code></div><div class="spec-doc"><p><code>uses live blk</code> the set of variables used by <code>blk</code>.</p><p>Aka the <i>GEN</i> set, i.e., the set of variables generated by the block <code>blk</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span><span class="keyword">val</span> fold : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>init:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../index.html#type-tid">tid</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Var/Set/index.html#type-t">Var.Set.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>fold live ~init ~f</code> folds over live-ins of blocks.</p><p>Applies <code>f</code> to live-in set of variables of each block of the subroutine.</p><p>Note, pseudo start and exit nodes are not folded over.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-solution"><a href="#val-solution" class="anchor"></a><code><span><span class="keyword">val</span> solution : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../index.html#type-tid">tid</a>, <a href="../Var/Set/index.html#type-t">Var.Set.t</a>)</span> <a href="../../../../graphlib/Graphlib/Std/Solution/index.html#type-t">Graphlib.Std.Solution.t</a></span></span></code></div><div class="spec-doc"><p><code>solution live</code> returns the fixed point solution.</p><p>The solution is the mapping from blocks to their live-outs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>pp ppf live</code> prints the live-in sets of each basic block.</p></div></div></div></body></html>