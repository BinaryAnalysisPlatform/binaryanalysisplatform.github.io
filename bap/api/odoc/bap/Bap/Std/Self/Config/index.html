<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Config (bap.Bap.Std.Self.Config)</title><link rel="stylesheet" href="../../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../../../index.html">bap</a> &#x00BB; <a href="../../../index.html">Bap</a> &#x00BB; <a href="../../index.html">Std</a> &#x00BB; <a href="../index.html">Self</a> &#x00BB; Config</nav><h1>Module <code>Self.Config</code></h1><p>This module allows plugins to access BAP configuration variables.</p><p>When reading the values for the configuration variables, the decreasing order of precedence for the values is:</p><ul><li>Command line arguments</li><li>Environment variables</li><li>Configuration file</li><li>Default fallback value</li></ul><p>Example usage:</p><pre><code class="ml">let path = Config.(param string ~doc:&quot;a path to file&quot;
                     ~default:&quot;input.txt&quot; &quot;path&quot;)
let debug = Config.(flag (* ... *) )

(* ... *)

let main () =
  Config.when_ready
    (fun {Config.get=(!)} -&gt;
       do_stuff !path !debug (* ... *)
    )</code></pre></header><dl><dt class="spec value" id="val-version"><a href="#val-version" class="anchor"></a><code><span class="keyword">val</span> version : string</code></dt><dd><p>Version number</p></dd></dl><dl><dt class="spec value" id="val-datadir"><a href="#val-datadir" class="anchor"></a><code><span class="keyword">val</span> datadir : string</code></dt><dd><p>A directory for bap specific read-only architecture independent data files.</p></dd></dl><dl><dt class="spec value" id="val-libdir"><a href="#val-libdir" class="anchor"></a><code><span class="keyword">val</span> libdir : string</code></dt><dd><p>A directory for bap specific object files, libraries, and internal binaries that are not intended to be executed directly by users or shell scripts</p></dd></dl><dl><dt class="spec value" id="val-confdir"><a href="#val-confdir" class="anchor"></a><code><span class="keyword">val</span> confdir : string</code></dt><dd><p>A directory for bap specific configuration files</p></dd></dl><dl><dt class="spec type" id="type-param"><a href="#type-param" class="anchor"></a><code><span class="keyword">type</span> <span>'a param</span></code></dt><dd><p>An abstract parameter type that can be later read using a reader</p></dd></dl><dl><dt class="spec type" id="type-parser"><a href="#type-parser" class="anchor"></a><code><span class="keyword">type</span> <span>'a parser</span></code><code> = string <span>&#45;&gt;</span> <span>[ <span>`Ok of <span class="type-var">'a</span></span> <span><span>| `Error</span> of string</span> ]</span></code></dt><dd><p>Parse a string to an 'a</p></dd></dl><dl><dt class="spec type" id="type-converter"><a href="#type-converter" class="anchor"></a><code><span class="keyword">type</span> <span>'a converter</span></code></dt><dd><p>Type for converting <code>string</code> &lt;-&gt; <code>'a</code>. Also defines a default value for the <code>'a</code> type.</p></dd></dl><dl><dt class="spec value" id="val-converter"><a href="#val-converter" class="anchor"></a><code><span class="keyword">val</span> converter : <span><span class="type-var">'a</span> <a href="index.html#type-parser">parser</a></span> <span>&#45;&gt;</span> <span>(Stdlib.Format.formatter <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span></code></dt><dt class="spec value" id="val-deprecated"><a href="#val-deprecated" class="anchor"></a><code><span class="keyword">val</span> deprecated : string</code></dt><dd><p>Default deprecation warning message, for easy deprecation of parameters.</p></dd></dl><dl><dt class="spec value" id="val-param"><a href="#val-param" class="anchor"></a><code><span class="keyword">val</span> param : <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span>?&#8288;deprecated:string</span> <span>&#45;&gt;</span> <span>?&#8288;default:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;as_flag:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;docv:string</span> <span>&#45;&gt;</span> <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span>?&#8288;synonyms:<span>string list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-param">param</a></span></code></dt><dd><p><code>param conv ~default ~docv ~doc name</code> creates a parameter which is referred to on the command line, environment variable, and config file using the value of <code>name</code>, with the type defined by <code>conv</code>, using the <code>default</code> value if unspecified by user.</p><p>The <code>default</code> is optional, and falls back to the default defined by <code>conv</code>.</p><p><code>doc</code> is the man page information of the argument. The variable <code>&quot;$(docv)&quot;</code> can be used to refer to the value of <code>docv</code>. <code>docv</code> is a variable name used in the man page to stand for their value.</p><p>A user can optionally add <code>deprecated</code> to a parameter that is to be deprecated soon. This will cause the parameter to be usable as normal, but will emit a warning to the user if they try to use it. Example usage: <code>Config.(param ~deprecated int &quot;--old&quot;)</code>.</p><p>Additionally, <code>synonyms</code> can be added to allow multiple arguments referring to the same parameters. However, this is usually discouraged, and considered proper usage only in rare scenarios.</p><p>Also, a developer can use the <code>~as_flag</code> to specify a default value that the argument takes if it is used like a flag. This behaviour can be understood better through the following example.</p><p>Consider <code>Config.(param (some int) ~as_flag:(Some 10) &quot;x&quot;)</code>.</p><p>This results in 3 possible command line invocations:</p><p>1. No <code>--x</code> - Results in <code>default</code> value (specifically here, <code>None</code>).</p><p>2. Only <code>--x</code> - This causes it to have the value <code>as_flag</code> (specifically here,<code>Some 10</code>).</p><p>3. <code>--x=20</code> - This causes it to have the value from the command line (specifically here, <code>Some 20</code>).</p></dd></dl><dl><dt class="spec value" id="val-param_all"><a href="#val-param_all" class="anchor"></a><code><span class="keyword">val</span> param_all : <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span>?&#8288;deprecated:string</span> <span>&#45;&gt;</span> <span>?&#8288;default:<span><span class="type-var">'a</span> list</span></span> <span>&#45;&gt;</span> <span>?&#8288;as_flag:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>?&#8288;docv:string</span> <span>&#45;&gt;</span> <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span>?&#8288;synonyms:<span>string list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> list</span> <a href="index.html#type-param">param</a></span></code></dt><dd><p>Create a parameter which accepts a list at command line by repetition of argument. Similar to <code>param (list 'a) ...</code> in all other respects. Defaults to an empty list if unspecified.</p></dd></dl><dl><dt class="spec value" id="val-flag"><a href="#val-flag" class="anchor"></a><code><span class="keyword">val</span> flag : <span>?&#8288;deprecated:string</span> <span>&#45;&gt;</span> <span>?&#8288;docv:string</span> <span>&#45;&gt;</span> <span>?&#8288;doc:string</span> <span>&#45;&gt;</span> <span>?&#8288;synonyms:<span>string list</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>bool <a href="index.html#type-param">param</a></span></code></dt><dd><p>Create a boolean parameter that is set to true if user mentions it in the command line arguments</p></dd></dl><dl><dt class="spec value" id="val-determined"><a href="#val-determined" class="anchor"></a><code><span class="keyword">val</span> determined : <span><span class="type-var">'a</span> <a href="index.html#type-param">param</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../../../bap-future/Bap_future/Std/index.html#type-future">Bap_future.Std.future</a></span></code></dt><dd><p>Provides a future determined on when the config can be read</p></dd></dl><dl><dt class="spec type" id="type-reader"><a href="#type-reader" class="anchor"></a><code><span class="keyword">type</span> reader</code><code> = </code><code>{</code><table class="record"><tr id="type-reader.get" class="anchored"><td class="def field"><a href="#type-reader.get" class="anchor"></a><code>get : a. <span><span class="type-var">'a</span> <a href="index.html#type-param">param</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span>;</code></td></tr></table><code>}</code></dt><dd><p>A witness that can read configured params</p></dd></dl><dl><dt class="spec value" id="val-when_ready"><a href="#val-when_ready" class="anchor"></a><code><span class="keyword">val</span> when_ready : <span>(<a href="index.html#type-reader">reader</a> <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>when_ready f</code> requests the system to call function <code>f</code> once configuration parameters are established and stabilized. An access function will be passed to the function <code>f</code>, that can be used to safely dereference parameters.</p></dd></dl><dl><dt class="spec type" id="type-manpage_block"><a href="#type-manpage_block" class="anchor"></a><code><span class="keyword">type</span> manpage_block</code> = <code>[ </code><table class="variant"><tr id="type-manpage_block.I" class="anchored"><td class="def constructor"><a href="#type-manpage_block.I" class="anchor"></a><code>| </code><code>`I <span class="keyword">of</span> string * string</code></td></tr><tr id="type-manpage_block.Noblank" class="anchored"><td class="def constructor"><a href="#type-manpage_block.Noblank" class="anchor"></a><code>| </code><code>`Noblank</code></td></tr><tr id="type-manpage_block.P" class="anchored"><td class="def constructor"><a href="#type-manpage_block.P" class="anchor"></a><code>| </code><code>`P <span class="keyword">of</span> string</code></td></tr><tr id="type-manpage_block.Pre" class="anchored"><td class="def constructor"><a href="#type-manpage_block.Pre" class="anchor"></a><code>| </code><code>`Pre <span class="keyword">of</span> string</code></td></tr><tr id="type-manpage_block.S" class="anchored"><td class="def constructor"><a href="#type-manpage_block.S" class="anchor"></a><code>| </code><code>`S <span class="keyword">of</span> string</code></td></tr></table><code> ]</code></dt><dd><p>The type for a block of man page text.</p><ul><li><code>`S s</code> introduces a new section <code>s</code>.</li><li><code>`P t</code> is a new paragraph with text <code>t</code>.</li><li><code>`Pre t</code> is a new preformatted paragraph with text <code>t</code>.</li><li><code>`I (l,t)</code> is an indented paragraph with label <code>l</code> and text <code>t</code>.</li><li><code>`Noblank</code> suppresses the blank line introduced between two blocks.</li></ul><p>Except in <code>`Pre</code>, whitespace and newlines are not significant and are all collapsed to a single space. In labels <code>l</code> and text strings <code>t</code>, the syntax <code>&quot;$(i,italic text)&quot;</code> and <code>&quot;$(b,bold
          text)&quot;</code> can be used to respectively produce italic and bold text.</p></dd></dl><dl><dt class="spec value" id="val-manpage"><a href="#val-manpage" class="anchor"></a><code><span class="keyword">val</span> manpage : <span><a href="index.html#type-manpage_block">manpage_block</a> list</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Create a manpage for the plugin</p></dd></dl><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">val</span> bool : <span>bool <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>bool</code> converts values with <code>bool_of_string</code>.</p></dd></dl><dl><dt class="spec value" id="val-char"><a href="#val-char" class="anchor"></a><code><span class="keyword">val</span> char : <span>char <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>char</code> converts values by ensuring the argument has a single char.</p></dd></dl><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">val</span> int : <span>int <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>int</code> converts values with <code>int_of_string</code>.</p></dd></dl><dl><dt class="spec value" id="val-nativeint"><a href="#val-nativeint" class="anchor"></a><code><span class="keyword">val</span> nativeint : <span>nativeint <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>nativeint</code> converts values with <span class="xref-unresolved" title="unresolved reference to &quot;Nativeint.of_string&quot;"><code>Nativeint</code>.of_string</span>.</p></dd></dl><dl><dt class="spec value" id="val-int32"><a href="#val-int32" class="anchor"></a><code><span class="keyword">val</span> int32 : <span>int32 <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>int32</code> converts values with <span class="xref-unresolved" title="unresolved reference to &quot;Int32.of_string&quot;"><code>Int32</code>.of_string</span>.</p></dd></dl><dl><dt class="spec value" id="val-int64"><a href="#val-int64" class="anchor"></a><code><span class="keyword">val</span> int64 : <span>int64 <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>int64</code> converts values with <span class="xref-unresolved" title="unresolved reference to &quot;Int64.of_string&quot;"><code>Int64</code>.of_string</span>.</p></dd></dl><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">val</span> float : <span>float <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>float</code> converts values with <code>float_of_string</code>.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : <span>string <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>string</code> converts values with the identity function.</p></dd></dl><dl><dt class="spec value" id="val-enum"><a href="#val-enum" class="anchor"></a><code><span class="keyword">val</span> enum : <span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>enum l</code> converts values such that unambiguous prefixes of string names in <code>l</code> map to the corresponding value of type <code>'a</code>.</p><p><b>Warning.</b> The type <code>'a</code> must be comparable with <span class="xref-unresolved" title="unresolved reference to &quot;Pervasives.compare&quot;"><code>Pervasives</code>.compare</span>.</p><dl><dt>raises Invalid_argument</dt><dd><p>if <code>l</code> is empty.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-doc_enum"><a href="#val-doc_enum" class="anchor"></a><code><span class="keyword">val</span> doc_enum : <span>?&#8288;quoted:bool</span> <span>&#45;&gt;</span> <span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span>&#45;&gt;</span> string</code></dt><dd><p><code>doc_enum l</code> documents the possible string names in the <code>l</code> map according to the number of alternatives. If <code>quoted</code> is <code>true</code> (default), the tokens are quoted. The resulting string can be used in sentences of the form <code>&quot;$(docv) must
          be %s&quot;</code>.</p></dd></dl><dl><dt class="spec value" id="val-file"><a href="#val-file" class="anchor"></a><code><span class="keyword">val</span> file : <span>string <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>file</code> converts a value with the identity function and checks with <span class="xref-unresolved" title="unresolved reference to &quot;Sys.file_exists&quot;"><code>Sys</code>.file_exists</span> that a file with that name exists.</p></dd></dl><dl><dt class="spec value" id="val-dir"><a href="#val-dir" class="anchor"></a><code><span class="keyword">val</span> dir : <span>string <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>dir</code> converts a value with the identity function and checks with <span class="xref-unresolved" title="unresolved reference to &quot;Sys.file_exists&quot;"><code>Sys</code>.file_exists</span> and <span class="xref-unresolved" title="unresolved reference to &quot;Sys.is_directory&quot;"><code>Sys</code>.is_directory</span> that a directory with that name exists.</p></dd></dl><dl><dt class="spec value" id="val-non_dir_file"><a href="#val-non_dir_file" class="anchor"></a><code><span class="keyword">val</span> non_dir_file : <span>string <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>non_dir_file</code> converts a value with the identity function and checks with <span class="xref-unresolved" title="unresolved reference to &quot;Sys.file_exists&quot;"><code>Sys</code>.file_exists</span> and <span class="xref-unresolved" title="unresolved reference to &quot;Sys.is_directory&quot;"><code>Sys</code>.is_directory</span> that a non directory file with that name exists.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <span>?&#8288;sep:char</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> list</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>list sep c</code> splits the argument at each <code>sep</code> (defaults to <code>','</code>) character and converts each substrings with <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">val</span> array : <span>?&#8288;sep:char</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> array</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>array sep c</code> splits the argument at each <code>sep</code> (defaults to <code>','</code>) character and converts each substring with <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-pair"><a href="#val-pair" class="anchor"></a><code><span class="keyword">val</span> pair : <span>?&#8288;sep:char</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>pair sep c0 c1</code> splits the argument at the <em>first</em> <code>sep</code> character (defaults to <code>','</code>) and respectively converts the substrings with <code>c0</code> and <code>c1</code>.</p></dd></dl><dl><dt class="spec value" id="val-t2"><a href="#val-t2" class="anchor"></a><code><span class="keyword">val</span> t2 : <span>?&#8288;sep:char</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>)</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><a href="index.html#val-t2"><code>t2</code></a> is <a href="index.html#val-pair"><code>pair</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-t3"><a href="#val-t3" class="anchor"></a><code><span class="keyword">val</span> t3 : <span>?&#8288;sep:char</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'c</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span>)</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>t3 sep c0 c1 c2</code> splits the argument at the <em>first</em> two <code>sep</code> characters (defaults to <code>','</code>) and respectively converts the substrings with <code>c0</code>, <code>c1</code> and <code>c2</code>.</p></dd></dl><dl><dt class="spec value" id="val-t4"><a href="#val-t4" class="anchor"></a><code><span class="keyword">val</span> t4 : <span>?&#8288;sep:char</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'c</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'d</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span> * <span class="type-var">'c</span> * <span class="type-var">'d</span>)</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>t4 sep c0 c1 c2 c3</code> splits the argument at the <em>first</em> three <code>sep</code> characters (defaults to <code>','</code>) respectively converts the substrings with <code>c0</code>, <code>c1</code>, <code>c2</code> and <code>c3</code>.</p></dd></dl><dl><dt class="spec value" id="val-some"><a href="#val-some" class="anchor"></a><code><span class="keyword">val</span> some : <span>?&#8288;none:string</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-converter">converter</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> option</span> <a href="index.html#type-converter">converter</a></span></code></dt><dd><p><code>some none c</code> is like the converter <code>c</code> except it returns <code>Some</code> value. It is used for command line arguments that default to <code>None</code> when absent. <code>none</code> is what to print to document the absence (defaults to <code>&quot;&quot;</code>).</p></dd></dl></div></body></html>