<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Driver (ppxlib.Ppxlib__.Driver)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">ppxlib</a> &#x00BB; <a href="../index.html">Ppxlib__</a> &#x00BB; Driver</nav><h1>Module <code>Ppxlib__.Driver</code></h1></header><dl><dt class="spec value" id="val-add_arg"><a href="#val-add_arg" class="anchor"></a><code><span class="keyword">val</span> add_arg : <a href="../../../base/Caml/Arg/index.html#type-key">Caml.Arg.key</a> <span>&#45;&gt;</span> <a href="../../../base/Caml/Arg/index.html#type-spec">Caml.Arg.spec</a> <span>&#45;&gt;</span> <span>doc:<a href="../Import/index.html#type-string">Ppxlib__.Import.string</a></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Add one argument to the command line</p></dd></dl><dl><dt class="spec module" id="module-Lint_error"><a href="#module-Lint_error" class="anchor"></a><code><span class="keyword">module</span> <a href="Lint_error/index.html">Lint_error</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Error reported by linters</p></dd></dl><div class="spec module" id="module-Cookies"><a href="#module-Cookies" class="anchor"></a><code><span class="keyword">module</span> <a href="Cookies/index.html">Cookies</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-register_transformation"><a href="#val-register_transformation" class="anchor"></a><code><span class="keyword">val</span> register_transformation : <span>?&#8288;extensions:<span><a href="../../Ppxlib/Extension/index.html#type-t">Ppxlib.Extension.t</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span></span> <span>&#45;&gt;</span> <span>?&#8288;rules:<span><a href="../../Ppxlib/Context_free/Rule/index.html#type-t">Ppxlib.Context_free.Rule.t</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span></span> <span>&#45;&gt;</span> <span>?&#8288;enclose_impl:<span>(<span><a href="../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <a href="../Import/index.html#type-option">Ppxlib__.Import.option</a></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> * <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;enclose_intf:<span>(<span><a href="../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a> <a href="../Import/index.html#type-option">Ppxlib__.Import.option</a></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> * <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;impl:<span>(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;intf:<span>(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;lint_impl:<span>(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span>&#45;&gt;</span> <span><a href="Lint_error/index.html#type-t">Lint_error.t</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;lint_intf:<span>(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span>&#45;&gt;</span> <span><a href="Lint_error/index.html#type-t">Lint_error.t</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;preprocess_impl:<span>(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;preprocess_intf:<span>(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;aliases:<span><a href="../Import/index.html#type-string">Ppxlib__.Import.string</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-string">Ppxlib__.Import.string</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p><code>register_transformation name</code> registers a code transformation.</p><p><code>name</code> is a logical name for the transformation (such as <code>sexp_conv</code> or <code>bin_prot</code>). It is mostly used for debugging purposes.</p><p><code>rules</code> is a list of context independent rewriting rules, such as extension point expanders. This is what most code transformation should use. Rules from all registered transformations are all applied at the same time, before any other transformations. Moreover they are applied in a top-down manner, giving more control to extensions on how they interpret their payload.</p><p>For instance:</p><ul><li>some extensions capture a pretty-print of the payload in their expansion and using top-down ensures that the payload is as close as possible to the original code</li><li>some extensions process other extension in a special way inside their payload. For instance <code>%here</code> (from ppx_here) will normally expand to a record of type <code>Lexing.position</code>. However when used inside <code>%sexp</code> (from ppx_sexp_value) it will expand to the human-readable sexp representation of a source code position.</li></ul><p><code>extensions</code> is a special cases of <code>rules</code> and is deprecated. It is only kept for backward compatibility.</p><p><code>enclose_impl</code> and <code>enclose_intf</code> produces a header and footer for implementation/interface files. They are a special case of <code>impl</code> and <code>intf</code>. Both functions receive a location that denotes the whole file, or <code>None</code> if the file contains nothing.</p><p><code>impl</code> is an optional function that is applied on implementation files and <code>intf</code> is an optional function that is applied on interface files. These two functions are applied on the AST of the whole file. They should only be used when the other mechanism are not enough. For instance if the transformation expands extension points that depend on the context.</p><p>If no rewriter is using <code>impl</code> and <code>intf</code>, then the whole transformation is completely independent of the order in which the various rewriter are specified. Moreover the resulting driver will be faster as it will do only one pass (excluding safety checks) on the whole AST.</p><p><code>lint_impl</code> and <code>lint_intf</code> are applied to the unprocessed source. Errors they return will be reported to the user as preprocessor warnings.</p><p><code>preprocess_impl</code> and <code>preprocess_intf</code> are applied after linters, but before other transformations.</p></dd></dl><dl><dt class="spec value" id="val-register_transformation_using_ocaml_current_ast"><a href="#val-register_transformation_using_ocaml_current_ast" class="anchor"></a><code><span class="keyword">val</span> register_transformation_using_ocaml_current_ast : <span>?&#8288;impl:<span>(<a href="../../../ocaml-migrate-parsetree/Ast_407/Parsetree/index.html#type-structure">Migrate_parsetree.OCaml_current.Ast.Parsetree.structure</a> <span>&#45;&gt;</span> <a href="../../../ocaml-migrate-parsetree/Ast_407/Parsetree/index.html#type-structure">Migrate_parsetree.OCaml_current.Ast.Parsetree.structure</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;intf:<span>(<a href="../../../ocaml-migrate-parsetree/Ast_407/Parsetree/index.html#type-signature">Migrate_parsetree.OCaml_current.Ast.Parsetree.signature</a> <span>&#45;&gt;</span> <a href="../../../ocaml-migrate-parsetree/Ast_407/Parsetree/index.html#type-signature">Migrate_parsetree.OCaml_current.Ast.Parsetree.signature</a>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;aliases:<span><a href="../Import/index.html#type-string">Ppxlib__.Import.string</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-string">Ppxlib__.Import.string</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Same as <code>register_transformation</code> except that it uses the same AST as the current ocaml compiler.</p><p>This is not the intended way of using driver. This is only for ppx rewriters that are not written using ppxlib but want to export a driver compatible library.</p></dd></dl><dl><dt class="spec value" id="val-register_code_transformation"><a href="#val-register_code_transformation" class="anchor"></a><code><span class="keyword">val</span> register_code_transformation : <span>name:<a href="../Import/index.html#type-string">Ppxlib__.Import.string</a></span> <span>&#45;&gt;</span> <span>?&#8288;aliases:<span><a href="../Import/index.html#type-string">Ppxlib__.Import.string</a> <a href="../Import/index.html#type-list">Ppxlib__.Import.list</a></span></span> <span>&#45;&gt;</span> <span>impl:<span>(<a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-structure">Ppxlib__.Import.structure</a>)</span></span> <span>&#45;&gt;</span> <span>intf:<span>(<a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-signature">Ppxlib__.Import.signature</a>)</span></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Same as:</p><pre><code class="ml">register_transformation
  ~name
  ~impl
  ~intf
  ()</code></pre></dd></dl><dl><dt class="spec value" id="val-register_correction"><a href="#val-register_correction" class="anchor"></a><code><span class="keyword">val</span> register_correction : <span>loc:<a href="../../Ppxlib/Location/index.html#type-t">Ppxlib.Location.t</a></span> <span>&#45;&gt;</span> <span>repl:<a href="../Import/index.html#type-string">Ppxlib__.Import.string</a></span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Rewriters might call this function to suggest a correction to the code source. When they do this, the driver will generate a <code>file.ml.ppx-corrected</code> file with the suggested replacement. The build system will then show the diff to the user who is free to accept the correction or not.</p></dd></dl><dl><dt class="spec value" id="val-register_process_file_hook"><a href="#val-register_process_file_hook" class="anchor"></a><code><span class="keyword">val</span> register_process_file_hook : <span>(<a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a>)</span> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Hook called before processing a file</p></dd></dl><dl><dt class="spec module" id="module-Create_file_property"><a href="#module-Create_file_property" class="anchor"></a><code><span class="keyword">module</span> <a href="Create_file_property/index.html">Create_file_property</a> : <span class="keyword">functor</span> (<a href="Create_file_property/argument-1-Name/index.html">Name</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span>) <span>&#45;&gt;</span> <span class="keyword">functor</span> (<a href="Create_file_property/argument-2-T/index.html">T</a> : <a href="../../../base/Base/Sexpable/index.html#module-type-S">Ppxlib__.Import.Sexpable.S</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Create a new file property.</p></dd></dl><dl><dt class="spec value" id="val-standalone"><a href="#val-standalone" class="anchor"></a><code><span class="keyword">val</span> standalone : <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Suitable for -pp and also usable as a standalone command line tool.</p><p>If the first command line argument is <code>-as-ppx</code> then it will run as a ppx rewriter.</p></dd></dl><dl><dt class="spec value" id="val-run_as_ppx_rewriter"><a href="#val-run_as_ppx_rewriter" class="anchor"></a><code><span class="keyword">val</span> run_as_ppx_rewriter : <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a></code></dt><dd><p>Suitable for -ppx. Used only for the public release.</p></dd></dl><dl><dt class="spec value" id="val-pretty"><a href="#val-pretty" class="anchor"></a><code><span class="keyword">val</span> pretty : <a href="../Import/index.html#type-unit">Ppxlib__.Import.unit</a> <span>&#45;&gt;</span> <a href="../Import/index.html#type-bool">Ppxlib__.Import.bool</a></code></dt><dd><p>If <code>true</code>, code transformations should avoid generating code that is not strictly necessary, such as extra type annotations.</p></dd></dl></div></body></html>