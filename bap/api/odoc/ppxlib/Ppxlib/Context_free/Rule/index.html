<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Rule (ppxlib.Ppxlib.Context_free.Rule)</title><link rel="stylesheet" href="../../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">ppxlib</a> &#x00BB; <a href="../../index.html">Ppxlib</a> &#x00BB; <a href="../index.html">Context_free</a> &#x00BB; Rule</nav><h1>Module <code>Context_free.Rule</code></h1><p>Local rewriting rules.</p><p>This module lets you define local rewriting rules, such as extension point expanders. It is not completely generic and you cannot define any kind of rewriting, it currently focuses on what is commonly used. New scheme can be added on demand.</p><p>We have some ideas to make this fully generic, but this hasn't been a priority so far.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-extension"><a href="#val-extension" class="anchor"></a><code><span class="keyword">val</span> extension : <a href="../../Extension/index.html#type-t">Extension.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Rewrite an extension point</p></dd></dl><dl><dt class="spec value" id="val-special_function"><a href="#val-special_function" class="anchor"></a><code><span class="keyword">val</span> special_function : <a href="../../../Ppxlib__/Import/index.html#type-string">Ppxlib__.Import.string</a> <span>&#45;&gt;</span> <span>(<a href="../../../Ppxlib__/Import/index.html#type-expression">Ppxlib__.Import.expression</a> <span>&#45;&gt;</span> <span><a href="../../../Ppxlib__/Import/index.html#type-expression">Ppxlib__.Import.expression</a> <a href="../../../Ppxlib__/Import/index.html#type-option">Ppxlib__.Import.option</a></span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>special_function id expand</code> is a rule to rewrite a function call at parsing time. <code>id</code> is the identifier to match on and <code>expand</code> is used to expand the full function application (it gets the Pexp_apply node). If the function is found in the tree without being applied, <code>expand</code> gets only the identifier (Pexp_ident node) so you should handle both cases.</p><p>If <code>id</code> is an operator identifier and contains dots, it should be parenthesized (e.g. <code>&quot;(+.+)&quot;</code>).</p><p><code>expand</code> must decide whether the expression it receive can be rewritten or not. Especially ppxlib makes the assumption that <code>expand</code> is idempotent. It will loop if it is not.</p></dd></dl><dl><dt class="spec module" id="module-Constant_kind"><a href="#module-Constant_kind" class="anchor"></a><code><span class="keyword">module</span> <a href="Constant_kind/index.html">Constant_kind</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Used for the <code>constant</code> function.</p></dd></dl><dl><dt class="spec value" id="val-constant"><a href="#val-constant" class="anchor"></a><code><span class="keyword">val</span> constant : <a href="Constant_kind/index.html#type-t">Constant_kind.t</a> <span>&#45;&gt;</span> <a href="../../../Ppxlib__/Import/index.html#type-char">Ppxlib__.Import.char</a> <span>&#45;&gt;</span> <span>(<a href="../../Location/index.html#type-t">Location.t</a> <span>&#45;&gt;</span> <a href="../../../Ppxlib__/Import/index.html#type-string">Ppxlib__.Import.string</a> <span>&#45;&gt;</span> <a href="../../../../ocaml-migrate-parsetree/Ast_407/Parsetree/index.html#type-expression">Ppxlib__.Import.Parsetree.expression</a>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>constant kind suffix expander</code> Registers an extension for transforming constants literals, based on the suffix character.</p></dd></dl><aside><p>The rest of this API is for rewriting rules that apply when a certain attribute is present. The API is not complete and is currently only enough to implement deriving.</p></aside><dl><dt class="spec type" id="type-attr_group_inline"><a href="#type-attr_group_inline" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'b, 'c) attr_group_inline</span></code><code> = <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="../../Attribute/index.html#type-t">Attribute.t</a></span> <span>&#45;&gt;</span> <span>(<span>loc:<a href="../../Location/index.html#type-t">Location.t</a></span> <span>&#45;&gt;</span> <span>path:<a href="../../../Ppxlib__/Import/index.html#type-string">Ppxlib__.Import.string</a></span> <span>&#45;&gt;</span> <a href="../../../../ocaml-migrate-parsetree/Ast_407/Asttypes/index.html#type-rec_flag">Ppxlib__.Import.Asttypes.rec_flag</a> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="../../../Ppxlib__/Import/index.html#type-list">Ppxlib__.Import.list</a></span> <span>&#45;&gt;</span> <span><span><span class="type-var">'c</span> <a href="../../../Ppxlib__/Import/index.html#type-option">Ppxlib__.Import.option</a></span> <a href="../../../Ppxlib__/Import/index.html#type-list">Ppxlib__.Import.list</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../Ppxlib__/Import/index.html#type-list">Ppxlib__.Import.list</a></span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Match the attribute on a group of items, such as a group of recursive type definitions (Pstr_type, Psig_type). The expander will be triggered if any of the item has the attribute. The expander is called as follow:</p><p><code>expand ~loc ~path rec_flag items values</code></p><p>where <code>values</code> is the list of values associated to the attribute for each item in <code>items</code>. <code>expand</code> must return a list of element to add after the group. For instance a list of structure item to add after a group of type definitions.</p></dd></dl><dl><dt class="spec value" id="val-attr_str_type_decl"><a href="#val-attr_str_type_decl" class="anchor"></a><code><span class="keyword">val</span> attr_str_type_decl : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_group_inline">attr_group_inline</a></span></code></dt><dt class="spec value" id="val-attr_sig_type_decl"><a href="#val-attr_sig_type_decl" class="anchor"></a><code><span class="keyword">val</span> attr_sig_type_decl : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_group_inline">attr_group_inline</a></span></code></dt><dt class="spec value" id="val-attr_str_type_decl_expect"><a href="#val-attr_str_type_decl_expect" class="anchor"></a><code><span class="keyword">val</span> attr_str_type_decl_expect : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_group_inline">attr_group_inline</a></span></code></dt><dd><p>The _expect variants are for producing code that is compared to what the user wrote in the source code.</p></dd></dl><dl><dt class="spec value" id="val-attr_sig_type_decl_expect"><a href="#val-attr_sig_type_decl_expect" class="anchor"></a><code><span class="keyword">val</span> attr_sig_type_decl_expect : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_declaration">Ppxlib__.Import.type_declaration</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_group_inline">attr_group_inline</a></span></code></dt></dl><dl><dt class="spec type" id="type-attr_inline"><a href="#type-attr_inline" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'b, 'c) attr_inline</span></code><code> = <span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="../../Attribute/index.html#type-t">Attribute.t</a></span> <span>&#45;&gt;</span> <span>(<span>loc:<a href="../../Location/index.html#type-t">Location.t</a></span> <span>&#45;&gt;</span> <span>path:<a href="../../../Ppxlib__/Import/index.html#type-string">Ppxlib__.Import.string</a></span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="../../../Ppxlib__/Import/index.html#type-list">Ppxlib__.Import.list</a></span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Same as <code>attr_group_inline</code> but for elements that are not part of a group, such as exceptions and type extensions</p></dd></dl><dl><dt class="spec value" id="val-attr_str_type_ext"><a href="#val-attr_str_type_ext" class="anchor"></a><code><span class="keyword">val</span> attr_str_type_ext : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_sig_type_ext"><a href="#val-attr_sig_type_ext" class="anchor"></a><code><span class="keyword">val</span> attr_sig_type_ext : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_str_type_ext_expect"><a href="#val-attr_str_type_ext_expect" class="anchor"></a><code><span class="keyword">val</span> attr_str_type_ext_expect : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_sig_type_ext_expect"><a href="#val-attr_sig_type_ext_expect" class="anchor"></a><code><span class="keyword">val</span> attr_sig_type_ext_expect : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-type_extension">Ppxlib__.Import.type_extension</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_str_exception"><a href="#val-attr_str_exception" class="anchor"></a><code><span class="keyword">val</span> attr_str_exception : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_sig_exception"><a href="#val-attr_sig_exception" class="anchor"></a><code><span class="keyword">val</span> attr_sig_exception : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_str_exception_expect"><a href="#val-attr_str_exception_expect" class="anchor"></a><code><span class="keyword">val</span> attr_str_exception_expect : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-structure_item">Ppxlib__.Import.structure_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt><dt class="spec value" id="val-attr_sig_exception_expect"><a href="#val-attr_sig_exception_expect" class="anchor"></a><code><span class="keyword">val</span> attr_sig_exception_expect : <span><span>(<a href="../../../Ppxlib__/Import/index.html#type-signature_item">Ppxlib__.Import.signature_item</a>, <a href="../../../Ppxlib__/Import/index.html#type-extension_constructor">Ppxlib__.Import.extension_constructor</a>, <span class="type-var">_</span>)</span> <a href="index.html#type-attr_inline">attr_inline</a></span></code></dt></dl></div></body></html>