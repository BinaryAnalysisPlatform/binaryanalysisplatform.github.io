<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Hash (base.Base__.Hash)</title><link rel="stylesheet" href="../../../_odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">base</a> &#x00BB; <a href="../index.html">Base__</a> &#x00BB; Hash</nav><h1>Module <code>Base__.Hash</code></h1></header><div><div class="spec include"><div class="doc"><div class="spec module-type" id="module-type-Full"><a href="#module-type-Full" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Full/index.html">Full</a> = <a href="../Hash_intf/index.html#module-type-Full">Base__.Hash_intf.Full</a></code></div><div class="spec module-type" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a> = <a href="../Hash_intf/index.html#module-type-S">Base__.Hash_intf.S</a></code></div><div class="spec module" id="module-F"><a href="#module-F" class="anchor"></a><code><span class="keyword">module</span> <a href="F/index.html">F</a> : <span class="keyword">functor</span> (<a href="F/argument-1-Hash/index.html">Hash</a> : <a href="index.html#module-type-S">S</a>) <span>&#45;&gt;</span> <a href="index.html#module-type-Full">Full</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="F/index.html#type-hash_value">hash_value</a> = <a href="F/argument-1-Hash/index.html#type-hash_value">Hash.hash_value</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="F/index.html#type-state">state</a> = <a href="F/argument-1-Hash/index.html#type-state">Hash.state</a> <span class="keyword">and</span> <span class="keyword">type</span> <a href="F/index.html#type-seed">seed</a> = <a href="F/argument-1-Hash/index.html#type-seed">Hash.seed</a></code></div><aside><p>The code of <code>ppx_hash</code> is agnostic to the choice of hash algorithm that is used. However, it is not currently possible to mix various choices of hash algorithms in a given code base.</p><p>We experimented with:</p><ul><li>(a) custom hash algorithms implemented in OCaml and</li><li>(b) in C;</li><li>(c) OCaml's internal hash function (which is a custom version of Murmur3, implemented in C);</li><li>(d) siphash, a modern hash function implemented in C.</li></ul><p>Our findings were as follows:</p><ul><li>Implementing our own custom hash algorithms in OCaml and C yielded very little performance improvement over the (c) proposal, without providing the benefit of being a peer-reviewed, widely used hash function.</li></ul><ul><li>Siphash (a modern hash function with an internal state of 32 bytes) has a worse performance profile than (a,b,c) above (hashing takes more time). Since its internal state is bigger than an OCaml immediate value, one must either manage allocation of such state explicitly, or paying the cost of allocation each time a hash is computed. While being a supposedly good hash function (with good hash quality), this quality was not translated in measurable improvemenets in our macro benchmarks. (Also, based on the data available at the time of writing, it's unclear that other hash algorithms in this class would be more than marginally faster.)</li></ul><ul><li>By contrast, using the internal combinators of OCaml hash function means that we do not allocate (the internal state of this hash function is 32 bit) and have the same quality and performance as Hashtbl.hash.</li></ul><p>Hence, we are here making the choice of using this Internalhash (that is, Murmur3, the OCaml hash algorithm as of 4.03) as our hash algorithm. It means that the state of the hash function does not need to be preallocated, and makes for simpler use in hash tables and other structures.</p></aside><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="index.html#module-type-Full">Full</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="index.html#module-type-Full">Full</a>.state = <span class="keyword">private</span> int <span class="keyword">and</span> <span class="keyword">type</span> <a href="index.html#module-type-Full">Full</a>.seed = int <span class="keyword">and</span> <span class="keyword">type</span> <a href="index.html#module-type-Full">Full</a>.hash_value = int</code></span></summary><dl><dt class="spec value" id="val-description"><a href="#val-description" class="anchor"></a><code><span class="keyword">val</span> description : string</code></dt><dd><p>Name of the hash-function, e.g., &quot;internalhash&quot;, &quot;siphash&quot;</p></dd></dl><dl><dt class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><code><span class="keyword">type</span> state</code><code> = <span class="keyword">private</span> int</code></dt></dl><dl><dt class="spec value" id="val-fold_int"><a href="#val-fold_int" class="anchor"></a><code><span class="keyword">val</span> fold_int : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> int <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dd><p><code>fold_&lt;T&gt; state v</code> incorporates a value <code>v</code> of type &lt;T&gt; into the hash-state, returning a modified hash-state. Implementations of the <code>fold_&lt;T&gt;</code> functions may mutate the <code>state</code> argument in place, and return a reference to it. Implementations of the fold_&lt;T&gt; functions should not allocate.</p></dd></dl><dl><dt class="spec value" id="val-fold_int64"><a href="#val-fold_int64" class="anchor"></a><code><span class="keyword">val</span> fold_int64 : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> int64 <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-fold_float"><a href="#val-fold_float" class="anchor"></a><code><span class="keyword">val</span> fold_float : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> float <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dt class="spec value" id="val-fold_string"><a href="#val-fold_string" class="anchor"></a><code><span class="keyword">val</span> fold_string : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><dl><dt class="spec type" id="type-seed"><a href="#type-seed" class="anchor"></a><code><span class="keyword">type</span> seed</code><code> = int</code></dt></dl><dl><dt class="spec value" id="val-alloc"><a href="#val-alloc" class="anchor"></a><code><span class="keyword">val</span> alloc : unit <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dd><p><code>alloc ()</code> returns a fresh uninitialized hash-state. May allocate.</p></dd></dl><dl><dt class="spec value" id="val-reset"><a href="#val-reset" class="anchor"></a><code><span class="keyword">val</span> reset : <span>?&#8288;seed:<a href="index.html#type-seed">seed</a></span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dd><p><code>reset ?seed state</code> initializes/resets a hash-state with the given <code>seed</code>, or else a default-seed. Argument <code>state</code> may be mutated. Should not allocate.</p></dd></dl><dl><dt class="spec type" id="type-hash_value"><a href="#type-hash_value" class="anchor"></a><code><span class="keyword">type</span> hash_value</code><code> = int</code></dt></dl><dl><dt class="spec value" id="val-get_hash_value"><a href="#val-get_hash_value" class="anchor"></a><code><span class="keyword">val</span> get_hash_value : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-hash_value">hash_value</a></code></dt><dd><p><code>get_hash_value</code> extracts a hash-value from the hash-state.</p></dd></dl><div class="spec module" id="module-For_tests"><a href="#module-For_tests" class="anchor"></a><code><span class="keyword">module</span> <a href="For_tests/index.html">For_tests</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-folder"><a href="#type-folder" class="anchor"></a><code><span class="keyword">type</span> <span>'a folder</span></code><code> = <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>?&#8288;seed:<a href="index.html#type-seed">seed</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-state">state</a></code></dt><dd><p><code>create ?seed ()</code> is a convenience. Equivalent to <code>reset ?seed (alloc ())</code>.</p></dd></dl><dl><dt class="spec value" id="val-of_fold"><a href="#val-of_fold" class="anchor"></a><code><span class="keyword">val</span> of_fold : <span>(<a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-state">state</a>)</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-hash_value">hash_value</a></code></dt><dd><p><code>of_fold fold</code> constructs a standard hash function from an existing fold function.</p></dd></dl><div class="spec module" id="module-Builtin"><a href="#module-Builtin" class="anchor"></a><code><span class="keyword">module</span> <a href="Builtin/index.html">Builtin</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <span>?&#8288;seed:<a href="index.html#type-seed">seed</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-folder">folder</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="index.html#type-hash_value">hash_value</a></code></dt><dd><p><code>run ?seed folder x</code> runs <code>folder</code> on <code>x</code> in a newly allocated hash-state, initialized using optional <code>seed</code> or a default-seed.</p><p>The following identity exists: <code>run [%hash_fold: T]</code> == <code>[%hash: T]</code></p><p><code>run</code> can be used if we wish to run a hash-folder with a non-default seed.</p></dd></dl></details></div></div></div></div></div></div></div></body></html>